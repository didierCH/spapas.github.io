<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="google-site-verification" content="5_8DTmIiEq4gFvNAfxAD6TsGOgrMAjp8lQFQvfA6zZc" />
  <title>/var/</title>
  <meta name="author" content="Serafeim Papastefanos">




  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="http://spapas.github.io/favicon.png" rel="icon">

  <link href="http://spapas.github.io/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">

  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="http://spapas.github.io/">/var/</a></h1>
    <h2>Various programming stuff</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<ul class="main-navigation">
      <li >
        <a href="http://spapas.github.io/category/css.html">Css</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/django.html">Django</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/flask.html">Flask</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/git.html">Git</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/javascript.html">Javascript</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/pelican.html">Pelican</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/python.html">Python</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/spring.html">Spring</a>
      </li>
      <li >
        <a href="http://spapas.github.io/category/wagtail.html">Wagtail</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div class="blog-index">
  		<article>
<header>
      <h1 class="entry-title">
        <a href="http://spapas.github.io/2015/06/05/comprehensive-react-flux-tutorial/">A comprehensive React and Flux tutorial part 1: React</a>
      </h1>
    <p class="meta">
<time datetime="2015-06-05T14:20:00+03:00" pubdate>Παρ 05 Ιούνιος 2015</time>    </p>
</header>

  <div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#our-project" id="id2">Our&nbsp;project</a></li>
<li><a class="reference internal" href="#a-top-level-view-of-the-components" id="id3">A top-level view of the&nbsp;components</a></li>
<li><a class="reference internal" href="#the-react-only-version" id="id4">The react-only version</a><ul>
<li><a class="reference internal" href="#searchpanel" id="id5"><tt class="docutils literal">SearchPanel</tt></a></li>
<li><a class="reference internal" href="#booktablerow" id="id6"><tt class="docutils literal">BookTableRow</tt></a></li>
<li><a class="reference internal" href="#booktable" id="id7"><tt class="docutils literal">BookTable</tt></a></li>
<li><a class="reference internal" href="#interlude-the-bind-function-method" id="id8">Interlude: The <tt class="docutils literal">bind</tt> function&nbsp;method</a></li>
<li><a class="reference internal" href="#bookform" id="id9"><tt class="docutils literal">BookForm</tt></a></li>
<li><a class="reference internal" href="#bookpanel" id="id10"><tt class="docutils literal">BookPanel</tt></a><ul>
<li><a class="reference internal" href="#component-methods" id="id11">Component&nbsp;methods</a></li>
<li><a class="reference internal" href="#non-ajax-object-methods" id="id12">Non-ajax object&nbsp;methods</a></li>
<li><a class="reference internal" href="#ajax-object-methods" id="id13">Ajax object&nbsp;methods</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#local-state" id="id14">Local&nbsp;state</a></li>
<li><a class="reference internal" href="#conclusion-to-the-first-part" id="id15">Conclusion to the first&nbsp;part</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a></h2>
<p><a class="reference external" href="https://facebook.github.io/react/">React</a> is a rather new library from Facebook for building dynamic components for web pages.
It introduces a really simple, fresh approach to javascript user interface building. React
allows you to define composable and self-contained <span class="caps">HTML</span> components through Javascript (or a special syntax that compiles
to javascript named <span class="caps">JSX</span>) and that&#8217;s all &#8212; it doesn&#8217;t force you into any specific
framework or architecture, you may use whatever you like. It&#8217;s like writing pure
<span class="caps">HTML</span> but you have the advantage of using classes with all their advantages for your
components (self-contained, composable, reusable, mixins&nbsp;etc).</p>
<p>Although React components can be used however you like in your client-side applications, Facebook proposes a specific
architecture for the data flow of your events/data between the components called <a class="reference external" href="https://facebook.github.io/flux/docs/overview.html">Flux</a>.
It&#8217;s important to keep in your mind that Flux is not a
specific framework but a way to organize the flow of events and data in your applicition.
Unfortunately, although Flux is a rather simple architecture it is a little difficult to understand
without a proper example (at least it was difficult for me to understand by reading the
Facebook documentation and some tutorials I&nbsp;found).</p>
<p>So, in this two-part tutorial we are going to build a (not-so-simple) single page <span class="caps">CRUD</span> application using
React and Flux. Two versions of the same application will be built and explained: One with
React (this part) only and one with React and Flux (part two). This will help us understand how
Flux architecture fits to our project and why it greatly improves the experience with&nbsp;React.</p>
<p><strong>Warning</strong>: This is not an introduction to react. Before reading this you need
to be familiar with basic react usage, having read  at least the following three
pages from react&nbsp;documentation:</p>
<ul class="simple">
<li><a class="reference external" href="https://facebook.github.io/react/docs/getting-started.html">https://facebook.github.io/react/docs/getting-started.html</a></li>
<li><a class="reference external" href="https://facebook.github.io/react/docs/tutorial.html">https://facebook.github.io/react/docs/tutorial.html</a></li>
<li><a class="reference external" href="https://facebook.github.io/react/docs/thinking-in-react.html">https://facebook.github.io/react/docs/thinking-in-react.html</a></li>
</ul>
</div>
<div class="section" id="our-project">
<h2><a class="toc-backref" href="#id2">Our&nbsp;project</a></h2>
<p>We are going to built a <span class="caps">CRUD</span> single-page application for editing views, let&#8217;s take a look at how it&nbsp;works:</p>
<img alt="Our project" src="/images/demo.gif" style="width: 780px;" />
<p>Our application will be seperated to two panels: In  the left one the user will be able to filter (search) for
a book and in the right panel she&#8217;ll be able to add / edit / delete a book. Everything is supported by
a <a class="reference external" href="http://www.django-rest-framework.org/">django-rest-framework</a> implemented <span class="caps">REST</span> <span class="caps">API</span>. You can find the complete source code at
<a class="reference external" href="https://github.com/spapas/react-tutorial">https://github.com/spapas/react-tutorial</a>. I&#8217;ve added a couple of git tags to the source history in
order to help us identify the differences between variou stages of the project (before and
after integrating the Flux&nbsp;architecture).</p>
<p>Django-rest-framework is used in the server-side back-end to create a really simple <span class="caps">REST</span> <span class="caps">API</span> - I won&#8217;t
provide any tutorial details on that (unless somebody wants it !), however
you may either use the source code as is or create it from scratch using a different language/framework
or even just a static json file (however you won&#8217;t see any changes to the data this&nbsp;way).</p>
<p>For styling (mainly to have a simple grid) we&#8217;ll use <a class="reference external" href="http://getskeleton.com/">skeleton</a>. For the ajax calls and some utils we&#8217;ll
use <a class="reference external" href="https://jquery.com/">jquery</a>.</p>
<p>All client-side code will be contained in the file static/main.js. The placeholder <span class="caps">HTML</span> for our
application&nbsp;is:</p>
<pre class="code literal-block">
&lt;html&gt;
  &lt;!-- styling etc ignored --&gt;
&lt;body&gt;
  &lt;h1&gt;Hello, React!&lt;/h1&gt;
  &lt;div class=&quot;container&quot;&gt;&lt;div id=&quot;content&quot;&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;script src=&quot;//fb.me/react-0.13.3.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;//fb.me/JSXTransformer-0.13.3.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;//code.jquery.com/jquery-2.1.3.min.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/jsx&quot; src=&quot;{% static 'main.js' %}&quot;&gt;&lt;/script&gt;
&lt;/html&gt;
</pre>
<p>We are using the version 0.13.3 of react and the same version of the JSXTransformer to translate <span class="caps">JSX</span>
code to pure&nbsp;javascript.</p>
</div>
<div class="section" id="a-top-level-view-of-the-components">
<h2><a class="toc-backref" href="#id3">A top-level view of the&nbsp;components</a></h2>
<p>The following image shows how our components are&nbsp;composed:</p>
<img alt="Our components" src="/images/components.png" style="width: 780px;" />
<p>So, the main component of our application is <tt class="docutils literal">BookPanel</tt> which contains three&nbsp;components:</p>
<ul class="simple">
<li><tt class="docutils literal">SearchPanel</tt>: To allow search (filtering) books based on their&nbsp;title/category</li>
<li><tt class="docutils literal">BookForm</tt>: To add/update/delete&nbsp;books</li>
<li><tt class="docutils literal">BookTable</tt>: To display all available books - each book is displayed in a <tt class="docutils literal">BookTableRow</tt> component.</li>
</ul>
<p><tt class="docutils literal">BookPanel</tt> is the only component having state &#8212; all other components will be initialized by property
passing. The <tt class="docutils literal">BookPanel</tt> element will be mounted to the <tt class="docutils literal">#content</tt> element when the page&nbsp;loads.</p>
</div>
<div class="section" id="the-react-only-version">
<h2><a class="toc-backref" href="#id4">The react-only&nbsp;version</a></h2>
<p>The first version, using only react (and not flux) will use <tt class="docutils literal">BookPanel</tt> as a central information <span class="caps">HUB</span>.</p>
<div class="section" id="searchpanel">
<h3><a class="toc-backref" href="#id5"><tt class="docutils literal">SearchPanel</tt></a></h3>
<p><tt class="docutils literal">SearchPanel</tt> renders an input element with a value defined by the <tt class="docutils literal">search</tt> key of this component&#8217;same
properties. When this is changed the <tt class="docutils literal">onSearchChanged</tt> method of the component will be called, which in turn,
retrieves the value of the input (using refs) and passes it to the properties <tt class="docutils literal">onSearchChanged</tt> callback function.
Finally, with the line <tt class="docutils literal"><span class="pre">{this.props.search?&lt;button</span> <span class="pre">onClick={this.props.onClearSearch}</span> <span class="pre">&gt;x&lt;/button&gt;:null}</span></tt>
we check if the search property contains any text and if yes, we display a clear filter button that will call
properties onClearSearch&nbsp;method:</p>
<pre class="code literal-block">
var SearchPanel = React.createClass({
  render: function() {
    return (
      &lt;div className=&quot;row&quot;&gt;
        &lt;div className=&quot;one-fourth column&quot;&gt;
          Filter: &amp;nbsp;
          &lt;input ref='search' type='text' value={this.props.search} onChange={this.onSearchChanged} /&gt;
          {this.props.search?&lt;button onClick={this.props.onClearSearch} &gt;x&lt;/button&gt;:null}
        &lt;/div&gt;
      &lt;/div&gt;
    )
  },
  onSearchChanged: function() {
    var query = React.findDOMNode(this.refs.search).value;
    this.props.onSearchChanged(query);
  }
});
</pre>
<p>So, this component has three&nbsp;properties:</p>
<ul class="simple">
<li>search which is the text to display in the input&nbsp;box</li>
<li>onSearchChanged (callback) which is called when the contents of the input box are&nbsp;changed</li>
<li>onClearSearch (callback) which is called when the button is&nbsp;pressed</li>
</ul>
<p>Notice that this component doesn&#8217;t do anything - for all actions it uses the callbacks passed to it &#8212;this
means that exactly the same component would easily be reused in a totally different application or could
be duplicated if we wanted to have a different search component for the book title and&nbsp;category.</p>
<p>Another thing to notice is that the local <tt class="docutils literal">onSearchChanged</tt> method is defined only to help us retrieve the
value of the input and use it to call the <tt class="docutils literal">onSearchChanged</tt> callback. Instead, we could just call the
passed
<tt class="docutils literal">this.props.onSearchChanged</tt> &#8212; however to do this we&#8217;d need a way to find the value of the input. This
could be done if we added a ref to the included <tt class="docutils literal">SearchPanel</tt> from the parent component, so
we&#8217;d be able to use something like
<tt class="docutils literal"><span class="pre">React.findDOMNode(this.refs.searchPanel.refs.search).value</span></tt> to find out the value of the input
(see that we use a ref to go to the searchPanel component and another ref to go to input&nbsp;component).</p>
<p>Both versions (getting the value directly from the child component or using the callback) could be used, however I
believe that the callback version defines a more clear interface since the parent component shouldn&#8217;t need
to know the implementation details of its&nbsp;children.</p>
</div>
<div class="section" id="booktablerow">
<h3><a class="toc-backref" href="#id6"><tt class="docutils literal">BookTableRow</tt></a></h3>
<p><tt class="docutils literal">BookTableRow</tt> will render a table row by creating a simple table row that will contain the <tt class="docutils literal">title</tt>
and <tt class="docutils literal">category</tt> attributes of the passed book property and an edit link that will call the <tt class="docutils literal">handleEditClickPanel</tt>
property by passing the id of that&nbsp;book:</p>
<pre class="code literal-block">
var BookTableRow = React.createClass({
  render: function() {
    return (
      &lt;tr&gt;
        &lt;td&gt;{this.props.book.title}&lt;/td&gt;
        &lt;td&gt;{this.props.book.category}&lt;/td&gt;
        &lt;td&gt;&lt;a href='#' onClick={this.onClick}&gt;Edit&lt;/a&gt;&lt;/td&gt;
      &lt;/tr&gt;
    );
  },
  onClick: function(id) {
    this.props.handleEditClickPanel(this.props.book.id);
  }
});
</pre>
<p>This component is used by <tt class="docutils literal">BookTable</tt> to render each one of the&nbsp;books.</p>
</div>
<div class="section" id="booktable">
<h3><a class="toc-backref" href="#id7"><tt class="docutils literal">BookTable</tt></a></h3>
<p>This component create the left-side table using an array of <tt class="docutils literal"><span class="pre">BookTableRow``s</span> by passing it each one of the
books of the ``books</tt> array property. The <tt class="docutils literal">handleEditClickPanel</tt>
property is retrieved from the parent of the component and passed as is to the&nbsp;row.</p>
<pre class="code literal-block">
var BookTable = React.createClass({
  render: function() {
    var rows = [];
    this.props.books.forEach(function(book) {
      rows.push(&lt;BookTableRow key={book.id} book={book} handleEditClickPanel={this.props.handleEditClickPanel}  /&gt;);
    }.bind(this));
    return (
      &lt;table&gt;
        &lt;thead&gt;
          &lt;tr&gt;
            &lt;th&gt;Title&lt;/th&gt;
            &lt;th&gt;Category&lt;/th&gt;
            &lt;th&gt;Edit&lt;/th&gt;
          &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;{rows}&lt;/tbody&gt;
      &lt;/table&gt;
    );
  }
});
</pre>
<p>The key attribute is used by React to uniquely identify each component - we are using the id (primary key)
of each book. Before continuing with the other components, I&#8217;d like to explain what is the purpose of that
strange <tt class="docutils literal">bind</tt> call!</p>
</div>
<div class="section" id="interlude-the-bind-function-method">
<h3><a class="toc-backref" href="#id8">Interlude: The <tt class="docutils literal">bind</tt> function&nbsp;method</a></h3>
<p><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind">bind</a> is a method of the function javascript object, since in javascript <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function">functions are objects</a>! This
method is useful for a number of things, however here we use it to set the <tt class="docutils literal">this</tt> keyword of the
anonymous function that is passed to foreach to the <tt class="docutils literal">this</tt> keyword of the <tt class="docutils literal">render</tt> method of <tt class="docutils literal">BookTable</tt>,
which will be the current BookTable&nbsp;instance.</p>
<p>To make things crystal: Since we are using an anonymous function to pass to <tt class="docutils literal">forEach</tt>, this anonymous
function won&#8217;t have a <tt class="docutils literal">this</tt> keyword set to the current <tt class="docutils literal">BookTable</tt> object so we will get an error
that <tt class="docutils literal">this.props</tt> is undefined. That&#8217;s why we use bind to set <tt class="docutils literal">this</tt> to the current <tt class="docutils literal">BookTable</tt>. If
instead of using the anonymous function we had created a <tt class="docutils literal">createBookTableRow</tt> method inside the
<tt class="docutils literal">BookTable</tt> object that returned the <tt class="docutils literal">BookTableRow</tt> and passed <tt class="docutils literal">this.createBookTableRow</tt> to
<tt class="docutils literal">forEach</tt>, we wouldn&#8217;t have to use bind (notice that we&#8217;d also need to make rows a class attribute
and  refer to it through <tt class="docutils literal">this.rows</tt> for this to&nbsp;work).</p>
</div>
<div class="section" id="bookform">
<h3><a class="toc-backref" href="#id9"><tt class="docutils literal">BookForm</tt></a></h3>
<p><tt class="docutils literal">BookForm</tt> will create a form to either create a new book or update/delete an existing one. It has a <tt class="docutils literal">book</tt> object
property - when this object has an <tt class="docutils literal">id</tt> (so it is saved to the database) the update/delete/cancel buttons will be shown,
when it doesn&#8217;t have an id the add button will be&nbsp;shown.</p>
<pre class="code literal-block">
var BookForm = React.createClass({
  render: function() {
    return(
      &lt;form onSubmit={this.props.handleSubmitClick}&gt;
        &lt;label forHtml='title'&gt;Title&lt;/label&gt;&lt;input ref='title' name='title' type='text' value={this.props.book.title} onChange={this.onChange}/&gt;
        &lt;label forHtml='category'&gt;Category&lt;/label&gt;
        &lt;select ref='category' name='category' value={this.props.book.category} onChange={this.onChange} &gt;
          &lt;option value='CRIME' &gt;Crime&lt;/option&gt;
          &lt;option value='HISTORY'&gt;History&lt;/option&gt;
          &lt;option value='HORROR'&gt;Horror&lt;/option&gt;
          &lt;option value='SCIFI'&gt;SciFi&lt;/option&gt;
        &lt;/select&gt;
        &lt;br /&gt;
        &lt;input type='submit' value={this.props.book.id?&quot;Save (id = &quot; +this.props.book.id+ &quot;)&quot;:&quot;Add&quot;} /&gt;
        {this.props.book.id?&lt;button onClick={this.props.handleDeleteClick}&gt;Delete&lt;/button&gt;:null}
        {this.props.book.id?&lt;button onClick={this.props.handleCancelClick}&gt;Cancel&lt;/button&gt;:null}
        {this.props.message?&lt;div&gt;{this.props.message}&lt;/div&gt;:null}
      &lt;/form&gt;
    );
  },
  onChange: function() {
    var title = React.findDOMNode(this.refs.title).value;
    var category = React.findDOMNode(this.refs.category).value;
    this.props.handleChange(title, category);
  }
});
</pre>
<p>As we can see, this component uses many properties &#8212; most are passed callbacks functions for various&nbsp;actions:</p>
<ul class="simple">
<li><tt class="docutils literal">book</tt>: This will either be a new book object (without and id) when adding one or an existing (from the database) book when updating&nbsp;one.</li>
<li><tt class="docutils literal">message</tt>: To display the result of the last operation (save/delete) &#8212; this is passed by the parent and probably it would be better if I had put it in a different component (and added styling&nbsp;etc).</li>
<li><tt class="docutils literal">handleSubmitClick</tt>: Will be called when the submit button is pressed to save the form (either by adding or&nbsp;updating).</li>
<li><tt class="docutils literal">handleCancelClick</tt>: Will be called when the cancel button is pressed &#8212; we decide that we want actually want to edit a&nbsp;book.</li>
<li><tt class="docutils literal">handleDeleteClick</tt>: Will be called when the delete button is&nbsp;pressed.</li>
<li><tt class="docutils literal">handleChange</tt>: Will be called whenever the title or the category of the currently edited book is changed through the local onChange method. The onChange will retrieve that values of title and category and pass them to handleChange to do the state update. As already discussed, we could retrieve the values immediately from the parent but this creates a better interface to our&nbsp;component.</li>
</ul>
</div>
<div class="section" id="bookpanel">
<h3><a class="toc-backref" href="#id10"><tt class="docutils literal">BookPanel</tt></a></h3>
<p>The <tt class="docutils literal">BookPanel</tt> component will contain all other components, will keep the global state
and will also act as a central communications <span class="caps">HUB</span> between the components and the server. Because
it is rather large class, I will explain it in three&nbsp;parts:</p>
<div class="section" id="component-methods">
<h4><a class="toc-backref" href="#id11">Component&nbsp;methods</a></h4>
<p>In the first part of <tt class="docutils literal">BookPanel</tt>, its react component methods will be&nbsp;presented:</p>
<pre class="code literal-block">
var BookPanel = React.createClass({
  getInitialState: function() {
    return {
      books: [],
      editingBook: {
        title:&quot;&quot;,
        category:&quot;&quot;,
      },
      search:&quot;&quot;,
      message:&quot;&quot;
    };
  },
  render: function() {
    return(
      &lt;div className=&quot;row&quot;&gt;
        &lt;div className=&quot;one-half column&quot;&gt;
          &lt;SearchPanel
            search={this.state.search}
            onSearchChanged={this.onSearchChanged}
            onClearSearch={this.onClearSearch}
          /&gt;
          &lt;BookTable books={this.state.books} handleEditClickPanel={this.handleEditClickPanel} /&gt;
        &lt;/div&gt;
        &lt;div className=&quot;one-half column&quot;&gt;
          &lt;BookForm
            book={this.state.editingBook}
            message={this.state.message}
            handleChange={this.handleChange}
            handleSubmitClick={this.handleSubmitClick}
            handleCancelClick={this.handleCancelClick}
            handleDeleteClick={this.handleDeleteClick}
          /&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    );
  },
  componentDidMount: function() {
    this.reloadBooks('');
  },
  // To be continued ...
</pre>
<p><tt class="docutils literal">getInitialState</tt> is called the first time the component is created or mounted (attached to an <span class="caps">HTML</span> component in the page
and should return the initial values of the state - here we return an object with empty placeholders. <tt class="docutils literal">componentDidMount</tt>
will be called <em>after</em> the component is mounted and that&#8217;s the place we should do any initializationn &#8212; here we call the
<tt class="docutils literal">reloadBooks</tt> method (with an empty search string) to just retrieve all books. Finally, the <tt class="docutils literal">render</tt> method creates a
<tt class="docutils literal">div</tt> that will contain all other components and initializes their properties with either state variables or object methods
(these are the callbacks that were used in all other&nbsp;components).</p>
</div>
<div class="section" id="non-ajax-object-methods">
<h4><a class="toc-backref" href="#id12">Non-ajax object&nbsp;methods</a></h4>
<pre class="code literal-block">
// Continuing from above
onSearchChanged: function(query) {
  if (this.promise) {
    clearInterval(this.promise)
  }
  this.setState({
    search: query
  });
  this.promise = setTimeout(function () {
    this.reloadBooks(query);
  }.bind(this), 200);
},
onClearSearch: function() {
  this.setState({
    search: ''
  });
  this.reloadBooks('');
},
handleEditClickPanel: function(id) {
  var book = $.extend({}, this.state.books.filter(function(x) {
    return x.id == id;
  })[0] );

  this.setState({
    editingBook: book,
    message: ''
  });
},
handleChange: function(title, category) {
  this.setState({
    editingBook: {
      title: title,
      category: category,
      id: this.state.editingBook.id
    }
  });
},
handleCancelClick: function(e) {
  e.preventDefault();
  this.setState({
    editingBook: {}
  });
},
// to be continued ...
</pre>
<p>All the above function change the <tt class="docutils literal">BookPanel</tt> state so that the properties of the child components will
also be&nbsp;updated:</p>
<ul class="simple">
<li><tt class="docutils literal">onSearchChanged</tt> is called when the search text is changed. The behavior here is interesting: Instead of immediately reloading the books, we create a timeout to be executed after 200 ms (also notice the usage of the <tt class="docutils literal">bind</tt> function method to allow us call the <tt class="docutils literal">reloadBooks</tt> method). If the user presses a key before these 200 ms, we cancel the previous timeout (using <tt class="docutils literal">clearInterval</tt>) and create a new one. This technique greatly reduces ajax calls to the server when the user is just typing something in the search box &#8212; we could even increase the delay to reduce even more the ajax calls (but hurt the user experience a bit since the user will notice that his search results won&#8217;t be updated&nbsp;immediately).</li>
<li><tt class="docutils literal">onClearSearch</tt> is called when the clear filter button is pressed and removes the search text and reloads all&nbsp;books.</li>
<li><tt class="docutils literal">handleEditClickPanel</tt> is called when the edit link of a <tt class="docutils literal">BookTableRow</tt> is clicked. The book with the passed <tt class="docutils literal">id</tt> will be found (using filter) and then a clone of it will be created with (<tt class="docutils literal">$.extend</tt>) and will be used to set the <tt class="docutils literal">editingBook</tt> state attribute. If instead of the clone we passed the filtered book object we&#8217;d see that when the title or category in the <tt class="docutils literal">BookForm</tt> were changed they&#8217;d also be changed in the <tt class="docutils literal">BookTableRow</tt>!</li>
<li><tt class="docutils literal">handleChange</tt> just changes the state of the currently edited book based on the values passed (it does not modify the id of the&nbsp;book)</li>
<li><tt class="docutils literal">handleCancelClick</tt> when the cancel editing is pressed we clear the <tt class="docutils literal">editingBook</tt> state attribute. Notice the <tt class="docutils literal">e.preventDefault()</tt> method that needs to be there in order to prevent the form from submitting since the form submitting would result in an undesirable full page&nbsp;reload!</li>
</ul>
</div>
<div class="section" id="ajax-object-methods">
<h4><a class="toc-backref" href="#id13">Ajax object&nbsp;methods</a></h4>
<p>Finally, we need a buncch of object methods that use ajax calls to retrieve or update&nbsp;books:</p>
<pre class="code literal-block">
  // Continuing from above
  reloadBooks: function(query) {
    $.ajax({
      url: this.props.url+'?search='+query,
      dataType: 'json',
      cache: false,
      success: function(data) {
        this.setState({
          books: data
        });
      }.bind(this),
      error: function(xhr, status, err) {
        console.error(this.props.url, status, err.toString());
        this.setState({
          message: err.toString(),
          search: query
        });
      }.bind(this)
    });
  },
  handleSubmitClick: function(e) {
    e.preventDefault();
    if(this.state.editingBook.id) {
      $.ajax({
        url: this.props.url+this.state.editingBook.id,
        dataType: 'json',
        method: 'PUT',
        data:this.state.editingBook,
        cache: false,
        success: function(data) {
          this.setState({
            message: &quot;Successfully updated book!&quot;
          });
          this.reloadBooks('');
        }.bind(this),
        error: function(xhr, status, err) {
          console.error(this.props.url, status, err.toString());
          this.setState({
            message: err.toString()
          });
        }.bind(this)
      });
    } else {
      $.ajax({
        url: this.props.url,
        dataType: 'json',
        method: 'POST',
        data:this.state.editingBook,
        cache: false,
        success: function(data) {
          this.setState({
            message: &quot;Successfully added book!&quot;
          });
          this.reloadBooks('');
        }.bind(this),
        error: function(xhr, status, err) {
          console.error(this.props.url, status, err.toString());
          this.setState({
            message: err.toString()
          });
        }.bind(this)
      });
    }
    this.setState({
      editingBook: {}
    });
  },
  handleDeleteClick: function(e) {
  e.preventDefault();
  $.ajax({
    url: this.props.url+this.state.editingBook.id,
    method: 'DELETE',
    cache: false,
    success: function(data) {
      this.setState({
          message: &quot;Successfully deleted book!&quot;,
          editingBook: {}
      });
      this.reloadBooks('');
    }.bind(this),
    error: function(xhr, status, err) {
      console.error(this.props.url, status, err.toString());
      this.setState({
          message: err.toString()
      });
    }.bind(this)
    });
  },
});
</pre>
<ul class="simple">
<li><tt class="docutils literal">reloadBooks</tt> will try to load the books using an ajax <span class="caps">GET</span> and pass its query parameter to filter the books (or get all books if query is an empty string). If the ajax call was successfull the state will be updated with the retrieved books and the search text (to clear the  search text when we reload because of a save/edit/delete) while if there was an error the state will be updated with the error message. The books will be returned as a json array of book&nbsp;objects.</li>
<li><tt class="docutils literal">handleSubmitClick</tt> checks if the state&#8217;s <tt class="docutils literal">editingBook</tt> has an id and  will do either a <span class="caps">POST</span> to create a new book or a <span class="caps">PUT</span> to update the existing one. Depending on the result of the operation will either reload books and clear the editingBook or set the error&nbsp;message.</li>
<li><tt class="docutils literal">handleDeleteClick</tt> will do a <span class="caps">DELETE</span> to delete the state&#8217;s <tt class="docutils literal">editingBook</tt> and clear&nbsp;it.</li>
</ul>
<p>Notice that all success and error functions above were binded to <tt class="docutils literal">this</tt> so that they could update the state of the current <tt class="docutils literal">BookPanel</tt> object.</p>
<p>After each succesfull ajax call we do a reload to the books to keep the state between server and client side consistent. We could
instead update the book array immediately before doing the ajax call - however this would increase complexity
(what should happen if an error happens at the ajax call) without improving the <span class="caps">UX</span> that much. A better solution
would be to add a loading css&nbsp;animation.</p>
</div>
</div>
</div>
<div class="section" id="local-state">
<h2><a class="toc-backref" href="#id14">Local&nbsp;state</a></h2>
<p>One thing to keep in mind is that there should only be one place of truth for the state and
that the state should be as high in the component hierarch as possible. All changes should
be propagated to thhe child components through properties.
That&#8217;s the only way to be sure of the your data flow: When a change should happen
(either because of a user action or an asynchronous call e.g ajax or timeout) just
go to the state-holding component up in the hierarchy and change its state. Then the
changes will be propagated in a top-down fashion from that component to its&nbsp;children.</p>
<p>The above paragraph does not mean that the state should be contained in just a single
component! For example, let&#8217;s say that we had an <tt class="docutils literal">AuthorPanel</tt> in the same web application
and both <tt class="docutils literal">BookPanel</tt> and <tt class="docutils literal">AuthorPanel</tt> would be contained in a <tt class="docutils literal">BookAuthorPanel</tt>.
In this case, we should keep a different state object for <tt class="docutils literal">BookPanel</tt> and <tt class="docutils literal">AuthorPanel</tt>,
we wouldn&#8217;t need to combine them into a single object contained in the <tt class="docutils literal">BookAuthorPanel</tt>
since they are&nbsp;unrelated!</p>
<p>One decision that we took in <tt class="docutils literal">BookForm</tt> (and also to the <tt class="docutils literal">SearchPanel</tt> before) is to <em>not</em> keep a local state for the
book that is edited but move it to <tt class="docutils literal">BookPanel</tt>. This means that whenever the value of the <tt class="docutils literal">title</tt> or <tt class="docutils literal">category</tt> is changed the parent
component will be informed (through <tt class="docutils literal">handleChange</tt>) so that it will change its state and the new values will
be passed down to <tt class="docutils literal">BookForm</tt> as properties so our changes will be reflected to the inputs. To make it more
clear, when you press a letter on the <tt class="docutils literal">title</tt> input:</p>
<ul class="simple">
<li>the <tt class="docutils literal">onChange</tt> method of <tt class="docutils literal">BookForm</tt> will be&nbsp;called,</li>
<li>it will get the values of both <tt class="docutils literal">title</tt> and <tt class="docutils literal">category</tt> fields</li>
<li>and call <tt class="docutils literal">handleChange</tt> with these&nbsp;values.</li>
<li>The <tt class="docutils literal">handleChange</tt> method of  <tt class="docutils literal">BookPanel</tt> will update the <tt class="docutils literal">editingBook</tt> state&nbsp;attribute,</li>
<li>so the <tt class="docutils literal">book</tt> property of <tt class="docutils literal">BookForm</tt> will be also&nbsp;updated</li>
<li>and the new value of the <tt class="docutils literal">title</tt> will be displayed (since the components will be re-rendered due to the state&nbsp;update)</li>
</ul>
<p>Conceptually, the above seems like a lot of work for just pressing a simple key! However, due to how react
is implemented (virtual <span class="caps">DOM</span>) it won&#8217;t actually introduce any performance problems in our application.
If nevertheless we wanted to have a local state of the currently edited book inside the <tt class="docutils literal">BookForm</tt> then we&#8217;d need to use
<tt class="docutils literal">state.book</tt> and update the state using the <tt class="docutils literal">componentWillReceiveProps</tt> method of <tt class="docutils literal">BookForm</tt>: If we
have a book to edit in the properties then copy it to the state or else just create an empty book. Also,
the <tt class="docutils literal">onChange</tt> method of the <tt class="docutils literal">BookForm</tt> won&#8217;t need to notify the parent component that there is a
state change (but only update the local state) and of course when the submit button is pressed the
current book should be passed to the parent component (to either save it or delete it) since it won&#8217;t
know the book that is currently&nbsp;edited.</p>
<p>So we could either have a local state object for the edited book in the <tt class="docutils literal">BookForm</tt> or
just save it as a property of the global state object in <tt class="docutils literal">BookPanel</tt> &#8212; both solutions are
correct. What wouldn&#8217;t be correct is if we had two copies of the same information in both the
states of <tt class="docutils literal">BookPanel</tt> and <tt class="docutils literal">BookForm</tt>, for example the book id that is&nbsp;edited.</p>
</div>
<div class="section" id="conclusion-to-the-first-part">
<h2><a class="toc-backref" href="#id15">Conclusion to the first&nbsp;part</a></h2>
<p>We just created a not-so-simple React single page application offering <span class="caps">CRUD</span> for an object.
This application of course could be improved by adding a pagination component to the table,
but I&#8217;m going to leave that as an excersie to the reader: To do that, I propose to create
another component named <tt class="docutils literal">TablePager</tt> that would have two properties: <tt class="docutils literal">currentPage</tt> and
a <tt class="docutils literal">changePageTo</tt> callback. The <tt class="docutils literal">currentPage</tt> would also be needed to added to the global
state. When the <tt class="docutils literal">changePageTo` is called by the ``TablePager</tt> it would update the global
<tt class="docutils literal">currentPage</tt> and will do a <tt class="docutils literal">reloadBooks</tt> that will use the <tt class="docutils literal">currentPage</tt> to fetch
the correct&nbsp;page.</p>
<p>For application state keeping, we have selected to store all state attributes in <tt class="docutils literal">BookPanel</tt>,
for every state changing action we create a method that we pass in the child components
so that the children can call it when the state needs to be&nbsp;updated.</p>
<p>As we will see in the next part, with Flux, Facebook proposes a design pattern for
where to store the state and how to update it. We&#8217;ll see how to convert our React
application to also use Flux and find out how Flux will help us when developing
complex client-side&nbsp;applications!</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="http://spapas.github.io/2015/05/27/using-browserify-watchify/">Using browserify and watchify to improve your client-side-javascript workflow</a>
      </h1>
    <p class="meta">
<time datetime="2015-05-27T14:20:00+03:00" pubdate>Τετ 27 Μάιος 2015</time>    </p>
</header>

  <div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#the-problem" id="id1">The&nbsp;problem</a></li>
<li><a class="reference internal" href="#the-solution" id="id2">The&nbsp;solution</a></li>
<li><a class="reference internal" href="#installing-required-tools" id="id3">Installing required&nbsp;tools</a></li>
<li><a class="reference internal" href="#starting-your-node-js-project" id="id4">Starting your (node.js)&nbsp;project</a></li>
<li><a class="reference internal" href="#running-browserify-for-the-first-time" id="id5">Running browserify for the first&nbsp;time</a></li>
<li><a class="reference internal" href="#using-external-libraries" id="id6">Using external&nbsp;libraries</a></li>
<li><a class="reference internal" href="#introducing-watchify" id="id7">Introducing&nbsp;watchify</a></li>
<li><a class="reference internal" href="#creating-your-own-modules" id="id8">Creating your own&nbsp;modules</a></li>
<li><a class="reference internal" href="#uglifying-your-bundle" id="id9">Uglifying your&nbsp;bundle</a></li>
<li><a class="reference internal" href="#the-client-side-javascript-workflow" id="id10">The client-side javascript&nbsp;workflow</a></li>
<li><a class="reference internal" href="#conlusion" id="id11">Conlusion</a></li>
</ul>
</div>
<div class="section" id="the-problem">
<h2><a class="toc-backref" href="#id1">The&nbsp;problem</a></h2>
<p>Once upon a time, when people started using client-side code to their projects they (mainly
due to the lack of decent client-side libraries but also because of the <a class="reference external" href="http://en.wikipedia.org/wiki/Not_invented_here"><span class="caps">NIH</span> syndrome</a>)
were just adding their own code in script nodes or .js files using <tt class="docutils literal">document.getElementById</tt> to manipulate
the <span class="caps">DOM</span> (good luck checking for all possible browser-edge cases)
and <tt class="docutils literal">window.XMLHttpRequest</tt> to try doing <span class="caps">AJAX</span>.</p>
<p>After these dark-times, the
age of javascript-framework came: prototype, jquery, dojo. These were (and still are)
some great libraries (even <span class="caps">NIH</span>-sick people used them to handle browser incompatibilities):
You just downloaded the .js file with the framework, put it inside your project
static files and added it to your page with a script tag and then filled your client-side
code with funny $(&#8216;#id&#8217;)&nbsp;symbols!</p>
<p>Coming to the modern age in client-side development, the number of decent libraries has greatly increased
and instead of monolithic frameworks there are different libraries for different needs. So instead of
just downloading a single file and adding the script node for that file to your <span class="caps">HTML</span>, you need to
download the required javascript files, put them all in your static files directory and then micro-manage
the script nodes for each of your pages depending on which libraries each page needs! So if you want
to use (for example) moment.js to your client-side code you need to go to <em>all</em> <span class="caps">HTML</span> pages that use that
specific client-side code and add a moment.js-script&nbsp;element!</p>
<p>As can be understood this leads to really ugly situations like people avoiding refactoring their code to use
external libraries, using a single-global module  with all their client side code, using <span class="caps">CDN</span> to avoid
downloading the javascript libraries and of course never upgrade their javascript&nbsp;libraries!</p>
</div>
<div class="section" id="the-solution">
<h2><a class="toc-backref" href="#id2">The&nbsp;solution</a></h2>
<p><a class="reference external" href="http://browserify.org/">browserify</a> and <a class="reference external" href="https://github.com/substack/watchify">watchify</a> are two sister tools from the server-side-javascript (node.js and friends)
world that greatly improve your javascript workflow: Using them, you no longer need to micro-manage
your script tags but instead you just declare the libraries each of your client-side modules is
using - or you can even create your own reusable modules! Also, installing (or updating) javascript
libraries is as easy as running a single&nbsp;command!</p>
<p>How are they working? With browserify you create a single <tt class="docutils literal">main.js</tt> for each of your <span class="caps">HTML</span>
pages and in it you declare its requirements using <a class="reference external" href="https://github.com/substack/browserify-handbook#require">require</a>. You&#8217;ll then pass your <tt class="docutils literal">main.js</tt>
through browserify and it will create a single file (e.g <tt class="docutils literal">bundle.js</tt>) that contains all the requirements
(of course each requirement could have other requirements - they&#8217;ll be automatically also
included in the resulting .js file). That&#8217;s the <em>only</em> file you need to put to the script tag of
your <span class="caps">HTML</span>! Using watchify, you can <em>watch</em> your <tt class="docutils literal">main.js</tt> for changes (the changes may also
be in the files included from main.js) and automatically generate the resulting <tt class="docutils literal">bundle.js</tt> so that
you&#8217;ll just need to hit F5 to refresh and get the new&nbsp;version!</p>
<p>browserify not only concatenates your javascript libraries to a single bundle but can also transform
your coffesscript, typescript, jsx etc files to javascrpt and <em>then</em> also add them to the bundle. This
is possible through a concept called transforms &#8212; there are <a class="reference external" href="https://github.com/substack/node-browserify/wiki/list-of-transforms">a lot of transforms</a> that you can&nbsp;use.</p>
<p>Below, I will propose a really simple and generic workflow that should cover most of your javascript needs.
I should mention that I mainly develop django apps and my development machine is running windows, however you
can easily use exactly the  same workflow from any kind of server-side technology (ruby, python, javascript,
java, php or even static <span class="caps">HTML</span> pages!) or development machine (windows, linux, osx) - it&#8217;s exactly the&nbsp;same!</p>
</div>
<div class="section" id="installing-required-tools">
<h2><a class="toc-backref" href="#id3">Installing required&nbsp;tools</a></h2>
<p>As already mentioned, you need two node.js tools. Just install them globally using npm (installing
node.js and npm is really easy - there&#8217;s even <a class="reference external" href="https://nodejs.org/download/">a package for windows</a>):</p>
<pre class="code literal-block">
npm install -g browserify watchify
</pre>
<p>The <tt class="docutils literal"><span class="pre">-g</span></tt> switch installs the packages globally so you can use the browserify and watchify commands from
your command prompt - after that entering <tt class="docutils literal">browserify</tt> or <tt class="docutils literal">watchify</tt> from your command prompt should be&nbsp;working.</p>
</div>
<div class="section" id="starting-your-node-js-project">
<h2><a class="toc-backref" href="#id4">Starting your (node.js)&nbsp;project</a></h2>
<p>Although you may already have a project structure, in order to use browserify you&#8217;ll need to
create a node.js project (project from now on) that needs just two&nbsp;things:</p>
<ul class="simple">
<li>a <tt class="docutils literal">package.json</tt> that lists various options for your&nbsp;project</li>
<li>a <tt class="docutils literal">node_modules</tt> directory that contains the packages that your project&nbsp;uses</li>
</ul>
<p>To create the <tt class="docutils literal">package.json</tt> you can either copy paste a simple one or run <tt class="docutils literal">npm init</tt> inside
a folder of your project. After <tt class="docutils literal">npm init</tt> you&#8217;ll need to answer a bunch of questions and then
a <tt class="docutils literal">package.json</tt> will be created to the same folder. If you don&#8217;t want to answer these questions
(most probably you only want to use node.js for browserify - instead you wouldn&#8217;t be reading
this) then just put an empty json string <tt class="docutils literal">{}</tt> in <tt class="docutils literal">package.json</tt>.</p>
<p>I recommend adding <tt class="docutils literal">package.json</tt> to the top-level folder of your version-controlled souce-code tree -
please put this file in your version control - the <tt class="docutils literal">node_modules</tt> directory will be be created
to the same directory with <tt class="docutils literal">package.json</tt> and should be ignored by your version&nbsp;control.</p>
</div>
<div class="section" id="running-browserify-for-the-first-time">
<h2><a class="toc-backref" href="#id5">Running browserify for the first&nbsp;time</a></h2>
<p>Not the time has come to create a <tt class="docutils literal">main.js</tt> file. This could be put anywhere you like (based on your project structure) -
I&#8221; suppose that <tt class="docutils literal">main.js</tt> is inside the <tt class="docutils literal">src/</tt>  folder of your project.
Just put a <tt class="docutils literal"><span class="pre">console.log(&quot;Hello,</span> world&quot;)</tt> to the <tt class="docutils literal">main.js</tt> for now. To test that everything is working,&nbsp;run:</p>
<pre class="code literal-block">
browserify src/main.js
</pre>
<p>You should see some minified-js gibberish to your console (something like <tt class="docutils literal">(function <span class="pre">e(t,n,r){function</span> <span class="pre">s(o,u){if(!n[o]){if(!t[o]){var</span> a=typeof <span class="pre">...)</span></tt>
) which means that everything works fine. Now, create a <tt class="docutils literal">dist</tt> directory which would contain your bundle files and&nbsp;run</p>
<pre class="code literal-block">
browserify src/main.js -o dist/bundle.js
</pre>
<p>the -o switch will put the the same minified-js gibberish output to the  <tt class="docutils literal">dist/bundle.js</tt> file instead of stdout.
Finally, include a script element with that file to your <span class="caps">HTML</span> and you
should see &quot;Hello, world&quot; to your javascript console when opening the <span class="caps">HTML</span>&nbsp;file!</p>
</div>
<div class="section" id="using-external-libraries">
<h2><a class="toc-backref" href="#id6">Using external&nbsp;libraries</a></h2>
<p>To use a library from your main.js you need to install it and get a reference to it through require. Let&#8217;s try to use <a class="reference external" href="http://momentjs.com/">moment.js</a>:
To install the library&nbsp;run</p>
<pre class="code literal-block">
npm install moment --save
</pre>
<p>This will create a moment directory inside node_modules that will contain the moment.js library. It will also add a
dependency to your <tt class="docutils literal">package.json</tt> (that&#8217;s what the <tt class="docutils literal"><span class="pre">--save</span></tt> switch does), something like&nbsp;this:</p>
<pre class="code literal-block">
&quot;dependencies&quot;: {
  &quot;moment&quot;: &quot;^2.10.3&quot;
}
</pre>
<p>Whenever you install more client-side libraries they&#8217;ll be saved there. When you want to re-install everything (for instance
when you clone your project) you can just do&nbsp;a</p>
<pre class="code literal-block">
npm install
</pre>
<p>and all dependencies of <tt class="docutils literal">package.json</tt> will be installed in <tt class="docutils literal">node_modules</tt> (that&#8217;s why <tt class="docutils literal">node_modules</tt> should not be&nbsp;tracked).</p>
<p>After you&#8217;ve installed moment.js to your project change <tt class="docutils literal">src/main.js</tt> to:</p>
<pre class="code literal-block">
moment = require('moment')
console.log(moment() );
</pre>
<p>and rerun <tt class="docutils literal">browserify src/main.js <span class="pre">-o</span> dist/bundle.js</tt>. When you reload your <span class="caps">HTML</span> you&#8217;ll see the that you are able to use
moment - all this without changing your <span class="caps">HTML</span>!!!</p>
<p>As you can understand, in order to use a library with browserify, this library must support it by having an npm package. The nice thing is that
most libraries already support it &#8212; let&#8217;s try for another example to use <a class="reference external" href="http://underscorejs.org/">underscore.js</a> and (for some reason) we need version underscore 1.7&nbsp;:</p>
<pre class="code literal-block">
npm install underscore&#64;1.7--save
</pre>
<p>you&#8217;ll se that your package.json dependencies will also contain underscore.js&nbsp;1.7:</p>
<pre class="code literal-block">
{
  &quot;dependencies&quot;: {
    &quot;moment&quot;: &quot;^2.10.3&quot;,
    &quot;underscore&quot;: &quot;^1.7.0&quot;
  }
}
</pre>
<p>If you want to upgrade underscore to the latest version run&nbsp;a:</p>
<pre class="code literal-block">
npm install underscore --upgrade --save
</pre>
<p>and you&#8217;ll see that your <tt class="docutils literal">package.json</tt> will contan the latest version of&nbsp;underscore.js.</p>
<p>Finally, let&#8217;s change our <tt class="docutils literal">src/man.js</tt> to use&nbsp;underscore:</p>
<pre class="code literal-block">
moment = require('moment')
_ = require('underscore')

_([1,2,3]).map(function(x) {
  console.log(x+1);
});
</pre>
<p>After you create your bundle you should se 2 3 4 in your&nbsp;console!</p>
</div>
<div class="section" id="introducing-watchify">
<h2><a class="toc-backref" href="#id7">Introducing&nbsp;watchify</a></h2>
<p>Running browserify <em>every</em> time you change your js files to create the <tt class="docutils literal">bundle.js</tt> feels
like doing repetitive work - this is where wachify comes to the rescue; watchify is a
tool that watches your source code and dependencies and when a change is detected it will
recreate the bundle&nbsp;automagically!</p>
<p>To run it, you can&nbsp;use:</p>
<pre class="code literal-block">
watchify src/main.js -o dist/bundle.js -v
</pre>
<p>and you&#8217;ll see something like: <tt class="docutils literal">155544 bytes written to dist/bundle.js (0.57 seconds)</tt> &#8212; try
changing main.js and you&#8217;ll see that bundle.js will also be&nbsp;re-written!</p>
<p>Some things to keep in mind with watchify&nbsp;usage:</p>
<ul class="simple">
<li>The -v flag outputs the verbose text (or else you won&#8217;t se any postive messages) - I like using it to be sure that everything is&nbsp;ok.</li>
<li>You need to use the -o flag with watchify &#8212; you can&#8217;t output to stdout(we&#8217;ll see that this will change our workflow for production a bit&nbsp;later)</li>
<li>watchify takes the same parameters with browserify &#8212; so if you do any transformations with browserify you can also do them with&nbsp;watchify</li>
</ul>
<p>In the following, I&#8217;ll assume that you are running the <tt class="docutils literal">watchify src/main.js <span class="pre">-o</span> dist/bundle.js <span class="pre">-d</span></tt> so your bundles will
always be re-created when changes are&nbsp;found.</p>
</div>
<div class="section" id="creating-your-own-modules">
<h2><a class="toc-backref" href="#id8">Creating your own&nbsp;modules</a></h2>
<p>Using browserify we can create our own modules and <em>require</em> them in other modules using the <tt class="docutils literal">module.exports</tt> mechanism!</p>
<p>Creating a module is really simple: In a normal javascript file either assign directly to module.exports or
include all local objects you want to be visible as an attribute to <tt class="docutils literal">module.exports</tt> &#8212; everything
else will be private to the&nbsp;module.</p>
<p>As an example, let&#8217;s create an <tt class="docutils literal">src/modules</tt> folder and put a file module1.js inside it, containing the&nbsp;following:</p>
<pre class="code literal-block">
var variable = 'variable'
var variable2 = 'variable2'
var funct = function(x) {
  return x+1;
}
var funct2 = function(x) {
  return x+1;
}

module.exports['variable'] = variable
module.exports['funct'] = funct
</pre>
<p>As you see, although we&#8217;ve defined a number of things in that module, only the variable and funct attributes
of module.exports will be visible when the module is used. To use the module, change main.js like&nbsp;this:</p>
<pre class="code literal-block">
module1 = require('./modules/module1')
console.log(module1.funct(9))
</pre>
<p>When you refresh your <span class="caps">HTML</span> you&#8217;ll see 10 in the console. So, require will return the <tt class="docutils literal">module.exports</tt> objects
of each module. It will either search in your project&#8217;s <tt class="docutils literal">node_modules</tt> (when you use just the modfule name,
for example <tt class="docutils literal">moment</tt>, or locally (when you start a path with either <tt class="docutils literal">./</tt> or <tt class="docutils literal">../</tt> &#8212; in our case we required
the module <tt class="docutils literal">module1.js</tt> from the folder <tt class="docutils literal">modules</tt>).</p>
<p>As a final example, we&#8217;ll create another module that is used by module1: Create a file named <tt class="docutils literal">module2.js</tt> inside the
<tt class="docutils literal">modules</tt> folder and the following&nbsp;contents:</p>
<pre class="code literal-block">
var funct = function(x) {
    return x+1;
}

module.exports = funct
</pre>
<p>After that, change <tt class="docutils literal">module1.js</tt> to&nbsp;this:</p>
<pre class="code literal-block">
module2 = require('./module2')

var variable = 'variable'
var funct = function(x) {
    return module2(x)+1;
}

module.exports['variable'] = variable
module.exports['funct'] = funct
</pre>
<p>So <tt class="docutils literal">module1</tt> will import the <tt class="docutils literal">module2</tt> module (from the same directory) and call it (since a function is assignedd to module.exports).
When you refresh your <span class="caps">HTML</span> you should see&nbsp;11!</p>
</div>
<div class="section" id="uglifying-your-bundle">
<h2><a class="toc-backref" href="#id9">Uglifying your&nbsp;bundle</a></h2>
<p>If had taken a look at the file size of your <tt class="docutils literal">bundle.js</tt> when you&#8217;d included moment.js or underscore.js you&#8217;d see
that the file size has been greatly increased. Take a peek at <tt class="docutils literal">bundle.js</tt> and you&#8217;ll see why: The contents of the module files
will be concatenated as they are, without any changes! This may be nice for development / debugging, however for production
we&#8217;d like our bundle.js to be minified &#8212; or uglyfied as it&#8217;s being said in the javascript&nbsp;world.</p>
<p>To help us with this, uglifying we&#8217;ll use <a class="reference external" href="https://www.npmjs.com/package/uglify-js">uglify-js</a>. First of all, please install it&nbsp;globally</p>
<pre class="code literal-block">
npm install uglify-js -g
</pre>
<p>and you&#8217;ll be able to use the <tt class="docutils literal">uglifyjs</tt> command to uglify your bundles! To use the <tt class="docutils literal">uglifyjs</tt> command for your <tt class="docutils literal">bundle.js</tt>
try&nbsp;this</p>
<pre class="code literal-block">
uglifyjs dist\bundle.js  &gt; dist\bundle.min.js
</pre>
<p>and you&#8217;ll see the size of the bundle.min.js greatly reduced! To achieve even better minification (and code mangling as an added
bonus) you could pass the -mc options to&nbsp;uglify:</p>
<pre class="code literal-block">
uglifyjs dist\bundle.js -mc &gt; dist\bundle.min.js
</pre>
<p>and you&#8217;ll see an even smaller&nbsp;bundle.min.js!</p>
<p>As a final step, we can combine the output of browserify and uglify to a single command using a&nbsp;pipe:</p>
<pre class="code literal-block">
browserify src/main.js | uglifyjs -mc &gt; dist/bundle.js
</pre>
<p>this will create the uglified bundle.js! Using the pipe to output to uglifyjs is not possible
with watchify since watchify cannot output to stdout &#8212; however, as we&#8217;ll see in the next section
this is not a real&nbsp;problem.</p>
</div>
<div class="section" id="the-client-side-javascript-workflow">
<h2><a class="toc-backref" href="#id10">The client-side javascript&nbsp;workflow</a></h2>
<p>The proposed client-side javascript workflow uses two commands, one for the development and one
for creating the production&nbsp;bundle.</p>
<p>For the development, we&#8217;ll use watchify since we need to immediately re-create the bundle when a
javascript source file is changed and we don&#8217;t want any&nbsp;uglification:</p>
<pre class="code literal-block">
watchify src/main.js -o dist/bundle.js -v
</pre>
<p>For creating our production bundle, we&#8217;ll use browserify and&nbsp;uglify:</p>
<pre class="code literal-block">
browserify src/main.js  | uglifyjs -mc warnings=false &gt; dist/bundle.js
</pre>
<p>(i&#8217;ve added warnings=false to uglfiyjs to suppress&nbsp;warnings).</p>
<p>The above two commands can either be put to batch files or added to your existing workflow (for example
as <a class="reference external" href="http://www.fabfile.org/">fabric</a> commands if you use fabric). However, since we already have a javascrpt project (i.e a <tt class="docutils literal">package.json</tt>)
we can use that to run these commands. Just add a <tt class="docutils literal">scripts</tt> section to your package.json like&nbsp;this:</p>
<pre class="code literal-block">
{
  &quot;dependencies&quot;: {
    &quot;moment&quot;: &quot;^2.10.3&quot;,
    &quot;underscore&quot;: &quot;^1.8.3&quot;
  },
  &quot;scripts&quot;: {
    &quot;watch&quot;: &quot;watchify src/main.js -o dist/bundle.js -v&quot;,
    &quot;build&quot;: &quot;browserify src/main.js  | uglifyjs -mc warnings=false &gt; dist/bundle.js&quot;
  }
}
</pre>
<p>and you&#8217;ll be able to run <tt class="docutils literal">npm run watch</tt> to start watchifying for changes and <tt class="docutils literal">npm run build</tt> to
create your production&nbsp;bundle!</p>
</div>
<div class="section" id="conlusion">
<h2><a class="toc-backref" href="#id11">Conlusion</a></h2>
<p>In the above we saw two (three if we include uglifyjs) javascript tools that will greatly improve our
javascript workflow. Using these we can easily <em>require</em> (import) external javascript libraries to
our project without any micromanagement of script tags in html files. We also can seperate our own
client-side code to self-contained modules that will only export interfaces and not pollute the global
namespace. The resulting production client-side javascript file will be output minimized and ready to
be used by the users&#8217;&nbsp;browsers.</p>
<p>All the above are possible with minimal changes to our code and development&nbsp;workflow:</p>
<ul class="simple">
<li>create a package.json and install your&nbsp;dependencies</li>
<li>require the external libraries (instead of using them off the global&nbsp;namespace)</li>
<li>define your module&#8217;s interace through module.exports (instead of polluting the global&nbsp;namespace)</li>
<li>change your client javascript files to <tt class="docutils literal">bundle.js</tt></li>
<li>run <tt class="docutils literal">npm run watch</tt> when developing and <tt class="docutils literal">npm run build</tt> before&nbsp;deploying</li>
</ul>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="http://spapas.github.io/2015/04/29/django-show-404-page/">Show 404 page on django when DEBUG=True</a>
      </h1>
    <p class="meta">
<time datetime="2015-04-29T10:20:00+03:00" pubdate>Τετ 29 Απρίλιος 2015</time>    </p>
</header>

  <div class="entry-content"><p>The default 404 error page on django can be <a class="reference external" href="https://docs.djangoproject.com/en/1.8/topics/http/views/#the-http404-exception">easily overriden</a> by adding
a template named <tt class="docutils literal">404.html</tt> to the top level directory of your templates.
However, on your development environment you&#8217;ll never be able to see this
template because when <tt class="docutils literal"><span class="caps">DEBUG</span>=True</tt> django will render the debug not found
page to help you debug your url&nbsp;configuration.</p>
<p>If you want to display that page in your development environment you can always
change the <span class="caps">DEBUG</span> setting to False, however there&#8217;s a better way: Add a url
pattern for django&#8217;s default 404 view - just  add the following to your <tt class="docutils literal">urls.py</tt>:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">django.views.defaults</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="c"># Other url patterns ...</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^404/$&#39;</span><span class="p">,</span> <span class="n">django</span><span class="o">.</span><span class="n">views</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">page_not_found</span><span class="p">,</span> <span class="p">),</span>
<span class="p">)</span>
</pre></div>
<p>You&#8217;ll then be able to see your 404 page by visiting the defined <span class="caps">URL</span>!</p>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="http://spapas.github.io/2015/02/06/python-pusher-rest/">Calling the REST API of Pusher from python</a>
      </h1>
    <p class="meta">
<time datetime="2015-02-06T12:20:00+02:00" pubdate>Παρ 06 Φεβρουάριος 2015</time>    </p>
</header>

  <div class="entry-content"><div class="section" id="introduction">
<h2>Introduction</h2>
<p><a class="reference external" href="https://pusher.com/">Pusher</a> is one of the best real time frameworks right now. Using it you can add real time
events in your projects without the need to configure and use <span class="caps">HTTP</span> servers that support
real-time events in your environment. I used it recently in a project and it worked really
good, having a very simple <span class="caps">API</span> and a nice interface for debugging your&nbsp;requests.</p>
<p>The only problem I&#8217;ve found was that the <a class="reference external" href="https://github.com/pusher/pusher_client_python">Pusher python <span class="caps">API</span></a> misses some features that
the APIs for other languages have, specifically finding out the users on a presence&nbsp;channel.</p>
<p>Pusher supports real-time events through the use of &quot;channels&quot;. Each pusher client will
subscribe to a channel and receive messages that are sent to that channel. A special kind
of channel are presence channels which keep a list of their subscribers. You can query the
<a class="reference external" href="https://pusher.com/docs/rest_api">Pusher <span class="caps">REST</span> <span class="caps">API</span></a> (or f.e the Pusher Javascript <span class="caps">API</span>) to find out the names of the users
in a presence channel - however this is <em>not</em> currently possible with the python <span class="caps">API</span>.</p>
<p>Unfortuanately, calling the Pusher <span class="caps">REST</span> <span class="caps">API</span> is <em>not</em> so easy, since it needs a complicated
singining of each request, so I&#8217;ve written this post to help developers that need to call
this <span class="caps">API</span> from python (to get the users of a presence channel or for any other method the
<span class="caps">REST</span> <span class="caps">API</span>&nbsp;supports).</p>
</div>
<div class="section" id="signing-the-request">
<h2>Signing the&nbsp;request</h2>
<p>Quoting from the <a class="reference external" href="https://pusher.com/docs/rest_api">Pusher <span class="caps">REST</span> <span class="caps">API</span></a>, to sign a request we need a signature,&nbsp;which:</p>
<blockquote>
<p>The signature is a <span class="caps">HMAC</span> <span class="caps">SHA256</span> hex digest. This is generated by signing a string made up of the following components concatenated with newline characters&nbsp;\n:</p>
<ul class="simple">
<li>The uppercase request method (e.g. <span class="caps">POST</span>)</li>
<li>The request path (e.g.&nbsp;/some/resource)</li>
<li>The query parameters sorted by key, with keys converted to lowercase, then joined as in the query string. Note that the string must not be url escaped (e.g. given the keys auth_key: foo, Name: Something else, you get auth_key=foo&amp;name=Something&nbsp;else)</li>
</ul>
</blockquote>
<p>So, we need to create a string and then sign it using our Pusher api_key and secret. To help with this, we create a <tt class="docutils literal">Token</tt>
class which will be initialzed with out pusher key/secret and correctly sign a&nbsp;string:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Token</span><span class="p">(</span><span class="nb">object</span><span class="p">,):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">secret</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secret</span> <span class="o">=</span> <span class="n">secret</span>

    <span class="k">def</span> <span class="nf">sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secret</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</pre></div>
<p>It uses the <tt class="docutils literal">hmac</tt> and <tt class="docutils literal">hashlib</tt> python&nbsp;modules.</p>
</div>
<div class="section" id="generating-the-complete-query-string">
<h2>Generating the complete query&nbsp;string</h2>
<p>We can now create a function that will sign a request using an instance of the above&nbsp;token:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">create_signed_query_string</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">partial_path</span><span class="p">,</span> <span class="n">request_params</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;auth_key&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
        <span class="s">&#39;auth_timestamp&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
        <span class="s">&#39;auth_version&#39;</span><span class="p">:</span> <span class="s">&#39;1.0&#39;</span>
    <span class="p">}</span>
    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">request_params</span><span class="p">)</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span>
    <span class="n">params_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">params_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;{0}={1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="p">)</span>

    <span class="n">query_string</span> <span class="o">=</span> <span class="s">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params_list</span><span class="p">)</span>

    <span class="n">sign_data</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="n">partial_path</span><span class="p">,</span> <span class="n">query_string</span><span class="p">])</span>
    <span class="n">query_string</span> <span class="o">+=</span> <span class="s">&#39;&amp;auth_signature=&#39;</span> <span class="o">+</span> <span class="n">token</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">sign_data</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">query_string</span>
</pre></div>
<p><tt class="docutils literal">create_signed_query_string</tt> receives an instance of a <tt class="docutils literal">Token</tt>, the path that we want to request
without the server part (for example <tt class="docutils literal"><span class="pre">/apps/33/users/my-channel</span></tt>)  and a dictionary of
request parameters. It then adds three extra fields to the request parameters (<tt class="docutils literal">auth_key, auth_timestamp, auth_version</tt>)
and creates a list of these parameters in the <tt class="docutils literal">key=value</tt> form, where the keys are alphabetically sorted.
After that it joins the above <tt class="docutils literal">key=value</tt> parameters using <tt class="docutils literal">&amp;</tt> to create the <tt class="docutils literal">query_string</tt> and then it creates the string to be signed (<tt class="docutils literal">sign_data</tt>)
by concatenating the <span class="caps">HTTP</span> methdo (<span class="caps">GET</span>) with the path and the <tt class="docutils literal">query_string</tt>. Finally, it appends the signing result as an extra
query parameter named (<tt class="docutils literal">auth_signature</tt>).</p>
</div>
<div class="section" id="requesting-the-users-of-the-presence-channel">
<h2>Requesting the users of the presence&nbsp;channel</h2>
<p>The <tt class="docutils literal">create_signed_query_string</tt> can now be used to get the users of a presence channel like&nbsp;this:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">get_users</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">secret</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
    <span class="n">partial_path</span> <span class="o">=</span>  <span class="s">&#39;/apps/{0}/channels/{1}/users&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span>
    <span class="n">qs</span> <span class="o">=</span> <span class="n">create_signed_query_string</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">partial_path</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">full_path</span> <span class="o">=</span> <span class="s">&#39;http://api.pusherapp.com/{0}?{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">partial_path</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
</pre></div>
<p>The <tt class="docutils literal">get_users</tt> function will generate the path of the pusher <span class="caps">REST</span> <span class="caps">API</span> (using
our pusher app_id and channel name) and initialize a signing <tt class="docutils literal">Token</tt> using
the pusher key and secret. It will then pass the previous to <tt class="docutils literal">create_signed_query_string</tt>
to generate the complete <tt class="docutils literal">query_string</tt> and generate the <tt class="docutils literal">full_path</tt> to which
a simple <span class="caps">HTTP</span> <span class="caps">GET</span> request is issued. The result will be a <span class="caps">JSON</span> list of the users in the
presence&nbsp;channel.</p>
</div>
<div class="section" id="complete-example">
<h2>Complete&nbsp;example</h2>
<p>A complete example of getting the presence users of a channel is the&nbsp;following:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">app_id</span> <span class="o">=</span> <span class="s">&#39;pusher_app_id&#39;</span>
<span class="n">key</span> <span class="o">=</span> <span class="s">&#39;pusher_key&#39;</span>
<span class="n">secret</span> <span class="o">=</span> <span class="s">&#39;pusher_secret&#39;</span>
<span class="n">channel</span> <span class="o">=</span> <span class="s">&#39;pusher_presence_channel&#39;</span>


<span class="k">class</span> <span class="nc">Token</span><span class="p">(</span><span class="nb">object</span><span class="p">,):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">secret</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secret</span> <span class="o">=</span> <span class="n">secret</span>

    <span class="k">def</span> <span class="nf">sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secret</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">create_signed_query_string</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">partial_path</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">request_params</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;auth_key&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
        <span class="s">&#39;auth_timestamp&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
        <span class="s">&#39;auth_version&#39;</span><span class="p">:</span> <span class="s">&#39;1.0&#39;</span>
    <span class="p">}</span>
    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">request_params</span><span class="p">)</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span>
    <span class="n">params_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">params_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;{0}={1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="p">)</span>

    <span class="n">query_string</span> <span class="o">=</span> <span class="s">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params_list</span><span class="p">)</span>

    <span class="n">sign_data</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">partial_path</span><span class="p">,</span> <span class="n">query_string</span><span class="p">])</span>
    <span class="n">query_string</span> <span class="o">+=</span> <span class="s">&#39;&amp;auth_signature=&#39;</span> <span class="o">+</span> <span class="n">token</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">sign_data</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">query_string</span>


<span class="k">def</span> <span class="nf">get_users</span><span class="p">(</span><span class="n">channel</span><span class="p">):</span>
    <span class="n">partial_path</span> <span class="o">=</span>  <span class="s">&#39;/apps/{0}/channels/{1}/users&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span>
    <span class="n">qs</span> <span class="o">=</span>  <span class="n">create_signed_query_string</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">partial_path</span><span class="p">,</span> <span class="s">&#39;GET&#39;</span> <span class="p">{})</span>
    <span class="n">full_path</span> <span class="o">=</span> <span class="s">&#39;http://api.pusherapp.com/{0}?{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">partial_path</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>

<span class="k">print</span> <span class="n">get_users</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>With the above we are able to not only easily get the users of a Pusher presence
channel in python but to also call any method we want from the Pusher <span class="caps">REST</span> <span class="caps">API</span> by implementing a function
similar to  <tt class="docutils literal">get_users</tt>.</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="http://spapas.github.io/2015/01/27/async-tasks-with-django-rq/">Asynchronous tasks in django with django-rq</a>
      </h1>
    <p class="meta">
<time datetime="2015-01-27T14:20:00+02:00" pubdate>Τρι 27 Ιανουάριος 2015</time>    </p>
</header>

  <div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#job-queues-in-python" id="id2">Job queues in&nbsp;python</a></li>
<li><a class="reference internal" href="#django-test-rq" id="id3">django-test-rq</a><ul>
<li><a class="reference internal" href="#models-py" id="id4">models.py</a></li>
<li><a class="reference internal" href="#forms-py" id="id5">forms.py</a></li>
<li><a class="reference internal" href="#views-py" id="id6">views.py</a></li>
<li><a class="reference internal" href="#tasks-py" id="id7">tasks.py</a></li>
<li><a class="reference internal" href="#settings-py" id="id8">settings.py</a></li>
<li><a class="reference internal" href="#running-the-project" id="id9">Running the&nbsp;project</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rqworker-and-rqscheduler" id="id10">rqworker and rqscheduler</a><ul>
<li><a class="reference internal" href="#for-development" id="id11">For&nbsp;development</a></li>
<li><a class="reference internal" href="#for-production" id="id12">For&nbsp;production</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion" id="id13">Conclusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a></h2>
<p>Job queuing (asynchronous tasks) is a common requirement for non-trivial django projects. Whenever an operation
can take more than half a second it should be put to a job queue in order to be run asynchronously by a
seperate worker. This is really important since the response to a user request needs to be immediate
or else the users will experience laggy behavior and start complaining!
Even for fairly quick tasks (like sending email through an <span class="caps">SMTP</span> server) you need to use an asynchronous task
if you care about your users since
the time required for such a task is not really&nbsp;limited.</p>
<p>Using job queues is involved not only for the developers of the application (who need to create the
asynchronous tasks and give feedback to the users when the&#8217;ve finished since they can&#8217;t use the normal
<span class="caps">HTTP</span> response) and but also for the administrators, since, in order to support job queues at least two
more componets will be&nbsp;needed:</p>
<ul class="simple">
<li>One job queue that will store the jobs to be executed next in a first in first queue. This could be the normal database of the project however it&#8217;s not recommended for performance reasons and most of thetimes it is a specific component called &quot;Message&nbsp;Broker&quot;</li>
<li>One (or more) workers that will monitor the job queue and when there is work to do they will dequeue and execute&nbsp;it</li>
</ul>
<p>These can all run in the same server but if it gets saturated they can easily be seperated (even more work for&nbsp;administrators).</p>
<p>Beyond job queuing, another relative requirement for many projects is to schedule a task to be run in the future
(similar to the <tt class="docutils literal">at</tt> unix command) or at specific time intervals (similar to the <tt class="docutils literal">cron</tt> unix command). For
instance, if a user is registered today we may need to check after one or two days if he&#8217;s logged in and used our application -
if he hasn&#8217;t then probably he&#8217;s having problems and we can call him to help him. Also, we could check every night
to see if any users that have registered to our application don&#8217;t have activated their account through email activation
and delete these accounts. Scheduled tasks should be also run by the workers mentioned&nbsp;above.</p>
</div>
<div class="section" id="job-queues-in-python">
<h2><a class="toc-backref" href="#id2">Job queues in&nbsp;python</a></h2>
<p>The most known application for using job queues in python is <a class="reference external" href="http://www.celeryproject.org/">celery</a> which is a really great project that supports
many brokers,  integrates nicely
with python/django (but can be used even with other languages) and has
many more features (most of them are only useful on really big, enterprise projects). I&#8217;ve already used
it in a previous application, however, because celery is really complex I found it rather difficult to
configure it successfully and I never was perfectly sure that my asynchronous task would actually work or
that I&#8217;d used the correct configuration for my&nbsp;needs!</p>
<p>Celery also has <a class="reference external" href="http://celery.readthedocs.org/en/latest/faq.html#does-celery-have-many-dependencies">many dependencies</a> in order to be able to talk with the different broker backends it supports,
improve multithreading support etc. They may be required in enterprise apps but not for most Django web based&nbsp;projects.</p>
<p>So, for small-to-average projects I recommend using a different asynchronous task solution instead of celery, particularly
(as you&#8217;ve already guessed from the title of this post) <a class="reference external" href="http://python-rq.org/"><span class="caps">RQ</span></a>. <span class="caps">RQ</span> is simpler than celery, it integrates great with django
using the excellent <a class="reference external" href="https://github.com/ui/django-rq">django-rq</a> package and doesn&#8217;t actually have any more dependencies beyond redis support which is
used as a broker (however most modern django projects already use redis for their caching needs as an  alternative
to&nbsp;memcached).</p>
<p>It even supports supports job scheduling through the <a class="reference external" href="https://github.com/ui/rq-scheduler">rq-scheduler</a> package (celery also supports
job scheduling through celery beat): Run a different process (scheduler) that polls the job
scheduling queue for any jobs that need to be run because of scheduling and if yes put them to
the normal job&nbsp;queue.</p>
<p>Although <span class="caps">RQ</span> and frieds are really easy to use (and have nice documentation) I wasn&#8217;t able to find
a <em>complete</em> example of using it with django, so I&#8217;ve implemented one
(found at <a class="reference external" href="https://github.com/spapas/django-test-rq">https://github.com/spapas/django-test-rq</a>) mainly for my own testing
purposes. To help others that want to also use <span class="caps">RQ</span> in their project but don&#8217;t know from where
to start, I&#8217;ll present it in the following paragraphs, along with some comments on
how to actually use <span class="caps">RQ</span> in your production&nbsp;environment.</p>
</div>
<div class="section" id="django-test-rq">
<h2><a class="toc-backref" href="#id3">django-test-rq</a></h2>
<p>This is a simple django project that can be used to asynchronously
run and schedule jobs and examine their behavior. The job to be scheduled just downloads a provided
<span class="caps">URL</span> and counts its length. There is only one django application (tasks) that contains two views, one
to display existing tasks and create new ones and one to display some info for the&nbsp;jobs.</p>
<div class="section" id="models-py">
<h3><a class="toc-backref" href="#id4">models.py</a></h3>
<p>Two models (<tt class="docutils literal">Task</tt> and <tt class="docutils literal">ScheduledTask</tt>) for saving individual tasks and
scheduled tasks and one model (<tt class="docutils literal">ScheduledTaskInstance</tt>) to save scheduled
instances of each scheduled&nbsp;task.</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">rq</span> <span class="kn">import</span> <span class="n">get_current_job</span>


<span class="k">class</span> <span class="nc">Task</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># A model to save information about an asynchronous task</span>
    <span class="n">created_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
    <span class="n">job_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ScheduledTask</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># A model to save information about a scheduled task</span>
    <span class="n">created_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
    <span class="c"># A scheduled task has a common job id for all its occurences</span>
    <span class="n">job_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ScheduledTaskInstance</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># A model to save information about instances of a scheduled task</span>
    <span class="n">scheduled_task</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;ScheduledTask&#39;</span><span class="p">)</span>
    <span class="n">created_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="forms-py">
<h3><a class="toc-backref" href="#id5">forms.py</a></h3>
<p>A very simple form to create a new&nbsp;task.</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>

<span class="k">class</span> <span class="nc">TaskForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A simple form to read a url from the user in order to find out its length</span>
<span class="sd">    and either run it asynchronously or schedule it schedule_times times,</span>
<span class="sd">    every schedule_interval seconds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;URL&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s">&#39;Enter a url (starting with http/https) to start a job that will download it and count its words&#39;</span> <span class="p">)</span>
    <span class="n">schedule_times</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s">&#39;How many times to run this job. Leave empty or 0 to run it only once.&#39;</span><span class="p">)</span>
    <span class="n">schedule_interval</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s">&#39;How much time (in seconds) between runs of the job. Leave empty to run it only once.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TaskForm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
        <span class="n">schedule_times</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;schedule_times&#39;</span><span class="p">)</span>
        <span class="n">schedule_interval</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;schedule_interval&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">schedule_times</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">schedule_interval</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">schedule_times</span> <span class="ow">and</span> <span class="n">schedule_interval</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Please fill both schedule_times and schedule_interval to schedule a job or leave them both empty&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="s">&#39;schedule_times&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="s">&#39;schedule_interval&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="views-py">
<h3><a class="toc-backref" href="#id6">views.py</a></h3>
<p>This is actually very simple if you&#8217;re familiar with Class Based Views. Two CBVs
are defined, one for the Task form + Task display and another for the Job&nbsp;display.</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.views.generic.edit</span> <span class="kn">import</span> <span class="n">FormView</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">TemplateView</span>
<span class="kn">from</span> <span class="nn">forms</span> <span class="kn">import</span> <span class="n">TaskForm</span>
<span class="kn">from</span> <span class="nn">tasks</span> <span class="kn">import</span> <span class="n">get_url_words</span><span class="p">,</span> <span class="n">scheduled_get_url_words</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">Task</span><span class="p">,</span><span class="n">ScheduledTask</span>
<span class="kn">from</span> <span class="nn">rq.job</span> <span class="kn">import</span> <span class="n">Job</span>
<span class="kn">import</span> <span class="nn">django_rq</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">class</span> <span class="nc">TasksHomeFormView</span><span class="p">(</span><span class="n">FormView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class that displays a form to read a url to read its contents and if the job</span>
<span class="sd">    is to be scheduled or not and information about all the tasks and scheduled tasks.</span>

<span class="sd">    When the form is submitted, the task will be either scheduled based on the</span>
<span class="sd">    parameters of the form or will be just executed asynchronously immediately.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">TaskForm</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">&#39;tasks_home.html&#39;</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span>

    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span>
        <span class="n">schedule_times</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;schedule_times&#39;</span><span class="p">)</span>
        <span class="n">schedule_interval</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;schedule_interval&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">schedule_times</span> <span class="ow">and</span> <span class="n">schedule_interval</span><span class="p">:</span>
            <span class="c"># Schedule the job with the form parameters</span>
            <span class="n">scheduler</span> <span class="o">=</span> <span class="n">django_rq</span><span class="o">.</span><span class="n">get_scheduler</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">)</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">scheduler</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span>
                <span class="n">scheduled_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                <span class="n">func</span><span class="o">=</span><span class="n">scheduled_get_url_words</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">url</span><span class="p">],</span>
                <span class="n">interval</span><span class="o">=</span><span class="n">schedule_interval</span><span class="p">,</span>
                <span class="n">repeat</span><span class="o">=</span><span class="n">schedule_times</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Just execute the job asynchronously</span>
            <span class="n">get_url_words</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">TasksHomeFormView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TasksHomeFormView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s">&#39;tasks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-created_on&#39;</span><span class="p">)</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s">&#39;scheduled_tasks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ScheduledTask</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-created_on&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ctx</span>


<span class="k">class</span> <span class="nc">JobTemplateView</span><span class="p">(</span><span class="n">TemplateView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple template view that gets a job id as a kwarg parameter</span>
<span class="sd">    and tries to fetch that job from RQ. It will then print all attributes</span>
<span class="sd">    of that object using __dict__.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">&#39;job.html&#39;</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">JobTemplateView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">redis_conn</span> <span class="o">=</span> <span class="n">django_rq</span><span class="o">.</span><span class="n">get_connection</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">Job</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;job&#39;</span><span class="p">],</span> <span class="n">connection</span><span class="o">=</span><span class="n">redis_conn</span><span class="p">)</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">__dict__</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">ctx</span><span class="p">[</span><span class="s">&#39;job&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">job</span>
        <span class="k">return</span> <span class="n">ctx</span>
</pre></div>
</div>
<div class="section" id="tasks-py">
<h3><a class="toc-backref" href="#id7">tasks.py</a></h3>
<p>Here two jobs are defined: One to be used for simple asynchronous tasks and the
other to be used for scheduled asynchronous tasks (since for asynchronous tasks
we wanted to group their runs per job&nbsp;id).</p>
<p>The <tt class="docutils literal">&#64;job</tt> decorator will add the <tt class="docutils literal">delay()</tt> method (used in <tt class="docutils literal">views.py</tt>) to
the function. It&#8217;s not really required for <tt class="docutils literal">scheduled_get_url_words</tt> since
it&#8217;s called through the <tt class="docutils literal">scheduled.schedule</tt>.</p>
<p>When a task is finished, it can return a value (like we do in <tt class="docutils literal">return task.result</tt>)
which will be saved for a limited amount of time (500 seconds by default - could be
even saved for ever) to redis.
This may be useful in some cases, however, I think that for normal web applications it&#8217;s
not that useful, and since here we use normal django models
for each task, we can save it to that model&#8217;s instance&nbsp;instead.</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">Task</span><span class="p">,</span> <span class="n">ScheduledTask</span><span class="p">,</span> <span class="n">ScheduledTaskInstance</span>
<span class="kn">from</span> <span class="nn">rq</span> <span class="kn">import</span> <span class="n">get_current_job</span>
<span class="kn">from</span> <span class="nn">django_rq</span> <span class="kn">import</span> <span class="n">job</span>


<span class="nd">@job</span>
<span class="k">def</span> <span class="nf">get_url_words</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="c"># This creates a Task instance to save the job instance and job result</span>
    <span class="n">job</span> <span class="o">=</span> <span class="n">get_current_job</span><span class="p">()</span>

    <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">job_id</span><span class="o">=</span><span class="n">job</span><span class="o">.</span><span class="n">get_id</span><span class="p">(),</span>
        <span class="n">name</span><span class="o">=</span><span class="n">url</span>
    <span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">task</span><span class="o">.</span><span class="n">result</span>


<span class="nd">@job</span>
<span class="k">def</span> <span class="nf">scheduled_get_url_words</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This creates a ScheduledTask instance for each group of</span>
<span class="sd">    scheduled task - each time this scheduled task is run</span>
<span class="sd">    a new instance of ScheduledTaskInstance will be created</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">job</span> <span class="o">=</span> <span class="n">get_current_job</span><span class="p">()</span>

    <span class="n">task</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">ScheduledTask</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span>
        <span class="n">job_id</span><span class="o">=</span><span class="n">job</span><span class="o">.</span><span class="n">get_id</span><span class="p">(),</span>
        <span class="n">name</span><span class="o">=</span><span class="n">url</span>
    <span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">response_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">ScheduledTaskInstance</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">scheduled_task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">response_len</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response_len</span>
</pre></div>
</div>
<div class="section" id="settings-py">
<h3><a class="toc-backref" href="#id8">settings.py</a></h3>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>

<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">&#39;123&#39;</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">TEMPLATE_DEBUG</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>

    <span class="s">&#39;django_extensions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django_rq&#39;</span><span class="p">,</span>

    <span class="s">&#39;tasks&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">MIDDLEWARE_CLASSES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.auth.middleware.SessionAuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s">&#39;django_test_rq.urls&#39;</span>
<span class="n">WSGI_APPLICATION</span> <span class="o">=</span> <span class="s">&#39;django_test_rq.wsgi.application&#39;</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span>
        <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">&#39;db.sqlite3&#39;</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s">&#39;en-us&#39;</span>
<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s">&#39;UTC&#39;</span>
<span class="n">USE_I18N</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">USE_TZ</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s">&#39;/static/&#39;</span>

<span class="c"># Use redis for caches</span>
<span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s">&quot;django_redis.cache.RedisCache&quot;</span><span class="p">,</span>
        <span class="s">&quot;LOCATION&quot;</span><span class="p">:</span> <span class="s">&quot;redis://127.0.0.1:6379/0&quot;</span><span class="p">,</span>
        <span class="s">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;CLIENT_CLASS&quot;</span><span class="p">:</span> <span class="s">&quot;django_redis.client.DefaultClient&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c"># Use the same redis as with caches for RQ</span>
<span class="n">RQ_QUEUES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;USE_REDIS_CACHE&#39;</span><span class="p">:</span> <span class="s">&#39;default&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">SESSION_ENGINE</span> <span class="o">=</span> <span class="s">&quot;django.contrib.sessions.backends.cache&quot;</span>
<span class="n">SESSION_CACHE_ALIAS</span> <span class="o">=</span> <span class="s">&quot;default&quot;</span>
<span class="n">RQ_SHOW_ADMIN_LINK</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c"># Add a logger for rq_scheduler in order to display when jobs are queueud</span>
<span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="s">&#39;formatters&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;simple&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;format&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%(asctime)s</span><span class="s"> </span><span class="si">%(levelname)s</span><span class="s"> </span><span class="si">%(message)s</span><span class="s">&#39;</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;console&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;DEBUG&#39;</span><span class="p">,</span>
            <span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;logging.StreamHandler&#39;</span><span class="p">,</span>
            <span class="s">&#39;formatter&#39;</span><span class="p">:</span> <span class="s">&#39;simple&#39;</span>
        <span class="p">},</span>
    <span class="p">},</span>

    <span class="s">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;django.request&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;console&#39;</span><span class="p">],</span>
            <span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;DEBUG&#39;</span><span class="p">,</span>
            <span class="s">&#39;propagate&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s">&#39;rq_scheduler&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;console&#39;</span><span class="p">],</span>
            <span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;DEBUG&#39;</span><span class="p">,</span>
            <span class="s">&#39;propagate&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
<p>By default, rq_scheduler won&#8217;t log anything so we won&#8217;t be able to see
any output when new instances of each scheduled task are queued for execution.
That&#8217;s why we&#8217;ve overriden the <span class="caps">LOGGING</span> setting in order to actually log
rq_scheduler output to the&nbsp;console.</p>
</div>
<div class="section" id="running-the-project">
<h3><a class="toc-backref" href="#id9">Running the&nbsp;project</a></h3>
<p>I recommend using <a class="reference external" href="https://www.vagrantup.com/">Vagrant</a> to start a stock ubuntu/trusty32 box. After that, install redis, virtualenv and virtualenvwrapper
and create/activate a virtualenv named <tt class="docutils literal">rq</tt>. You can go to the home directory of <tt class="docutils literal"><span class="pre">django-test-rq</span></tt>
and install requirements through <tt class="docutils literal">pip install requirements.txt</tt> and create the database tables with
<tt class="docutils literal">python manage.py migrate</tt>. Finally you may run the project with <tt class="docutils literal">python manage.py runserver_plus</tt>.</p>
</div>
</div>
<div class="section" id="rqworker-and-rqscheduler">
<h2><a class="toc-backref" href="#id10">rqworker and&nbsp;rqscheduler</a></h2>
<p>Before scheduling any tasks we need to run two more&nbsp;processes:</p>
<ul class="simple">
<li>rqworker: This is a worker that dequeues jobs from the queue and executes them. We could run more than one onstance of this job if we need&nbsp;it.</li>
<li>rqscheduler: This is a process that runs every one minute and checks if there are scheduled jobs that have to be executed. If yes, it will add them to the queue in order to be executed by a&nbsp;worker.</li>
</ul>
<div class="section" id="for-development">
<h3><a class="toc-backref" href="#id11">For&nbsp;development</a></h3>
<p>If you want to run rqworker and rqscheduler for your development environment you can just do it with
running <tt class="docutils literal">python manage.py rqworker</tt> and <tt class="docutils literal">python mange.py rqscheduler</tt> through screen/tmux. If everything
is allright you should see tasks being added to the queue and scheduled (you may need to refresh the
homepage before seeing everything since a task may be executed after the response is&nbsp;created).</p>
<p>Also, keep in mind that rqscheduler runs once every minute by default so you may need to wait up to
minute to see a <tt class="docutils literal">ScheduledTask</tt> instance. Also, this means that you can&#8217;t run more than one scheduled
task instance per&nbsp;minute.</p>
</div>
<div class="section" id="for-production">
<h3><a class="toc-backref" href="#id12">For&nbsp;production</a></h3>
<p>Trying to create daemons through screen is not
sufficient for a production envornment since we&#8217;d like to actually have logging, monitoring and of course
automatically start rqworker and rqscheduler when the server&nbsp;boots.</p>
<p>For this, I recommend using the <a class="reference external" href="http://supervisord.org/">supervisord</a> tool which
can be used to monitor and control a number of processes. There are other similar tools, however I&#8217;ve
found supervisord the easier to&nbsp;use.</p>
<p>In order to monitor/control a process through supervisord you need to add a <tt class="docutils literal">[program:progrname]</tt> section in
supervisord&#8217;s configuration and pass a number of parameters. The <tt class="docutils literal">progname</tt> is the name of the monitoring
process. Here&#8217;s how rqworker can be configured using&nbsp;supervisord:</p>
<pre class="code literal-block">
[program:rqworker]
command=python manage.py rqworker
directory=/vagrant/progr/py/rq/django-test-rq
environment=PATH=&quot;/home/vagrant/.virtualenvs/rq/bin&quot;
user=vagrant
</pre>
<p>The options used will chdir to <tt class="docutils literal">directory</tt> and execute <tt class="docutils literal">command</tt> as <tt class="docutils literal">user</tt>. The <tt class="docutils literal">environment</tt>
option can be used to set envirotnment variables - here we set <tt class="docutils literal"><span class="caps">PATH</span></tt> in order to use a specific
virtual environment. This will allow you to monitor rqworker through supervisord and log its
output to a file in <tt class="docutils literal">/var/log/supervisor</tt> (by default). A similar entry needs to be added for
rqscheduler of course. If everything has been configured correctly, when you reload the supervisord
settings you can run <tt class="docutils literal">sudo /usr/bin/supervisorctl</tt> and should see something&nbsp;like</p>
<pre class="code literal-block">
rqscheduler                      RUNNING    pid 1561, uptime 0:00:03
rqworker                         RUNNING    pid 1562, uptime 0:00:03
</pre>
<p>Also, tho log files should contain some debug&nbsp;info.</p>
</div>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#id13">Conclusion</a></h2>
<p>Although using job queues makes it more difficult for the developer and adds at least one
(and probably more) points of failure to a project (the workers, the broker etc) their
usage, even for very simple projects is&nbsp;unavoidable.</p>
<p>Unless a complex, enterprise solution like celery is really required for a project
I recommend using the much simpler and easier to configure <span class="caps">RQ</span> for all your
asynchronous and scheduled task needs. Using <span class="caps">RQ</span> (and the relative projects django-rq
and rq-scheduler) we can easily add production ready queueued and scheduled jobs to
any django&nbsp;project.</p>
<p>In this article we presented a small introduction to <span class="caps">RQ</span> and its friends and saw how
to configure django to use it in a production ready environment using a small
django project (<a class="reference external" href="https://github.com/spapas/django-test-rq">https://github.com/spapas/django-test-rq</a>) which was implemented as a companion
to help readers quickly test the concepts presented&nbsp;here.</p>
</div>
</div>
  		</article>
<div class="pagination">
    <a class="prev" href="http://spapas.github.io/index2.html">&larr; Older</a>

  <br />
</div></div>
<aside class="sidebar">
  <section>
  <br />
  <a href='/feeds/all.atom.xml'>Atom</a> 
  |
  <a href='/feeds/all.rss.xml'>RSS</a> 
  </section>
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="http://spapas.github.io/2015/06/05/comprehensive-react-flux-tutorial/">A comprehensive React and Flux tutorial part 1: React</a>
      </li>
      <li class="post">
          <a href="http://spapas.github.io/2015/05/27/using-browserify-watchify/">Using browserify and watchify to improve your client-side-javascript workflow</a>
      </li>
      <li class="post">
          <a href="http://spapas.github.io/2015/04/29/django-show-404-page/">Show 404 page on django when DEBUG=True</a>
      </li>
      <li class="post">
          <a href="http://spapas.github.io/2015/02/06/python-pusher-rest/">Calling the REST API of Pusher from python</a>
      </li>
      <li class="post">
          <a href="http://spapas.github.io/2015/01/27/async-tasks-with-django-rq/">Asynchronous tasks in django with django-rq</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="http://spapas.github.io/category/css.html">css</a></li>
        <li><a href="http://spapas.github.io/category/django.html">django</a></li>
        <li><a href="http://spapas.github.io/category/flask.html">flask</a></li>
        <li><a href="http://spapas.github.io/category/git.html">git</a></li>
        <li><a href="http://spapas.github.io/category/javascript.html">javascript</a></li>
        <li><a href="http://spapas.github.io/category/pelican.html">pelican</a></li>
        <li><a href="http://spapas.github.io/category/python.html">python</a></li>
        <li><a href="http://spapas.github.io/category/spring.html">spring</a></li>
        <li><a href="http://spapas.github.io/category/wagtail.html">wagtail</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="http://spapas.github.io/tag/pelican.html">pelican</a>,    <a href="http://spapas.github.io/tag/tasks.html">tasks</a>,    <a href="http://spapas.github.io/tag/less.html">less</a>,    <a href="http://spapas.github.io/tag/spring.html">spring</a>,    <a href="http://spapas.github.io/tag/rest.html">rest</a>,    <a href="http://spapas.github.io/tag/google.html">google</a>,    <a href="http://spapas.github.io/tag/cbv.html">cbv</a>,    <a href="http://spapas.github.io/tag/scheduling.html">scheduling</a>,    <a href="http://spapas.github.io/tag/auditing.html">auditing</a>,    <a href="http://spapas.github.io/tag/static-html.html">static-html</a>,    <a href="http://spapas.github.io/tag/git.html">git</a>,    <a href="http://spapas.github.io/tag/java.html">java</a>,    <a href="http://spapas.github.io/tag/rq.html">rq</a>,    <a href="http://spapas.github.io/tag/uglify.html">uglify</a>,    <a href="http://spapas.github.io/tag/django-rq.html">django-rq</a>,    <a href="http://spapas.github.io/tag/nodejs.html">node.js</a>,    <a href="http://spapas.github.io/tag/redis.html">redis</a>,    <a href="http://spapas.github.io/tag/heroku.html">heroku</a>,    <a href="http://spapas.github.io/tag/forms.html">forms</a>,    <a href="http://spapas.github.io/tag/github-pages.html">github-pages</a>,    <a href="http://spapas.github.io/tag/404.html">404</a>,    <a href="http://spapas.github.io/tag/ldap.html">ldap</a>,    <a href="http://spapas.github.io/tag/gmail.html">gmail</a>,    <a href="http://spapas.github.io/tag/spring-security.html">spring-security</a>,    <a href="http://spapas.github.io/tag/css.html">css</a>,    <a href="http://spapas.github.io/tag/node.html">node</a>,    <a href="http://spapas.github.io/tag/jobs.html">jobs</a>,    <a href="http://spapas.github.io/tag/watchify.html">watchify</a>,    <a href="http://spapas.github.io/tag/python.html">python</a>,    <a href="http://spapas.github.io/tag/mongodb.html">mongodb</a>,    <a href="http://spapas.github.io/tag/javascript.html">javascript</a>,    <a href="http://spapas.github.io/tag/authentication.html">authentication</a>,    <a href="http://spapas.github.io/tag/react.html">react</a>,    <a href="http://spapas.github.io/tag/class-based-views.html">class-based-views</a>,    <a href="http://spapas.github.io/tag/npm.html">npm</a>,    <a href="http://spapas.github.io/tag/rst.html">rst</a>,    <a href="http://spapas.github.io/tag/generic.html">generic</a>,    <a href="http://spapas.github.io/tag/browserify.html">browserify</a>,    <a href="http://spapas.github.io/tag/branching.html">branching</a>,    <a href="http://spapas.github.io/tag/design.html">design</a>,    <a href="http://spapas.github.io/tag/github.html">github</a>,    <a href="http://spapas.github.io/tag/pusher.html">pusher</a>,    <a href="http://spapas.github.io/tag/windows.html">windows</a>,    <a href="http://spapas.github.io/tag/wagtail.html">wagtail</a>,    <a href="http://spapas.github.io/tag/django.html">django</a>,    <a href="http://spapas.github.io/tag/flux.html">flux</a>,    <a href="http://spapas.github.io/tag/githubio.html">github.io</a>,    <a href="http://spapas.github.io/tag/error.html">error</a>,    <a href="http://spapas.github.io/tag/debug.html">debug</a>,    <a href="http://spapas.github.io/tag/asynchronous.html">asynchronous</a>,    <a href="http://spapas.github.io/tag/security.html">security</a>,    <a href="http://spapas.github.io/tag/flask.html">flask</a>,    <a href="http://spapas.github.io/tag/boostrap-material-design.html">boostrap-material-design</a>  </section>



</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2013&ndash;2015  Serafeim Papastefanos &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="http://spapas.github.io/theme/js/modernizr-2.0.js"></script>
  <script src="http://spapas.github.io/theme/js/ender.js"></script>
  <script src="http://spapas.github.io/theme/js/octopress.js" type="text/javascript"></script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44750952-1', 'auto');

    ga('send', 'pageview');
    </script>
  <script type="text/javascript">
    var disqus_shortname = 'spapas-github-io';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
</body>
</html>