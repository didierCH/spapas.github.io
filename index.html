<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="google-site-verification" content="5_8DTmIiEq4gFvNAfxAD6TsGOgrMAjp8lQFQvfA6zZc" />
  <title>/var/</title>
  <meta name="author" content="Serafeim Papastefanos">




  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="https://spapas.github.io/favicon.png" rel="icon">

  <link href="https://spapas.github.io/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">
        
  <link href="https://spapas.github.io/theme/css/extra_style.css" media="screen, projection"
        rel="stylesheet" type="text/css">

  <link href="https://fonts.googleapis.com/css?family=Fira+Mono|Fira+Sans:400,700&amp;subset=greek" rel="stylesheet">
  
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="https://spapas.github.io/">/var/</a></h1>
    <h2>Various programming stuff</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<ul class="main-navigation">
      <li >
        <a href="https://spapas.github.io/category/css.html">Css</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/django.html">Django</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/flask.html">Flask</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/git.html">Git</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/javascript.html">Javascript</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/pelican.html">Pelican</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/postgresql.html">Postgresql</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/python.html">Python</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/spring.html">Spring</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/wagtail.html">Wagtail</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div class="blog-index">
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2018/03/01/django-rest-auth/">Authentication for django-rest-framework with django-rest-auth</a>
      </h1>
    <p class="meta">
<time datetime="2018-03-01T22:40:00+02:00" pubdate>Πεμ 01 Μάρτιος 2018</time>    </p>
</header>

<div class="entry-content"><div class="section" id="introduction">
<h2>Introduction</h2>
<p>Most of the times I need authentication with any <span class="caps">REST</span> APIs defined through <a class="reference external" href="http://www.django-rest-framework.org">django-rest-framework</a>
I will use  <a class="reference external" href="http://www.django-rest-framework.org/api-guide/authentication/#sessionauthentication">SessionAuthentication</a> method. This method uses the session cookie (which is set through the
normal Django login and logout views)
to check out if there&#8217;s an authenticated user and get his username. This method works only in the
same session (browser window) as the one that actually did the login but this should be enough for most&nbsp;cases.</p>
<p>However, sometimes instead of using the normal Django login/logout views, you&#8217;ll want
to authentication through <span class="caps">REST</span> end-points, for example for using them with SPAs (where
you don&#8217;t want to use the traditional views for authentication but through <span class="caps">REST</span> end-points) or
because you have implemented a mobile (or desktop) application that needs to authenticate with
your&nbsp;script.</p>
<p>There are various ways this could be done but one of the simplest is using <a class="reference external" href="https://github.com/Tivix/django-rest-auth">django-rest-auth</a>.
This project adds a number of <span class="caps">REST</span> end-points to your project that can be used for user login
and registration (and even social login when combined with <a class="reference external" href="https://github.com/pennersr/django-allauth">django-allauth</a>).
In the following I am going to write a simple tutorial on how to actually use django-rest-auth to
authenticate with django-rest-framework using the provided <span class="caps">REST</span> end points and how to call a
<span class="caps">REST</span> <span class="caps">API</span> as an authenticated&nbsp;user.</p>
<p>Before continuing with the tutorial, let&#8217;s take a look at what we&#8217;ll build&nbsp;here:</p>
<img alt="Our project" src="/images/rest-auth.gif" style="width: 640px;" />
<p>This is a single html page (styled with <a class="reference external" href="https://picturepan2.github.io/spectre/">spectre.css</a>) that checks if the user is logged in
and either displays the login or logout button (using javascript). When you click the login you&#8217;ll get a modal in which you
can enter your credentials which will be submitted through <span class="caps">REST</span> to the django-rest-auth endpoint and
depending on the response will set a javascript variable (and a corresponding session/local storage key).
Then you can use the &#8220;Test auth&#8221; button that works only on authenticated users and returns their username.
Finally, notice that after you log out the &#8220;test auth&#8221; button returns a 403 access&nbsp;denied.</p>
<p>If you want to play with this project yourself, you can clone it here <a class="reference external" href="https://github.com/spapas/rest_authenticate">https://github.com/spapas/rest_authenticate</a>.
Just create a venv, install requirements, create a superuser and you should be good to&nbsp;go!</p>
</div>
<div class="section" id="some-theory">
<h2>Some&nbsp;theory</h2>
<p>After you log in with Django, your authentication information is saved to the &#8220;session&#8221;_. The session is a bucket of information
that the Django application saves about your visit &#8212; to distinguish between different visitors a cookie with a unique
value named <tt class="docutils literal">sessionid</tt> will be used. So, your web browser will send this cookie with each page request thus allowing Django
to know which bucket of information is yours (and if you&#8217;ve authenticated know who are you). This is not a Django
related concept but a general one (supported by most if not all <span class="caps">HTTP</span> frameworks) and is used to add state to an otherwise
stateless medium (<span class="caps">HTTP</span>).</p>
<p>Since the <tt class="docutils literal">sessionid</tt> cookie is sent not only with traditional but also with Ajax request it can be used to authenticate
<span class="caps">REST</span> requests after you&#8217;ve logged in. This is what is used by default in django-rest-framework and as I said in the
introduction it is a very good solution for most use cases: You login to django and you can go ahead and call the <span class="caps">REST</span>
<span class="caps">API</span> through Ajax; the <tt class="docutils literal">sessionid</tt> cookie will be sent along with the request and you&#8217;ll be&nbsp;authenticated.</p>
<p>Now, although the session authentication is nice for using in browsers, you may need to access your <span class="caps">API</span> through a desktop
or a mobile application where, setting the cookies yourself is not the optimal solution. Also, you may have an <span class="caps">SPA</span> that needs
to access an <span class="caps">API</span> in a different domain; using <a class="reference external" href="https://stackoverflow.com/questions/3342140/cross-domain-cookies">using cookies for this is not easy</a> - if possible at&nbsp;all.</p>
<p>For such cases, django-rest-framework
offers a different authentication method called <tt class="docutils literal">TokenAuthentication_</tt>. Using this method, each user of the Django application
is correlated with a random string (Token) which is passed along with the request at its header thus the Django app can authenticate
the user using this token! One thing that may seem strange is that since both the session cookie and a token are
set through <span class="caps">HTTP</span> Headers why all the fuss about tokens? Why not just use the session cookie and be done with it. Well, there are
various reasons - here&#8217;s a <cite>rather extensive article</cite> explaining some. Some of the reasons are that a token can be valid forever
while the session is something ephemeral - beyond authorization information, sessions may keep various other data for a web
application and are expired after some time to save space. Also, since tokens are used for exactly this (authentication) they
are much easier to use and reason about. Finally, as I&#8217;ve already explained, sharing cookies by multiple sites is not something
you&#8217;d like to&nbsp;do.</p>
</div>
<div class="section" id="installation-configuration">
<h2>Installation <span class="amp">&amp;</span>&nbsp;configuration</h2>
<p>To install django-rest-auth just follow <a class="reference external" href="http://django-rest-auth.readthedocs.io/en/latest/installation.html#installation">the instructions here</a> i.e just add
<tt class="docutils literal">'rest_framework', 'rest_framework.authtoken'</tt> and <tt class="docutils literal">'rest_auth'</tt> to your <cite>INSTALLED_APPS</cite> in
<tt class="docutils literal">settings.py</tt> and run&nbsp;migrate.</p>
<p>Since I won&#8217;t be adding any other apps to this project (no models are actually needed), I&#8217;ve added
two directories <tt class="docutils literal">static</tt> and <tt class="docutils literal">templates</tt> to put static files and templates there. This is configured
by adding the <tt class="docutils literal">'<span class="caps">DIRS</span>'</tt> attribte to <tt class="docutils literal"><span class="caps">TEMPLATES</span></tt>, like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="o">//</span> <span class="o">...</span>
</pre></div>
<p>and adding the <cite>STATICFILES_DIRS</cite> setting:</p>
<div class="highlight"><pre><span></span><span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s2">&quot;static&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
<p>The remaining setting are the default as were created by <tt class="docutils literal"><span class="pre">django-admin</span> startproject</tt>.</p>
<p>I have included the the following urls to <tt class="docutils literal">urls.py</tt>:</p>
<div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;test_auth/&#39;</span><span class="p">,</span> <span class="n">TestAuthView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;test_auth&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;rest-auth/logout/&#39;</span><span class="p">,</span> <span class="n">LogoutViewEx</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;rest_logout&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;rest-auth/login/&#39;</span><span class="p">,</span> <span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;rest_login&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">HomeTemplateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="p">),</span>
<span class="p">]</span> <span class="o">+</span> <span class="n">static</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">STATIC_URL</span><span class="p">,</span> <span class="n">document_root</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">STATIC_ROOT</span><span class="p">)</span>
</pre></div>
<p>These are: The django-admin, a test_auth view (that works only for authenticated users and returns their username),
<em>a view (LogoutViewEx) that overrides the rest-auth <span class="caps">REST</span> logout-view</em> (I&#8217;ll explain why this is needed in a minute),
the rest-auth <span class="caps">REST</span> login-view, the home template view (which is the only view implemented) and finally a mapping
of your static files to the <tt class="docutils literal">STATIC_URL</tt>.</p>
</div>
<div class="section" id="the-views">
<h2>The&nbsp;views</h2>
<p>There are three views in this application - the <tt class="docutils literal">HomeTemplateView</tt>, the <tt class="docutils literal">TestAuthView</tt>
and the <tt class="docutils literal">LogoutViewEx</tt> view that overrides the normal <tt class="docutils literal">LogoutView</tt> of <tt class="docutils literal"><span class="pre">django-rest-auth</span></tt>.
The first one is
a simple <tt class="docutils literal">TemplateView</tt> that just
displays an html page and loads the client side code - we&#8217;ll talk about it later in the front-side&nbsp;section.</p>
<p>The <tt class="docutils literal">TestAuthView</tt> is implemented like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestAuthView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">authentication</span><span class="o">.</span><span class="n">TokenAuthentication</span><span class="p">,)</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&quot;Hello {0}!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">))</span>
</pre></div>
<p>This is very simple however I&#8217;d like to make a few comments about the above. First of all you see that
I&#8217;ve defined <tt class="docutils literal">authentication_classes</tt> and <tt class="docutils literal">permission_classes</tt>. These options&nbsp;define</p>
<ul class="simple">
<li>which method will be used for authenticating access to the <span class="caps">REST</span> view i.e finding out if the user
requesting access has logged in and if yes what&#8217;s his username (in our case the <tt class="docutils literal">TokenAuthentication</tt> will be&nbsp;used)</li>
<li>if the user is authorized (has permission) to call this <span class="caps">REST</span> view (in our case only authenticated users will be&nbsp;allowed)</li>
</ul>
<p>The authentication and permission clases can be set globally
in your <tt class="docutils literal">settings.py</tt> using <tt class="docutils literal"><span class="pre">REST_FRAMEWORK['DEFAULT_AUTHENTICATION_CLASSES']</span></tt> and
<tt class="docutils literal"><span class="pre">REST_FRAMEWORK['DEFAULT_PERMISSION_CLASSES']</span></tt>
or defined per-class like this. If I wanted to have the same authentication and permission classes defined
in my <tt class="docutils literal">settings.py</tt> so I wouldn&#8217;t need to set these options per-class I&#8217;d add the following to my <tt class="docutils literal">settings.py</tt>:</p>
<div class="highlight"><pre><span></span><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;</span><span class="p">:</span> <span class="p">(</span>
        <span class="s1">&#39;rest_framework.authentication.TokenAuthentication&#39;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s1">&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class="p">:</span> <span class="p">(</span>
        <span class="s1">&#39;rest_framework.authentication.IsAuthenticated&#39;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">}</span>
</pre></div>
<p>Finally, keep in mind that you haven&#8217;t defined these in your views or your settings, they will have the
following <a class="reference external" href="http://www.django-rest-framework.org/api-guide/settings/#default_authentication_classes">default</a> <a class="reference external" href="http://www.django-rest-framework.org/api-guide/settings/#default_permission_classes">values</a>:</p>
<div class="highlight"><pre><span></span><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;</span><span class="p">:</span> <span class="p">(</span>
        <span class="s1">&#39;rest_framework.authentication.SessionAuthentication&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rest_framework.authentication.BasicAuthentication&#39;</span>
    <span class="p">),</span>
    <span class="s1">&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class="p">:</span> <span class="p">(</span>
        <span class="s1">&#39;rest_framework.permissions.AllowAny&#39;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">}</span>
</pre></div>
<p>The above mean that if you don&#8217;t define authentication and permission classes anywhere then the <span class="caps">REST</span>
views will use either session authentication (i.e the user has logged in normally using
the Django login views as explained before) or basic authentication
(the request provides the credentials in the header using traditional <span class="caps">HTTP</span> Basic authentication)
and also that all users (logged in or not) will be allowed to call all APIs (this is
probably not something you&nbsp;want).</p>
<p>The <tt class="docutils literal">TokenAuthentication</tt> that we are using instead means that for every user there must be a valid token which will be provided
for each request he does. The tokens are normal object instances of <tt class="docutils literal">rest_framework.authtoken.models.Token</tt>
and you can take a look at them (or even add one) through the Django admin (auth token - tokens). You can also
even do whatever you normally would do to an object instance, for&nbsp;example:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="p">[</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Token</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span>
<span class="p">[(</span><span class="o">&lt;</span><span class="n">User</span><span class="p">:</span> <span class="n">root</span><span class="o">&gt;</span><span class="p">,</span> <span class="s1">&#39;db4dcc1b9d00d1af74fb3cb41e1f9e673208485b&#39;</span><span class="p">)]</span>
</pre></div>
<p>To authenticate with a token (using <a class="reference external" href="http://www.django-rest-framework.org/api-guide/authentication/#tokenauthentication">TokenAuthentication</a>), you must add an extra header to your request with the format
<tt class="docutils literal">Authorization: Token token</tt> for example in the previous case <tt class="docutils literal">root</tt> would add
<tt class="docutils literal">Authorization: Token db4dcc1b9d00d1af74fb3cb41e1f9e673208485b</tt>. To do this you&#8217;ll need something
client-side code which we&#8217;ll see in the next&nbsp;section.</p>
<p>To do it with <a class="reference external" href="https://curl.haxx.se">curl</a> you can just do something like&nbsp;this:</p>
<div class="highlight"><pre><span></span>curl http://127.0.0.1:8000/test_auth/ -H <span class="s2">&quot;Authorization:Token db4dcc1b9d00d1af74fb3cb41e1f9e673208485b&quot;</span>
</pre></div>
<p>Try it with a valid and invalid token and without providing a token at all and see the response each&nbsp;time.</p>
<p>So, django-rest-framework provides the model (Token) and the mechanism (add the extra Authentication header) for
authentication with Tokens. What it does not provide is a simple way to create/remove tokens for users: This
is where <tt class="docutils literal"><span class="pre">django-rest-auth</span></tt> comes to the rescue! Its login and logout <span class="caps">REST</span> views will automatically
create (and delete) tokens for the users that are logging in. They will also authenticate the user
normally (using sessions) - this means that if a user logs in using the login <span class="caps">REST</span> endpoint he&#8217;ll then
be logged in normally to the site and be able to access non-<span class="caps">REST</span> parts of the site (for example the django-admin).
Also, if the user logs in through the django-rest-auth <span class="caps">REST</span> end point and if you have are using <tt class="docutils literal">SessionAuthentication</tt>
to one of your views then he&#8217;ll be able to authenticate to these views <em>without</em> the need to pass the token (can
you understand&nbsp;why?).</p>
<p>Finally, let&#8217;s take a look at the <tt class="docutils literal">LogoutViewEx</tt>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LogoutViewEx</span><span class="p">(</span><span class="n">LogoutView</span><span class="p">):</span>
    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">authentication</span><span class="o">.</span><span class="n">TokenAuthentication</span><span class="p">,)</span>
</pre></div>
<p>This class only defines the authentication_classes attribute. Is this really needed? Well, it depends on
you project. If you take a look at the source code of <tt class="docutils literal">LogoutView</tt> (<a class="reference external" href="https://github.com/Tivix/django-rest-auth/blob/master/rest_auth/views.py#L99">https://github.com/Tivix/django-rest-auth/blob/master/rest_auth/views.py#L99</a>)
you&#8217;ll see that it does not define <tt class="docutils literal">authentication_classes</tt>. This, as we&#8217;ve already discussed, means that it will
fall-back to whatever you have defined in the settings (or the defaults of django-rest-framework). So, if you haven&#8217;t
defined anything in the settings then you&#8217;ll get the by default the
SessionAuthentication and BasicAuthentication methods (hint: <em>not</em> the <tt class="docutils literal">TokenAuthentication</tt>). This means that you won&#8217;t be able to
logout when you pass the token (but <em>will</em> be able to logout from the web-app after you login - why?). So to make everything
crystal and be able to reason better about the behavior I specifically define the <tt class="docutils literal">LogoutViewEx</tt> to use the <tt class="docutils literal">TokenAuthentication</tt> - that&#8217;s
what you&#8217;d use if you developed a mobile or desktop app&nbsp;anyway.</p>
</div>
<div class="section" id="the-client-side-scripts">
<h2>The client side&nbsp;scripts</h2>
<p>I&#8217;ve included all client-side code to a <tt class="docutils literal">home.html</tt> template that is loaded
from the <tt class="docutils literal">HomeTemplateView</tt>. The client-side code has been implemented only with jQuery because I think
this is the library that most people are familiar with - and is really easy to be understood even if you
are not familiar with it. It more or less consists of four sections in&nbsp;html:</p>
<ul class="simple">
<li>A user-is-logged-in section that displays the username and the logout&nbsp;button</li>
<li>A user-is-not-logged-in section that displays a message and the login&nbsp;button</li>
<li>A test-auth section that displays a button for calling the <tt class="docutils literal">TestAuthView</tt> defined previously and outputs its&nbsp;response</li>
<li>The login&nbsp;modal</li>
</ul>
<p>Here&#8217;s the html (using spectre.css for&nbsp;styling):</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container grid-lg&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Test<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;columns&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;non-logged-in&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-3&#39;</span><span class="p">&gt;</span>
            You have to log-in!
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-3&#39;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span>  <span class="na">id</span><span class="o">=</span><span class="s">&#39;loginButton&#39;</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;columns&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;logged-in&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-3&#39;</span><span class="p">&gt;</span>
            Welcome <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;span-username&#39;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>!
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-3&#39;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span>  <span class="na">id</span><span class="o">=</span><span class="s">&#39;logoutButton&#39;</span><span class="p">&gt;</span>Logout<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;columns&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;test&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-3&#39;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span>  <span class="na">id</span><span class="o">=</span><span class="s">&#39;testAuthButton&#39;</span><span class="p">&gt;</span>Test auth<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-9&#39;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;test-auth-response&#39;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;login-modal&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#close&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-overlay close-modal&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-container&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-header&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#close&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-clear float-right close-modal&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-title h5&quot;</span><span class="p">&gt;</span>Please login<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-body&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>
                    {% csrf_token %}
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-label&quot;</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;input-username&quot;</span><span class="p">&gt;</span>Username<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-input&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;input-username&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Name&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-label&quot;</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;input-password&quot;</span><span class="p">&gt;</span>Password<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-input&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;input-password&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Password&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-checkbox&quot;</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;input-local-storage&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;input-local-storage&quot;</span> <span class="p">/&gt;</span> <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-icon&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>  Use local storage (remember me)
                        <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;label label-error mt-1 d-invisible&#39;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;modal-error&#39;</span><span class="p">&gt;</span>
                    Unable to login!
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-footer&quot;</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;loginOkButton&#39;</span> <span class="p">&gt;</span>Ok<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#close&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn close-modal&quot;</span> <span class="p">&gt;</span>Close<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>The html is very simple and I don&#8217;t think I need to explain much  - notice that the <cite>#logged-in</cite> and
<cite>#non-logged-in</cite> sections are mutually exclusive (I use <tt class="docutils literal">$.show()</tt> and <tt class="docutils literal">$.hide()</tt> to show and hide them) but the <cite>#test</cite> section is always displayed
so you&#8217;ll be able to call the test <span class="caps">REST</span> <span class="caps">API</span> when you are and are not authenticated. For the modal
to be displayed you need to add an <tt class="docutils literal">active</tt> class to its <tt class="docutils literal">#modal</tt> container.</p>
<p>For the javascript, let&#8217;s take a look at some initialization&nbsp;stuff:</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">g_urls</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;login&#39;</span><span class="o">:</span> <span class="s1">&#39;{% url &quot;rest_login&quot; %}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;logout&#39;</span><span class="o">:</span> <span class="s1">&#39;{% url &quot;rest_logout&quot; %}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;test_auth&#39;</span><span class="o">:</span> <span class="s1">&#39;{% url &quot;test_auth&quot; %}&#39;</span><span class="p">,</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">g_auth</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">g_auth</span> <span class="o">=</span> <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nx">g_auth</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">g_auth</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">getCookie</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">cookieValue</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">cookies</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">cookies</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">cookie</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">cookies</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="c1">// Does this cookie string begin with the name we want?</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">name</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">cookieValue</span> <span class="o">=</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">cookieValue</span><span class="p">;</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">g_csrftoken</span> <span class="o">=</span> <span class="nx">getCookie</span><span class="p">(</span><span class="s1">&#39;csrftoken&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">initLogin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#non-logged-in&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#logged-in&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#span-username&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">.</span><span class="nx">username</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">.</span><span class="nx">remember_me</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#non-logged-in&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#logged-in&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#span-username&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">);</span>
        <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#test-auth-response&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
<p>First of all, I define a <tt class="docutils literal">g_urls</tt> window/global object that will keep the required <span class="caps">REST</span> <span class="caps">URLS</span> (login/logout and test auth). These
are retrieved from Django using the <tt class="docutils literal">{% url %}</tt> template tag and are not hard-coded.
After that, I check to see if the user has authenticated before. Notice that because
this is client-side code, I need to do that every time the page loads or else the <span class="caps">JS</span> won&#8217;t be initialized properly! The user login
information is stored to an object named <tt class="docutils literal">g_auth</tt> and contains two attributes: <tt class="docutils literal">username</tt>, <tt class="docutils literal">key</tt> (token) and <tt class="docutils literal">remember_me</tt>.</p>
<p>To keep the login information I use either a key named <tt class="docutils literal">auth</tt> to either the <tt class="docutils literal">localStorage</tt> or the <tt class="docutils literal">sessionStorage</tt>. The <tt class="docutils literal">sessionStorage</tt> is used to save
info for the current browser tab (<em>not</em> window) while the <tt class="docutils literal">localStorage</tt> saves info for ever (until somebody deletes it). Thus,
<tt class="docutils literal">localStorage</tt> can be used for implementing a &#8220;remember me&#8221; functionality. Notice that instead of using the session/local storage
I could instead integrate the user login information with the Django back-end. To do this I&#8217;d need to see if the current user has
a session login and if yes pass his username and token to  Javascript. These values would then be read by the login initialization
code. I&#8217;m leaving this as an exercise for attentive&nbsp;readers.</p>
<p>Getting the login information from the session probably is a better solution for web-apps however I think that using the local or session storage emulate better a more
general (and completely stateless) behaviour especially considering that the <span class="caps">API</span> may be used for mobible/desktop&nbsp;apps.</p>
<p>In any case, after you&#8217;ve initialized the <tt class="docutils literal">g_auth</tt> object you&#8217;ll need to read the <span class="caps">CSRF</span> cookie. By default Django requires
<a class="reference external" href="https://docs.djangoproject.com/en/2.0/ref/csrf/"><span class="caps">CSRF</span> protection</a> for all <tt class="docutils literal"><span class="caps">POST</span></tt> requests (we do a <span class="caps">POST</span> request for login and logout). What happens here is that for pages that may
need to do a <tt class="docutils literal"><span class="caps">POST</span></tt> request, Django will set a cookie (<span class="caps">CSRF</span> cookie) in its initial response. You&#8217;ll need to read that cookie and submit its
value along with the rest of your form fields when you do the <span class="caps">POST</span>. So the <tt class="docutils literal">getCookie</tt> function is just used to set the <tt class="docutils literal">g_csrftoken</tt> with the value
of the <span class="caps">CSRF</span>&nbsp;cookie.</p>
<p>The final function we define here (which is called a little later) checks to see if there is login information and hides/displays the correct
things in html. It will also set the local or session storage (depending on remember me&nbsp;value).</p>
<p>After that, we have some client side code that is inside the <tt class="docutils literal">$()</tt> function which will be called after the page has completely&nbsp;loaded:</p>
<div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">initLogin</span><span class="p">();</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#loginButton&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#login-modal&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.close-modal&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#login-modal&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#testAuthButton&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="nx">url</span><span class="o">:</span> <span class="nx">g_urls</span><span class="p">.</span><span class="nx">test_auth</span><span class="p">,</span>
            <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="nx">beforeSend</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">request</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Authorization&quot;</span><span class="p">,</span> <span class="s2">&quot;Token &quot;</span> <span class="o">+</span> <span class="nx">g_auth</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#test-auth-response&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&lt;span class=&#39;label label-success&#39;&gt;Ok! Response: &quot;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">);</span>
        <span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#test-auth-response&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&lt;span class=&#39;label label-error&#39;&gt;Fail! Response: &quot;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">responseText</span> <span class="o">+</span> <span class="s2">&quot; (status: &quot;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">status</span><span class="o">+</span><span class="s2">&quot;)&lt;/span&gt;&quot;</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>


    <span class="c1">// continuing below ...</span>
</pre></div>
<p>The first thing happening here is to call the <tt class="docutils literal">initLogin</tt> function to properly intiialize the page and then we add a couple of
handlers to the click buttons of the <tt class="docutils literal">#loginButton</tt> (which just displays the modal by adding the <tt class="docutils literal">active</tt> class ),
<tt class="docutils literal"><span class="pre">.close-modal</span></tt> class (there are multiple
ways to close the modal thus I use a class which just removes that <tt class="docutils literal">active</tt> class) and finally to the <tt class="docutils literal">#testAuthButton</tt>. This
button will do a <tt class="docutils literal"><span class="caps">GET</span></tt> request to the <tt class="docutils literal">g_urls.test_auth</tt> we defined before. The important thing to notice here is that we add
a <tt class="docutils literal">beforeSend</tt> attribute to the <tt class="docutils literal">$.ajax</tt> request which, if <tt class="docutils literal">g_auth</tt> is defined adds an <tt class="docutils literal">Authorization</tt> header with the token
in the form that django-rest-framework <tt class="docutils literal">TokenAuthentication</tt> expects and as we&#8217;ve already discussed&nbsp;above:</p>
<div class="highlight"><pre><span></span><span class="nx">beforeSend</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">request</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Authorization&quot;</span><span class="p">,</span> <span class="s2">&quot;Token &quot;</span> <span class="o">+</span> <span class="nx">g_auth</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>If this ajax call returns ok (<tt class="docutils literal">done</tt> part) we just add the <tt class="docutils literal">Ok</tt> to a green label else if there&#8217;s an error (<tt class="docutils literal">fail</tt> part)
we add the response text and status to a red label. You can try clicking the button and you see that only if you&#8217;ve logged in
you will succeed in this&nbsp;call.</p>
<p>Let&#8217;s now take a look at the <tt class="docutils literal">#loginOkbutton</tt> click handler (inside the&nbsp;modal):</p>
<div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#loginOkButton&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#input-username&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#input-password&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">remember_me</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#input-local-storage&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">username</span> <span class="o">&amp;&amp;</span> <span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Will try to login with &quot;</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#modal-error&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;d-invisible&#39;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="nx">url</span><span class="o">:</span> <span class="nx">g_urls</span><span class="p">.</span><span class="nx">login</span><span class="p">,</span>
            <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">username</span><span class="o">:</span> <span class="nx">username</span><span class="p">,</span>
                <span class="nx">password</span><span class="o">:</span> <span class="nx">password</span><span class="p">,</span>
                <span class="nx">csrfmiddlewaretoken</span><span class="o">:</span> <span class="nx">g_csrftoken</span>
            <span class="p">}</span>
        <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;DONE: &quot;</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
            <span class="nx">g_auth</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">username</span><span class="o">:</span> <span class="nx">username</span><span class="p">,</span>
                <span class="nx">key</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span>
                <span class="nx">remember_me</span><span class="o">:</span> <span class="nx">remember_me</span>
            <span class="p">};</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#login-modal&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>
            <span class="nx">initLogin</span><span class="p">();</span>
            <span class="c1">// CAREFUL! csrf token is rotated after login: https://docs.djangoproject.com/en/1.7/releases/1.5.2/#bugfixes</span>
            <span class="nx">g_csrftoken</span> <span class="o">=</span> <span class="nx">getCookie</span><span class="p">(</span><span class="s1">&#39;csrftoken&#39;</span><span class="p">);</span>
        <span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;FAIL&quot;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#modal-error&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;d-invisible&#39;</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#modal-error&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;d-invisible&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<p>All three user inputs (<tt class="docutils literal">username, password, remember_me</tt>) are read from the form and if both username and
password have been defined an Ajax request will be done to the <tt class="docutils literal">g_urls.login</tt> url. We pass
<tt class="docutils literal">username, password</tt> <em>and</em> <tt class="docutils literal">g_csrftoken</tt> (as discussed before) as the request data. Now, if there&#8217;s an
error (<tt class="docutils literal">fail</tt>) I just display a generic message (by removing it&#8217;s <cite>d-invisible</cite> class) while, if the
request was Ok I retrieve the <tt class="docutils literal">key</tt> (token) from the response, initialize the <tt class="docutils literal">g_auth</tt> object with the
<tt class="docutils literal">username</tt>, <tt class="docutils literal">key</tt> and <tt class="docutils literal">remember_me</tt> values and call <tt class="docutils literal">initLogin</tt> to show the correct divs and save
to the session/local&nbsp;storage.</p>
<p>It is important to keep in mind that with the line <tt class="docutils literal">g_csrftoken = <span class="pre">getCookie('csrftoken')</span></tt>
we re-read the <span class="caps">CSRF</span> cookie. This is needed because, as you can see in the mentioned link in the comment,
after Django logs in, the csrf cookie value is rotated for security reasons so it must be re-read here (or else
the <tt class="docutils literal">logout</tt> that is also a <span class="caps">POST</span> request will not&nbsp;work).</p>
<p>Finally, here&#8217;s the code for logout (still inside the <tt class="docutils literal">$(function () {</tt>):</p>
<div class="highlight"><pre><span></span>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#logoutButton&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Trying to logout&quot;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="nx">url</span><span class="o">:</span> <span class="nx">g_urls</span><span class="p">.</span><span class="nx">logout</span><span class="p">,</span>
            <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
            <span class="nx">beforeSend</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">request</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Authorization&quot;</span><span class="p">,</span> <span class="s2">&quot;Token &quot;</span> <span class="o">+</span> <span class="nx">g_auth</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">csrfmiddlewaretoken</span><span class="o">:</span> <span class="nx">g_csrftoken</span>
            <span class="p">}</span>
        <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;DONE: &quot;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
            <span class="nx">g_auth</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="nx">initLogin</span><span class="p">();</span>
        <span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;FAIL: &quot;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>

<span class="p">});</span> <span class="c1">// End of $(function () {</span>
</pre></div>
<p>The code here is very simple - just do a <tt class="docutils literal"><span class="caps">POST</span></tt> to the <tt class="docutils literal">g_urls.logout</tt>  and if everything is ok delete the <tt class="docutils literal">g_auth</tt> values
and call <tt class="docutils literal">initLogin()</tt> to show the correct divs and remove the <tt class="docutils literal">auth</tt> key from local/session storage. Notice that when
you <tt class="docutils literal"><span class="caps">POST</span></tt> to the <tt class="docutils literal">logout</tt> <span class="caps">REST</span> end-point, you need to also add the <tt class="docutils literal">Authorization</tt> header with the token or else
(since we&#8217;ve defined only <tt class="docutils literal">TokenAuthentication</tt> for the <tt class="docutils literal">authentication_classes</tt> for the <tt class="docutils literal">LogoutViewEx</tt> class)
there won&#8217;t be any way to correlate the request with the user and log him&nbsp;out!</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>Using the info presented on this article you should be able to properly login and logout to Django using <span class="caps">REST</span> and
also call <span class="caps">REST</span> end-points as an authenticated used. I recommend using the <tt class="docutils literal">curl</tt> utility to try to call the rest
end point with various parameters to see the response. Also, you change the <tt class="docutils literal">LogoutViewEx</tt> with the
default django-rest-auth <tt class="docutils literal">LogoutView</tt> and then try logging out through the web-app <em>and</em> through curl and see
what happens when you try to access the test-auth&nbsp;end-point.</p>
<p>Finally, the above project can be easily modified to use
<tt class="docutils literal">SessionAuthentication</tt> instead of <tt class="docutils literal">TokenAuthentication</tt> (so you won&#8217;t need <tt class="docutils literal"><span class="pre">django-rest-auth</span></tt> at all) - I&#8217;m
leaving it as an exercise to the&nbsp;reader.</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2017/12/20/python-2-3-windows/">Using both Python 2 and 3 in Windows</a>
      </h1>
    <p class="meta">
<time datetime="2017-12-20T11:20:00+02:00" pubdate>Τετ 20 Δεκέμβριος 2017</time>    </p>
</header>

<div class="entry-content"><p>The release of Django 2.0 was a milestone in the history of Python since it
completely dropped support for Python 2.x. I am a long time user of Django
and, loyal to the philosophy of &#8220;if it is working don&#8217;t change&#8221; I was always
using Python&nbsp;2.x.</p>
<p>Of course right now this needs to change since new applications will need to
be developed to the latest version of Django (and Python). I am using
Windows for development (almost exclusively) and what I wanted was to
be able to create and use virtual environments for both my old projects
(using Python 2) and new projects (using Python&nbsp;3).</p>
<p>The above requirement is not as straight-forward as I&#8217;d like - actually it is
if you know what you need to do and which tools you must use. That&#8217;s why I
decided to write a quick step by step tutorial on how to use both versions
of Python in your Windows environment. Notice that I am using Windows 10,
Python 2.7.14 an Python&nbsp;3.6.4.</p>
<p>First of all, let&#8217;s download both versions of Python
from the <a class="reference external" href="https://www.python.org/downloads/">Python download page</a>. I downloaded the files
python-2.7.14.msi and python-3.6.4.exe (not sure why the one is .msi and the other
is .exe it doesn&#8217;t matter&nbsp;anyway).</p>
<p>Firstly I am installing Python 2.7.14 and&nbsp;selecting:</p>
<ul class="simple">
<li>Install for all&nbsp;users</li>
<li>Install to default&nbsp;folder</li>
<li>Press next to following screen (install default&nbsp;customizations)</li>
<li>This won&#8217;t add the python.exe of Python 2.7 to&nbsp;path</li>
</ul>
<p>Next I am install Python&nbsp;3.6.4:</p>
<ul class="simple">
<li>Make sure to click &#8220;Install launcher for all users&nbsp;(recommended)&#8221;</li>
<li>I also check &#8220;Add Python 3.6to <span class="caps">PATH</span>&#8221; (to add the Python 3.6 executable to&nbsp;path)</li>
<li>I then just click &#8220;Install Now&#8221; (this will put Python 3.6 to&nbsp;c:)</li>
</ul>
<p>Right now if you open a terminal window (Windows+r, cmd.exe) and run Python you will
initiate the Python 3.6 interpreter. This is useful for just dropping in a Python&nbsp;interpreter.</p>
<p>Remember the &#8220;Install launcher for all users (recommended)&#8221; we clicked before? This installs
the python launcher which is used to select between Python versions.
If you run it without parameters the Python 3.6 interpreter will by started. You can pass
the -2 parameter to start the python 2.x interpreter or -3 to explicitly declare the
python 3.x&nbsp;interpreter:</p>
<pre class="code literal-block">
C:\Users\Serafeim&gt;py -2
Python 2.7.14 (v2.7.14:84471935ed, Sep 16 2017, 20:19:30) [MSC v.1500 32 bit (Intel)] on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; ^Z


C:\Users\Serafeim&gt;py -3
Python 3.6.4 (v3.6.4:d48eceb, Dec 19 2017, 06:04:45) [MSC v.1900 32 bit (Intel)] on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; ^Z
</pre>
<p>With py we can easily start the Python interpreter we want. This is not enough though - we
need to use virtualenv and create proper virtual environments for our projects. To do this
you can add the -m option to py to run a module with the proper python version. For example,
to start an http server with Python 2 you would use the module <tt class="docutils literal">SimpleHTTPServer</tt> while
for python 3 you would use <tt class="docutils literal">http.server</tt> (<a class="reference external" href="https://stackoverflow.com/questions/7943751/what-is-the-python-3-equivalent-of-python-m-simplehttpserver">as per this</a>):</p>
<pre class="code literal-block">
C:\progr\py\pelican\spapas.github.io&gt;py -2 -m SimpleHTTPServer
Serving HTTP on 0.0.0.0 port 8000 ...

C:\progr\py\pelican\spapas.github.io&gt;py -3 -m http.server
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
</pre>
<p>Now, to create the virtual environments we&#8217;ll use the virtualenv module which is installed
by default in Python 2.x (try running <tt class="docutils literal">py <span class="pre">-2</span> <span class="pre">-m</span> pip freeze</tt> to see the list of installed
packages for Python 2.x) and the venv module which is included in the Python 3.x core. So
to create a virtualenv for Python 2 we&#8217;ll run <tt class="docutils literal">py <span class="pre">-2</span> <span class="pre">-m</span> virtualenv <span class="pre">name-of-virtualenv</span></tt>
and for Python 3 <tt class="docutils literal">py <span class="pre">-3</span> <span class="pre">-m</span> venv <span class="pre">name-of-virtualenv</span></tt>.</p>
<pre class="code literal-block">
C:\progr\py&gt;py -2 -m virtualenv venv-2
New python executable in C:\progr\py\venv-2\Scripts\python.exe
Installing setuptools, pip, wheel...done.

C:\progr\py&gt;py -3 -m venv venv-3

C:\progr\py&gt;venv-2\Scripts\activate

(venv-2) C:\progr\py&gt;python -V
Python 2.7.14

(venv-2) C:\progr\py&gt;deactivate

C:\progr\py&gt;venv-3\Scripts\activate

(venv-3) C:\progr\py&gt;python -V
Python 3.6.4
</pre>
<p>That&#8217;s how easy it is to have both Python 2.7 and Python 3.6 in your&nbsp;Windows!</p>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2017/10/11/essential-django-packages/">My essential django package list</a>
      </h1>
    <p class="meta">
<time datetime="2017-10-11T14:20:00+03:00" pubdate>Τετ 11 Οκτώβριος 2017</time>    </p>
</header>

<div class="entry-content"><p>In this article I&#8217;d like to present a list of django packages (add-ons) that I use
in most of my projects. I am using django for more than 5 years as my day to
day work tool to develop applications for the public sector organization I work for.
So please keep in mind that these packages are targeted to the &#8220;enterpripse&#8221;
audience and some things that target public (open access) web apps may be&nbsp;missing.</p>
<p>Some of these packages are included in
<a class="reference external" href="https://github.com/spapas/cookiecutter-django-starter">a django cookiecutter</a> I am using to start new projects and also you can find
example usage of some of these packages in my <a class="reference external" href="https://github.com/spapas/mailer_server">Mailer Server</a> project.
I&#8217;ll also be happy to answer any
questions about these, preferably in <a class="reference external" href="https://stackoverflow.com">stackoverflow</a> if the questions are fit for that&nbsp;site.</p>
<p>Finally, before going to the package list, notice that most of the following are django-related and I won&#8217;t include any
generic python packages (with the exception of xhtml2pdf which I discuss later). There
are a bunch of python-generic packages that I usually use (xlrd, xlwt, requests, raven, unidecode,
database connectors etc) but these won&#8217;t be discussed&nbsp;here.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#packages-i-use-in-all-my-projects" id="id30">Packages I use in all my projects</a><ul>
<li><a class="reference internal" href="#django-tables2" id="id31">django-tables2</a></li>
<li><a class="reference internal" href="#django-filter" id="id32">django-filter</a></li>
<li><a class="reference internal" href="#django-crispy-forms" id="id33">django-crispy-forms</a></li>
<li><a class="reference internal" href="#django-extensions" id="id34">django-extensions</a></li>
<li><a class="reference internal" href="#django-autocomplete-light" id="id35">django-autocomplete-light</a></li>
<li><a class="reference internal" href="#django-reversion" id="id36">django-reversion</a></li>
<li><a class="reference internal" href="#django-compressor" id="id37">django-compressor</a></li>
<li><a class="reference internal" href="#django-debug-toolbar" id="id38">django-debug-toolbar</a></li>
</ul>
</li>
<li><a class="reference internal" href="#packages-i-use-when-i-need-their-functionality" id="id39">Packages I use when I need their functionality</a><ul>
<li><a class="reference internal" href="#xhtml2pdf" id="id40">xhtml2pdf</a></li>
<li><a class="reference internal" href="#django-auth-ldap" id="id41">django-auth-ldap</a></li>
<li><a class="reference internal" href="#django-localflavor" id="id42">django-localflavor</a></li>
<li><a class="reference internal" href="#django-constance" id="id43">django-constance</a></li>
<li><a class="reference internal" href="#django-rq" id="id44">django-rq</a></li>
<li><a class="reference internal" href="#django-rules-light" id="id45">django-rules-light</a></li>
<li><a class="reference internal" href="#django-generic-scaffold" id="id46">django-generic-scaffold</a></li>
<li><a class="reference internal" href="#django-taggit" id="id47">django-taggit</a></li>
<li><a class="reference internal" href="#django-sendfile" id="id48">django-sendfile</a></li>
<li><a class="reference internal" href="#django-reversion-compare" id="id49">django-reversion-compare</a></li>
<li><a class="reference internal" href="#django-simple-history" id="id50">django-simple-history</a></li>
<li><a class="reference internal" href="#django-import-export" id="id51">django-import-export</a></li>
<li><a class="reference internal" href="#django-extra-views" id="id52">django-extra-views</a></li>
<li><a class="reference internal" href="#easy-thumbnails" id="id53">easy-thumbnails</a></li>
<li><a class="reference internal" href="#django-rest-framework" id="id54">django-rest-framework</a></li>
<li><a class="reference internal" href="#django-waffle" id="id55">django-waffle</a></li>
<li><a class="reference internal" href="#django-allauth" id="id56">django-allauth</a></li>
<li><a class="reference internal" href="#django-modeltranslation" id="id57">django-modeltranslation</a></li>
<li><a class="reference internal" href="#django-widget-tweaks" id="id58">django-widget-tweaks</a></li>
<li><a class="reference internal" href="#django-simple-captcha" id="id59">django-simple-captcha</a></li>
<li><a class="reference internal" href="#wagtail" id="id60">wagtail</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion" id="id61">Conclusion</a></li>
</ul>
</div>
<div class="section" id="packages-i-use-in-all-my-projects">
<h2>Packages I use in all my&nbsp;projects</h2>
<p>These packages are used more or less in all my projects - I just install them when I
create a new project (or create the project through the cookiecutter I mention&nbsp;above)/</p>
<div class="section" id="django-tables2">
<h3>django-tables2</h3>
<p><a class="reference external" href="https://github.com/bradleyayers/django-tables2">django-tables2</a>, along with django-filter (following) are the two packages
I always use in my projets. You create a <cite>tables.py</cite> module inside your applications
where you define a bunch of tables using more or less the same methodology as with
django-forms: For a <cite>Book</cite> model, Create a <cite>BookTable</cite> class, relate it with the model
and, if needed override some of the columns it automatically generates. For example you
can configure a column that will behave as a link to a detail view of the book, a column
that will behave as a date (with the proper formatting) or even a column that will display
a custom django template&nbsp;snippet.</p>
<p>You&#8217;ll then be
able to configure the data (queryset) of this table and pass it your views context. Finally
use <tt class="docutils literal">{% render_table table %}</tt> to actually display your table. What
you&#8217;ll get? The actual html table (with a nice style that can be configured if needed),
free pagination and free column-header sorting. After you get the hang of it, you&#8217;ll be
able to add tables for your models in a couple of minutes - this is <span class="caps">DRY</span> for me. It also
offers some <a class="reference external" href="http://django-tables2.readthedocs.io/en/latest/pages/generic-mixins.html">class based views and mixins</a> for even more <span class="caps">DRY</span> adding tables to your&nbsp;views.</p>
<p>Finally, please notice that since version 1.8,
django-tables2 <a class="reference external" href="https://django-tables2.readthedocs.io/en/latest/pages/export.html">supports exporting data</a> using <a class="reference external" href="https://github.com/kennethreitz/tablib">tablib</a>, an old requirement of most users
of this&nbsp;library.</p>
</div>
<div class="section" id="django-filter">
<h3>django-filter</h3>
<p><a class="reference external" href="https://github.com/carltongibson/django-filter">django-filter</a> is used to create filters for your data. It plays well with
django-tables2 but you can use it to create filters for any kind of listing you want. It
works similar to django-tables2: Create a <tt class="docutils literal">filters.py</tt> module in your application and define
the a <cite>BookFilter</cite> class there by relating it with the <cite>Book</cite> model, specifying the fields
of the model you want to filter with and maybe override some of the default options. New versions
have some great built-in configuration functionality by customizing which method will be used for
filtering or even adding multiple filter methods - for example you could define your
<tt class="docutils literal">BookFilter</tt> like&nbsp;this:</p>
<pre class="code literal-block">
class BookFilter(django_filters.FilterSet):
    class Meta:
        model = Book
        fields = {
            'name': ['icontains'],
            'author__last_name': ['icontains', 'startswith'],
            'publication_date': ['year', 'month', ],
        }
</pre>
<p>which will give you the following filter form&nbsp;fields:</p>
<ul class="simple">
<li>an ilike &#8216;%value%&#8217; for the book&nbsp;name</li>
<li>an ilike &#8216;%value%&#8217; for the author&nbsp;name</li>
<li>a like &#8216;value%&#8217; for the author&nbsp;name</li>
<li>a year(publication_date) = value for the&nbsp;publication_date</li>
<li>a month(publication_date) = value for the&nbsp;publication_date</li>
</ul>
<p>and their (<span class="caps">AND</span>)&nbsp;combinations!</p>
<p>The <cite>BookFilter</cite> can be used to create a filter form in your template and then in your views
pass to it the initial queryset along with <cite>request.<span class="caps">GET</span></cite> (which will contain the filter values)
to return the filtered data (and usually pass it to the table). I&#8217;ve created a sample project that
uses both django-tables2 and django-filters for you to use: <a class="reference external" href="https://github.com/spapas/django_table_filtering">https://github.com/spapas/django_table_filtering</a>.
Also, I&#8217;ve written an article which describes a technique for <a class="reference external" href="https://spapas.github.io/2015/10/05/django-dynamic-tables-similar-models/">automatically creating a filter-table view</a>.</p>
</div>
<div class="section" id="django-crispy-forms">
<h3>django-crispy-forms</h3>
<p>The forms that are created by default by django-forms are very basic and not styled properly.
To overcome this and have better styles for my forms, I always use <a class="reference external" href="https://github.com/django-crispy-forms/django-crispy-forms">django-crispy-forms</a>. It actually has two modes: Using the crispy template filter and using
the crispy template tag. Using the crispy template filter is very simple - just take a plain old django form and
render it in your template like this <cite>{{ form|crispy }}</cite>. If the django-crispy-forms has been configured correctly
(with the correct template pack) the form you&#8217;ll get will be much nicer than the django-default one. This is completely
automatic, you don&#8217;t need to do anything&nbsp;else!</p>
<p>Now, if you have some special requirements from a form, for example
multi-column rendering, adding tabs, accordions etc then you&#8217;ll need to use the <cite>{% crispy %}</cite> template tag. To use this
you must create the layout of your form in the form&#8217;s costructor using the FormHelper django-crispy-forms <span class="caps">API</span>. This may seem cumbersome
at first (why not just create the form&#8217;s layout in the django template) but using a class to define your form&#8217;s layout
has other advantages, for example all the form layout is in the actual form (not in the template) you can control
programatically the layout of the form (f.e display some fields only for administrators), you can use inheritance and
virtual methods to override how a form is rendered&nbsp;etc.</p>
<p>To help you understand how a <tt class="docutils literal">FormHelper</tt> looks like, here&#8217;s a form that is used to edit an access Card for visitors that
displays all fields horizontally inside a panel (I am using Bootstrap for all styling and layout&nbsp;purposes):</p>
<pre class="code literal-block">
class CardForm(ModelForm):
    class Meta:
        model = Card
        fields = ['card_number', 'card_text', 'enabled']

    def __init__(self, *args, **kwargs):
        self.helper = FormHelper()
        self.helper.form_method = 'post'
        self.helper.layout = Layout(
            Fieldset(
                '',
                HTML(u&quot;&quot;&quot;&lt;div class=&quot;panel panel-primary&quot;&gt;
                   &lt;div class=&quot;panel-heading&quot;&gt;
                       &lt;h3 class=&quot;panel-title&quot;&gt;Add card&lt;/h3&gt;
                   &lt;/div&gt;
                   &lt;div class=&quot;panel-body&quot;&gt;&quot;&quot;&quot;),
                Div(
                   Div('card_number', css_class='col-md-4'),
                   Div('card_text', css_class='col-md-4'),
                   Div('enable',css_class='col-md-4'),
                   css_class='row'
                ),
            ),

            FormActions(
                Submit('submit', u'Save', css_class='btn btn-success'),
                HTML(u&quot;&lt;a class='btn btn-primary' href='{% url \&quot;card_list\&quot; %}'&gt;Return&lt;/a&gt;&quot; ),
            ),
            HTML(u&quot;&lt;/div&gt;&lt;/div&gt;&quot;),
        )

        super(CardForm, self).__init__(*args, **kwargs)
</pre>
<p>Notice that forms that will be rendered with a <tt class="docutils literal">FormHelper</tt> actually contain their &lt;form&gt; tag (you don&#8217;t need
to write it yourself like with plain django forms) so you have to define their method (post in this example) and submit&nbsp;button.</p>
</div>
<div class="section" id="django-extensions">
<h3>django-extensions</h3>
<p><a class="reference external" href="https://github.com/django-extensions/django-extensions">django-extensions</a> is a swiss-army-knife of django tools. I use it <em>always</em> in my projects because of the <cite>runserver_plus</cite>
and <cite>shell_plus</cite> commands. The first uses the <a class="reference external" href="https://spapas.github.io/2016/06/07/django-werkzeug-debugger/">Werkzeug debugger with django</a> which makes django development an absolute joy
(open a python shell wherever you want in your code and start writing commands)!
The second opens a <em>better</em> shell (your models and a bunch of django stuff are auto-imported, a better shall will be used if found&nbsp;etc).</p>
<p>The
<cite>runserver_plus</cite> and <cite>shell_plus</cite> alone will be more than enough for me to use this however it adds some more usefull management
commands like: <cite>admin_generator</cite> to quickly create an admin.py for your app, <cite>graph_models</cite> to generate a graphviz dot file of your models,
<cite>update_permissions</cite> to synchronize the list of permissions if you have added one to an existing model and <a class="reference external" href="http://django-extensions.readthedocs.io/en/latest/command_extensions.html">many, many others</a>. Take a look
at them and you&#8217;ll probably find more useful&nbsp;things!</p>
</div>
<div class="section" id="django-autocomplete-light">
<h3>django-autocomplete-light</h3>
<p><a class="reference external" href="https://github.com/yourlabs/django-autocomplete-light">django-autocomplete-light</a> is the best auto-complete library for django, especially after v3 was released (which greatly reduces the magic and
uses normal CBVs for configuring the querysets). You will create
an AutocompleteView for a model (similar to your other class based views) and then automatically use this view through a widget in the admin
or in your own forms. It is fully configurable (both the results and the selection templates), supports many to many fields, creating new instances
and even autocompleteing django-taggit tags! If for some reason it seems that it is not working please keep in mind that you need to includ
jquery <em>and</em> <tt class="docutils literal">{{ form.media }}</tt> to your templates or else the required client side code won&#8217;t be&nbsp;executed.</p>
<p>I think it is an essential for all cases because dropdowns with lots of choices have a very bad user experience - and the same is true with
many to many fields (you could use the checkboxes widget to improve their behavior a little but you will have bad behavior when there are many&nbsp;choices).</p>
</div>
<div class="section" id="django-reversion">
<h3>django-reversion</h3>
<p><a class="reference external" href="https://github.com/etianen/django-reversion">django-reversion</a> is a really important package for my projects. When it is configured properly (by adding a a reversion-middleware), it offers full auditing
for all changes in the your model instances you select (and properly groups them in case of changes to multiple instances in a simple request).
It saves a <span class="caps">JSON</span> representation
of all the versions of an instance in your database. Keep in mind that this may increase your database size  but if you need full auditing
then is is probably the best way to do it. I have written an article about <a class="reference external" href="https://spapas.github.io/2015/01/21/django-model-auditing/">django model auditing</a> that discusses this package and django-simple-history
(following)&nbsp;more.</p>
</div>
<div class="section" id="django-compressor">
<h3>django-compressor</h3>
<p><a class="reference external" href="https://github.com/django-compressor/django-compressor/">django-compressor</a> is package that combines and minifies your css and javascript (both files and line snippets) into static files. There are
other tools for this but I have never used them since django-compressor satisfies my needs. Although I&#8217;ve
<a class="reference external" href="https://spapas.github.io/2015/05/27/using-browserify-watchify/">written about browserify</a> and friends from the node-js world I don&#8217;t recommend using such tools in django to combine and minify your
javascript and css <em>unless</em> you specifically require&nbsp;them.</p>
<p>It has an online and an offline mode. For the online mode, when a request is done it will check if the compressed file exist and if not it will
create it. This may lead to problems with permissions if your application server user cannot write to your static folders and also
your users will see exceptions if for some reason you have included a file that cannot be found. For the
offline mode, you need to run a management command that will create the static files <em>while deploying</em> the applications - this mode is
recommended because any missing files problems etc will be resolved while deploying the&nbsp;app.</p>
</div>
<div class="section" id="django-debug-toolbar">
<h3>django-debug-toolbar</h3>
<p><a class="reference external" href="https://github.com/jazzband/django-debug-toolbar">django-debug-toolbar</a>: This is a well known package for debugging django apps that is always included in the development configuration of my projects.
It has various panels that help you debug your application but, at least for me, the most helpful is the one that displays you all <span class="caps">SQL</span> queries that
are executed for a page load. Because of how the django orm is working it will go on and follow all relations something that will lead to
hundreds of queries. For example, let&#8217;s say that you have simple Book model with a foreign key to an Author model that has N instances in your
database. If you do a <tt class="docutils literal">Book.objects.all()</tt>
and want display the author name for each book in a template then you&#8217;ll always do <tt class="docutils literal">N+1</tt> queries to the database! This is really easy to miss because
in the django you&#8217;ll just do <tt class="docutils literal">{% for book in books <span class="pre">%}{{</span> <span class="pre">book.name}},</span> {{ book.author.name <span class="pre">}}{%</span> endif %}</tt> &#8212; however the <tt class="docutils literal">{{ book.author.name }}</tt> will go
on and do an extra <span class="caps">SQL</span> query!!! Such cases are easily resolved by using <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/models/querysets/#select-related">select_related</a> (and <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/models/querysets/#prefetch-related">prefetch_related</a>) but you must be sure to use select_related
for all your queries (and if you add some extra things to your template you must remember to also add them to your select_related clause for the&nbsp;query).</p>
<p>So, what I recommend before going to production is to visit all your pages using django-debug-toolbar and take a quick look at the number of <span class="caps">SQL</span>
queries. If you see something that does not make sense (for example you see more than 10 queries) then you&#8217;ll need to think about the problem I just
mentioned. Please notice that this, at least for me, is not premature optimization - this is not actually optimization! This is about writing correct
code. Let&#8217;s suppose that you could not use the django orm anymore and you had to use plain old <span class="caps">SQL</span> queries. Would you write <tt class="docutils literal"><span class="caps">SELECT</span> * <span class="caps">FROM</span> books</tt> and
then for each row do another <tt class="docutils literal"><span class="caps">SELECT</span> * <span class="caps">FROM</span> authors <span class="caps">WHERE</span> id=?</tt> passing the author of each book <em>or</em> do only <tt class="docutils literal">select * from books b <span class="caps">LEFT</span> <span class="caps">JOIN</span>
authors a on b.author_id = a.id</tt>?</p>
</div>
</div>
<div class="section" id="packages-i-use-when-i-need-their-functionality">
<h2>Packages I use when I need their&nbsp;functionality</h2>
<p>The packages following are also essential to me but only when I need their functionality. I don&#8217;t use them in all my projects
but, when I need the capabilities they offer then I will use these packages (and not some others). For example, if I need to
render PDFs in my applications then I will use the xhtml2pdf, if I need to login through <span class="caps">LDAP</span> I will use django-auth-ldap&nbsp;etc.</p>
<div class="section" id="xhtml2pdf">
<h3>xhtml2pdf</h3>
<p><a class="reference external" href="https://github.com/xhtml2pdf/xhtml2pdf">xhtml2pdf</a> is the package I use for creating <span class="caps">PDF</span>&#8217;s with django as I&#8217;ve alreadly discussed in the <a class="reference external" href="https://spapas.github.io/2015/11/27/pdf-in-django/">PDFs in Django</a> article (this is not
a django-specific package like most others I discuss here but it plays really good with django). You create a
normal django template, add some styling to it and dump it to html. Notice that there&#8217;s a <a class="reference external" href="https://github.com/chrisglass/django-xhtml2pdf">django-xhtml2pdf</a> project but has not been recently updated
and after all as you can see in my article it is easy to just call xhtml2pdf directly. The xhtml2pdf library is actually a wrapper around the
excellent <a class="reference external" href="http://www.reportlab.com">reportlab</a> library which does the low-level pdf&nbsp;output.</p>
<p>Notice that the xhtml2pdf library had some maintenance problems
(that&#8217;s why some people are suggesting other <span class="caps">PDF</span> solutions like WeasyPrint) however they seem to have been fixed now. Also,
I have found out that, at least for my needs (using Windows as my development environment), other soltuons are much inferior to xhtml2pdf.
I urge you to try xhtml2pdf first and only if you find that it does not cover your needs (and have asked
me about your problem) try the other&nbsp;solutions.</p>
</div>
<div class="section" id="django-auth-ldap">
<h3>django-auth-ldap</h3>
<p><a class="reference external" href="https://bitbucket.org/psagers/django-auth-ldap/">django-auth-ldap</a> is the package you&#8217;ll want to use if your organization uses <span class="caps">LDAP</span> (or Active Directory) and you want to use it for
logging in. Just configure your <span class="caps">LDAP</span> server settings,
add the ldap authenticator and you&#8217;ll be ready to go. Please notice that this package is a django wrapper of the python-ldap package
which actually provides the <span class="caps">LDAP</span>&nbsp;connection.</p>
</div>
<div class="section" id="django-localflavor">
<h3>django-localflavor</h3>
<p><a class="reference external" href="https://github.com/django/django-localflavor">django-localflavor</a> offers useful stuff for various countries, mainly form fields with the correct validation and lists of choices.
For example, for my country (Greece) you&#8217;ll get a <tt class="docutils literal">GRPhoneNumberField</tt>, a <tt class="docutils literal">GRPostalCodeField</tt> and a <tt class="docutils literal">GRTaxNumberCodeField</tt>. Use it instead of re-implementing
the&nbsp;behavior.</p>
</div>
<div class="section" id="django-constance">
<h3>django-constance</h3>
<p><a class="reference external" href="https://github.com/jazzband/django-constance">django-constance</a> is a simple package that enables you to add quick-configurable settings in your application. To change the settings.py file
you need to edit the source and restart the application - for most installations this is a full re-deployment of the application. Fully
re-deploying the app just to change a setting is not very good practice (depending on the setting of course but if it is a business setting
it usually should be done by business users and not by&nbsp;administrators).</p>
<p>That&#8217;s where django-constance comes to help you. You can define some
extra settings which can be changed through the django admin and their new value will be available immediately. Also you can configure where
these settings will be saved. One option is the database but this is not recommended - instead you can use redis so that the settings values will be
available much&nbsp;quicker!</p>
</div>
<div class="section" id="django-rq">
<h3>django-rq</h3>
<p><a class="reference external" href="https://github.com/ui/django-rq">django-rq</a> is a django wrapper for the <a class="reference external" href="https://github.com/nvie/rq">rq</a> library. I use it when I need asynchronous tasks (which is on almost all of my projects). More
info can be found on the two articles I have writtten about django rq (<a class="reference external" href="https://spapas.github.io/2015/01/27/async-tasks-with-django-rq/">asynchronous tasks in django</a> and <a class="reference external" href="https://spapas.github.io/2015/09/01/django-rq-redux/">django-rq redux</a>).</p>
</div>
<div class="section" id="django-rules-light">
<h3>django-rules-light</h3>
<p>One of the least known packages from those I discuss here, <a class="reference external" href="https://github.com/yourlabs/django-rules-light">django-rules-light</a> is one of the most useful when is needed. This package
allows you to define complex rules for doing actions on model instances. Each rule is a function that gets the user that wants to do the action
and the object that the user wants to action on. The function returns True or False to allow or not allow the action. You can then use these in
both your code to programatically check if the user can do the the action and your templates to decide what buttons and options you will display.
There are also various helper methods for CBVs that make everything&nbsp;easier.</p>
<p>To properly understand the value of django-rules-light you need to have some more complex than usual action rules. For example if your actions
for an object are view / edit and all your users can view and edit their own objects then you don&#8217;t really need this package. However, if your administrators
can view all objects and your object can be finalized so no changes are allowed unless an administrator tries to change it then you&#8217;ll greatly benefit
from using&nbsp;it!</p>
</div>
<div class="section" id="django-generic-scaffold">
<h3>django-generic-scaffold</h3>
<p><a class="reference external" href="https://github.com/spapas/django-generic-scaffold">django-generic-scaffold</a> is a package I have created that can be used to quickly (and DRYly) create <span class="caps">CRUD</span> CBVs for your models. I usually don&#8217;t want to
give access to the django-admin to non-technical users however sometimes I want to quickly create the required CBVs for them (list, detail, create, edit
delete). Using django-generic-scaffold you can just create a scaffold which is related with a Model and all the views will be automagically created -
you only need to link them to your urls.py. The created CBVs are fully configurable by adding extra mixins or even changing the parent class of each <span class="caps">CBV</span>.</p>
<p>Notice that this package does not create any source files - instead all CBVs are created on-the-fly using <tt class="docutils literal">type</tt>. For example, to create <span class="caps">CRUD</span> CBVs for
a Book model you&#8217;ll do this in&nbsp;scaffolding.py:</p>
<pre class="code literal-block">
class BookCrudManager(CrudManager):
    model = models.Book
    prefix = 'books'
</pre>
<p>and then in your urls.py you&#8217;ll just append the generated urls to your url&nbsp;list:</p>
<pre class="code literal-block">
book_crud = BookCrudManager()
urlpatterns += book_crud.get_url_patterns()
</pre>
<p>Now you can visit the corresponding views (for example /books or /bookscreate - depends on the prefix) to add/view/edit etc your&nbsp;books!</p>
</div>
<div class="section" id="django-taggit">
<h3>django-taggit</h3>
<p><a class="reference external" href="https://github.com/alex/django-taggit">django-taggit</a> is the library you&#8217;ll want to use if you have to use tags with your models. A tag is a synonym for keyword, i.e adding some
words/phrases to your instances that are used to categorise and desribe em. The relation between your to-be-tagged-model and your tags is
many to many. To use it, you just add <cite>tags = TaggableManager()</cite> to your
model and you are ready to go! Of course it will need some more configuration to be included in django admin and django forms but thankfully,
autocomplete-lights can be <a class="reference external" href="https://django-autocomplete-light.readthedocs.io/en/master/taggit.html">integrated with django-taggit</a>!</p>
</div>
<div class="section" id="django-sendfile">
<h3>django-sendfile</h3>
<p><a class="reference external" href="https://github.com/johnsensible/django-sendfile">django-sendfile</a> is a very important - at least to - me library. Sometimes, user uploaded files (media in django) should not be visible to all users
so you&#8217;ll need to implement some access control through your django app. However, it is important to <em>not</em> serve these media files through your application
server (uwsi, gunicorn etc) but use a web server (nginx, apache ect) for serving them. This is needed because your application server&#8217;s purpose is
not serving files from the disk - keep in mind that the application server usually has a specified amount of workers (usually analogous to the number
of CPUs of your server, for example 4 workers ) - think what will happen if some large media files are server through these workers to users with
a slow connection! With 4 such concurrent connections your application won&#8217;t be able to serve any other&nbsp;content!</p>
<p>So this package (along with the support of X-Sendfile from the web servers) helps you fulfill the above requirements:
It allowes you to check permissions to your media through your django application <em>but</em> then offload the serving of your media files to the web server.
More info about
<a class="reference external" href="https://stackoverflow.com/q/7296642/119071">django-sendfile can be found on this <span class="caps">SO</span> answer</a> but with a few words, with django-sendfile you create a view that checks if a file is allowed to be served
and, if yes, instruct the web server to actually serve that file by appending a specific header to the&nbsp;response.</p>
</div>
<div class="section" id="django-reversion-compare">
<h3>django-reversion-compare</h3>
<p><a class="reference external" href="https://github.com/jedie/django-reversion-compare">django-reversion-compare</a> is an addon to django-reversion. It allows you to compare two different versions of a model instance
and highlights their differences using various smart algorithms (so if you have a long text field you won&#8217;t only see that these are different but
you&#8217;ll also see where exactly they differ, with output similar to the one you get when using&nbsp;diff).</p>
</div>
<div class="section" id="django-simple-history">
<h3>django-simple-history</h3>
<p><a class="reference external" href="https://github.com/treyhunner/django-simple-history">django-simple-history</a> has similar capabilities with django-reversion - (auditing and keeping versions of models) with a very important
difference: While django-reversion keeps a <span class="caps">JSON</span> representation of each version in the database (making querying very difficult), django-simple-history
creates an extra, history table for each model instance you want to track and adds each change as a new row to that table. As can be understood this
will make the history table really huge but has the advantage that you can easily query for old values. I usually use django-reversion unless I know
that I will need the history&nbsp;querying.</p>
</div>
<div class="section" id="django-import-export">
<h3>django-import-export</h3>
<p><a class="reference external" href="https://github.com/django-import-export/django-import-export">django-import-export</a> can be used to enchance your models with mass import and export capabilities (from example from/to <span class="caps">CSV</span>).
You will add an ModelResource class that describes (and configures) how your Model should be imported/exported. The ModelResource class can
then be easily used in your views and, more importantly, it is integrated to the django-admin. I have to confess that I have not used django-import-export
for <em>importing</em> data because I prefer implementing my own views for that (to have better control over the whole process and because the data
I usually need to import does not usually map 1 to 1 with a model but I need to create more model instances etc). However I am using the export
capabilities of django-import-export in various projects with great success, especially the admin integration which easily fulfills the exporting
data capabilities of most&nbsp;users.</p>
</div>
<div class="section" id="django-extra-views">
<h3>django-extra-views</h3>
<p>Beyond django-forms, django supports a feature called <a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/forms/formsets/">Formsets</a> which allows you to add/edit multiple object instances in
a single view (by displaying all instances one after the other). The classic request/response cycle of django is preserved in Formsets, so
your form instances will be submitted all together when you submit the form. The logic extension to the Formset is the <a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/forms/modelforms/#model-formsets">ModelFormset</a> i.e each form
in a Formset is a ModelForm and <a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/forms/modelforms/#inline-formsets">InlineFormSet</a> where you have a Parent model that has a bunch of children and you are editing the Parent <em>and</em>
its children in a single Form. For example, you have a School and a Student model where each Student has a ForeignKey to School. The usual case
would be to edit the Student model and select her school (through a drop down or even-better if you use django-autocomplete-light through a proper
autocompelte widget). However, you may for some reason want to edit the School and display (and edit) the list of its Students &#8212; that&#8217;s where you&#8217;ll
use an&nbsp;InlineFormSet!</p>
<p>The above features (Formsets, Modelformsets and Inlineformsets) are not supported natively by django CBVs &#8212; that&#8217;s where <a class="reference external" href="https://github.com/AndrewIngram/django-extra-views">django-extra-views</a> comes
to the foreground. You can use the corresponding CBVs of django-extra-views to support the multiple-form workflows described above. Using these CBVs
are more or less similar to using the good-old django&nbsp;FormView.</p>
</div>
<div class="section" id="easy-thumbnails">
<h3>easy-thumbnails</h3>
<p><a class="reference external" href="https://github.com/SmileyChris/easy-thumbnails">easy-thumbnails</a> is a great library if you want to support thumbnails. Actually, thumbnails is not 100% correct - this package can be used to
generate and manage various versions of your original images, for example you may have a small version of the image that will be used as a thumbnail,
a larger version that will be used in a gallery-carousel view and an even larger version (but not the original one which could be huge) that will be used when
the user clicks on the gallery to view a larger version of the image. To do that you define the image configurations you support in your settings.py and then
you have access
to your thumbnails both in your templates and in your views. Notice that a specific thumbnail congfiguration for an image will be created only once since
the generated images are saved so each thumbnail will be generated on the first request it contains it and will be reused in the following such&nbsp;requests.</p>
</div>
<div class="section" id="django-rest-framework">
<h3>django-rest-framework</h3>
<p><a class="reference external" href="https://github.com/encode/django-rest-framework">django-rest-framework</a> is definitely the best package for creating web APIs with django. I don&#8217;t recommend using it if you want to create a quick <span class="caps">JSON</span> search
<span class="caps">API</span> (take a look at <a class="reference external" href="https://spapas.github.io/2014/09/15/django-non-html-responses/">django non-<span class="caps">HTML</span> responses</a>) but if you want to go the <span class="caps">SPA</span> way or if you want to create multiple APIs for various models then
this is the way to go. Integrating it to your project will need some effort (that&#8217;s why I don&#8217;t recommend it for quick and dirty APIs) because you&#8217;ll
need to create a serializers.py which will define the serializers (more or less the fields) for the models you&#8217;ll want to expose through your <span class="caps">API</span> and
then create the views (or the viewsets which are families of views for example list, detail, delete, update, create) and add them to your urls.py. You&#8217;ll
also need to configure authentication, authorization and probably filtering and pagination. This may seem like a lot of work but the result are
excellent - you&#8217;ll get a full <span class="caps">REST</span> <span class="caps">API</span> supporting create, list, detail, update, delete for any complex configuration of your models.
You can take a look at a sample application in my <a class="reference external" href="https://github.com/spapas/react-tutorial">React tutorial</a> repository (yes this is a repository that has a tutorial for React and
friends but the back-end is in django and&nbsp;django-rest-framework).</p>
<p>django-rest-framework integrates nicely with django-filter (mentioned above) to re-use the filters you have created for your model listings
in your <span class="caps">REST</span> APIs - <span class="caps">DRY</span> at its&nbsp;best!</p>
</div>
<div class="section" id="django-waffle">
<h3>django-waffle</h3>
<p><a class="reference external" href="https://github.com/jsocol/django-waffle">django-waffle</a> is described as a feature flipper. What does this mean? Let&#8217;s say that you want to control at will when a specific view will be enabled
- this is the library you&#8217;ll want to use. Or you have developed a new feature and you want to give access to it only on a subset of users for a pilot run of
the feature - once again you should use django flipper. It offers a nice admin interface where you can configure the flags that will be used for the various
feature enabling/disabling (and if they are active or not) and various template tags and functions that you can use to test if the features should be activated
or&nbsp;not.</p>
</div>
<div class="section" id="django-allauth">
<h3>django-allauth</h3>
<p><a class="reference external" href="https://github.com/pennersr/django-allauth">django-allauth</a> should be used in two cases: When you want a <em>better</em> user registration workflow than the default (non-existant) one or you want
to integrate your application with an external OAuth provider (i.e allow your users to login through their facebook, google, twitter, github etc accounts). I
have mainly used this package for the first case and I can confirm that it works great and you can create as complex flows as you want (for example, in
one of my projects I have the following user registration-activation flow: A user registers using a custom form and using his email as username, he receives
an email with a confirmation link,
after he has confirmed his email he receivs a custom message to wait for his account activation and the administrators of the application are notified,
the administrators enable the new user&#8217;s account after checking some things and only then he&#8217;ll be able to log-in). One thing that must be noticed about
django-allauth is that it (in my opition) does not have very good documentation but there are lots of answers about <a class="reference external" href="https://stackoverflow.com/questions/tagged/django-allauth">django-allauth in stackoverflow</a> and the source code
is very clear so you can always use the source as documentation for this&nbsp;package.</p>
</div>
<div class="section" id="django-modeltranslation">
<h3>django-modeltranslation</h3>
<p>The <a class="reference external" href="https://github.com/deschler/django-modeltranslation">django-modeltranslation</a> library is the library I recommend for when you want to have translations to your models. To use it
you add a translation.py file where you declare the models and their fields that should be translated. The, depending on which languages you have configured
in your settings.py after you run makemigrations and migrate you&#8217;ll see that django-modeltranslation will have included extra fields to the database, each one
with the corresponding language name (for example if you have added a field <tt class="docutils literal">name</tt> to the translations and have english and greek as language,
django-modeltranslation will add the fields <tt class="docutils literal">name_en</tt> and <tt class="docutils literal">name_el</tt> to your table). You can the edit the i18n fields (using forms or the django admin) and
depending on the current language of your site when you use <tt class="docutils literal">name</tt> you&#8217;ll get either <tt class="docutils literal">name_el</tt> or <tt class="docutils literal">name_en</tt>.</p>
</div>
<div class="section" id="django-widget-tweaks">
<h3>django-widget-tweaks</h3>
<p>If for some reason you don&#8217;t want to do django-crispy-forms, or you have a form in which you want to do a specific layout change but without
fully implementing the FormHelper then you can actually render the form in <span class="caps">HTML</span> and output the fields one by one. One thing that cannot
be done though is passing custom options to the rendered form field. When you do a <tt class="docutils literal">{{ form.field }}</tt> to your template django will render
the form field using its default options - yes this can be overriden using <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/forms/widgets/#base-widget-classes">custom widgets</a> but I don&#8217;t recommend it for example if you only
want to add a class to the rendered <tt class="docutils literal">&lt;input&gt;</tt>!</p>
<p>Instead, you can use <a class="reference external" href="https://github.com/jazzband/django-widget-tweaks">django-widget-tweaks</a> to pass some specific class names or attributes to
the rendered form fields - so if you use <tt class="docutils literal">{{ <span class="pre">form.field|add_class:&quot;myclass&quot;</span> }}</tt> the rendered <tt class="docutils literal">&lt;input&gt;</tt> will have a <tt class="docutils literal">myclass</tt> css&nbsp;class.</p>
</div>
<div class="section" id="django-simple-captcha">
<h3>django-simple-captcha</h3>
<p>Use <a class="reference external" href="https://github.com/mbi/django-simple-captcha">django-simple-captcha</a> to add (configurable) captchas to your django forms. This is a very simple package that does not have any requirements
beyond the Pillow library for the captcha image generator. The generated captchas are simple images with some added noise so it won&#8217;t integrate
<a class="reference external" href="https://www.google.com/recaptcha/intro/">reCAPTCHA</a> with which you may be more familiar. I deliberatly propose this package for captchas so you won&#8217;t need to integrate with Google&nbsp;services.</p>
</div>
<div class="section" id="wagtail">
<h3>wagtail</h3>
<p><a class="reference external" href="https://github.com/wagtail/wagtail">wagtail</a> is a great django <span class="caps">CMS</span>. I use it when I need to create a <span class="caps">CMS</span> or I need to add <span class="caps">CMS</span> like capabilities to a project. It has many
capabilities, too many to be listed here. I urge you to try it if you need a <span class="caps">CMS</span>!</p>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>The above packages should cover most of your django needs. I have listed only packages with good documentation,
that have been recently updated
and work with new django versions and should be fairly easy to integrate with your projects. If you need anything more or want to take a general
look at some of the packages that have are availablie I recommend starting
with the <a class="reference external" href="https://djangopackages.org">django packages</a>&nbsp;site.</p>
<p>One important thing to notice here is that some of the above packages are not really complex and their functionality can be re-implemented
by you in a couple of hours. For example, you could replicate the functionality of django-constance by adding a config dict and
a couple of methods (and template tags) of storing and retrieving the keys of that dict with redis. Or add some custom clean methods to your
forms instead of using the form fields from django-localflavor. Also, some of these packages have similar functionality and can be used (along
with a little custom code) to replicate the functionality of other packages, for exmaple instead of using django-waffle you could use
django-constance to configure if the features should be enabled or disabled and django-rules-light to control if the users have access to the feature.
Also, you could probably use django-waffle for access control, i.e allow only admins to access a specific&nbsp;views.</p>
<p>Please don&#8217;t do this. This violates <span class="caps">DRY</span> and violates being disciplined.
Each package has its purpose and being <span class="caps">DRY</span> means that you use it for its purpose, <em>not</em> re-implementing it and <em>not</em> re-using it for other purposes.
When somebody (or you after some months) sees that package in requirements or INSTALLED_APPS he will conclude that you are using it for
its intented purpose and thank you because you have saved him some time - please don&#8217;t make him waste his time by needing to read your source code to understand
any smart tricks or reinventing the&nbsp;wheel.</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2017/07/04/postgresql-auto-create-category-column/">Automatically create a category table in Postgresql by extracting unique table values</a>
      </h1>
    <p class="meta">
<time datetime="2017-07-04T09:05:00+03:00" pubdate>Τρι 04 Ιούλιος 2017</time>    </p>
</header>

<div class="entry-content"><p>Recently I was given an <span class="caps">SQL</span> table containing some useful data. The problem with that table was that it was was non-properly normalized but was completely flat,
i.e all its columns contained varchar values while, some of them should have instead contained foreign keys to other tables. Here&#8217;s an example of how this
table looked&nbsp;like:</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="25%" />
<col width="28%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head" colspan="4">Parts</th>
</tr>
<tr><th class="head"><span class="caps">ID</span></th>
<th class="head">Serial</th>
<th class="head">Category</th>
<th class="head">Manufacturer</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>1</td>
<td>423431</td>
<td>Monitor</td>
<td><span class="caps">LG</span></td>
</tr>
<tr><td>2</td>
<td>534552</td>
<td>Monitor</td>
<td><span class="caps">LG</span></td>
</tr>
<tr><td>3</td>
<td>435634</td>
<td>Printer</td>
<td><span class="caps">HP</span></td>
</tr>
<tr><td>4</td>
<td>534234</td>
<td>Printer</td>
<td>Samsung</td>
</tr>
<tr><td>5</td>
<td>234212</td>
<td>Monitor</td>
<td>Samsung</td>
</tr>
<tr><td>6</td>
<td>123123</td>
<td>Monitor</td>
<td><span class="caps">LG</span></td>
</tr>
</tbody>
</table>
<p>The normalized version of this table should have been instead like&nbsp;this:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="23%" />
<col width="28%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head" colspan="4">Parts</th>
</tr>
<tr><th class="head"><span class="caps">ID</span></th>
<th class="head">Serial</th>
<th class="head">Category_id</th>
<th class="head">Manufacturer_id</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>1</td>
<td>423431</td>
<td>1</td>
<td>1</td>
</tr>
<tr><td>2</td>
<td>534552</td>
<td>1</td>
<td>1</td>
</tr>
<tr><td>3</td>
<td>435634</td>
<td>2</td>
<td>2</td>
</tr>
<tr><td>4</td>
<td>534234</td>
<td>2</td>
<td>3</td>
</tr>
<tr><td>5</td>
<td>234212</td>
<td>1</td>
<td>3</td>
</tr>
<tr><td>6</td>
<td>123123</td>
<td>1</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>with the following extra tables that contain the category values with proper foreign&nbsp;keys:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head" colspan="2">Category</th>
</tr>
<tr><th class="head"><span class="caps">ID</span></th>
<th class="head">Name</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>1</td>
<td>Monitor</td>
</tr>
<tr><td>2</td>
<td>Printer</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head" colspan="2">Manufacturer</th>
</tr>
<tr><th class="head"><span class="caps">ID</span></th>
<th class="head">Name</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>1</td>
<td>Monitor</td>
</tr>
<tr><td>2</td>
<td>Printer</td>
</tr>
</tbody>
</table>
<p>The normalized version should be used instead of the flat one <a class="reference external" href="http://www.imdb.com/title/tt0057012/quotes?item=qt0454452">for reasons which at this moment must be all too obvious</a>.</p>
<p>Having such non-normalized tables is also a common problem I experience with Django: When creating a model
I usually define some <tt class="docutils literal">CharField</tt>  with pre-defined <tt class="docutils literal">choices</tt> which &#8220;will never change&#8221;. Sometime during the
development (if I am lucky) or when the project is live for years I will be informed that the choices need not
only to be changed but must be changed by the users of the site without the need to change the source code! Or
that the choices/categories have properties (beyond their name) that need to be defined and used in the project. Both
of these cases mean that these categories need to be extracted from simple strings to full Django models (i.e get
normalized in their own&nbsp;table)!</p>
<p>In this post I will present a function written in <span class="caps">PL</span>/pgsql that will automatically normalize a column from a
flat table like the previous. Specifically, using the previous example,
if you have a table named <tt class="docutils literal">part</tt> that has a non-normalized
column named <tt class="docutils literal">category</tt> then when you call <tt class="docutils literal">select <span class="pre">export_relation('part',</span> 'category')</tt> the following
will&nbsp;happen:</p>
<ul>
<li><p class="first">A new table named <tt class="docutils literal">part_category</tt> will be created. This table will contain two columns <tt class="docutils literal">id</tt> and <tt class="docutils literal">name</tt>, with <tt class="docutils literal">id</tt> being the primary key and <tt class="docutils literal">name</tt> having a unique constraint. If the table exists it will be dropped and&nbsp;re-ccreated</p>
</li>
<li><p class="first">A new column named <tt class="docutils literal">category_id</tt> will be added to <tt class="docutils literal">part</tt>. This column will be a foreign key to the new table <tt class="docutils literal">part_category</tt>.</p>
</li>
<li><dl class="first docutils">
<dt>For each unique value <tt class="docutils literal">v</tt> of <tt class="docutils literal">category</tt>:</dt>
<dd><ul class="first last simple">
<li>Insert a new record in <tt class="docutils literal">part_category</tt> with <tt class="docutils literal">v</tt> in the <tt class="docutils literal">name</tt> field of the table and save the inserted id to <tt class="docutils literal">current_id</tt></li>
<li>Set <tt class="docutils literal">current_id</tt> to <tt class="docutils literal">category_id</tt>  to all rows of <tt class="docutils literal">part</tt> where <tt class="docutils literal">category</tt> has the value of <tt class="docutils literal">v</tt></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Before diving in to the <span class="caps">PL</span>/pgSQL script that does the above changes to the table I&#8217;d like to notice that I am
not very experienced with <span class="caps">PL</span>/pgSQL since I rarerly use it
(I actually avoid writing code in the database) however, because the case I described is ideal for using a database script
I&#8217;ve bitten the bullet and implemented&nbsp;it.</p>
<p>Beyond it&#8217;s actual functionality, this script can be used as a reference/cookbook for common <span class="caps">PL</span>/pgSQL&nbsp;tasks:</p>
<ul class="simple">
<li>Create/define a <span class="caps">PL</span>/pgSQL function (stored&nbsp;procedure)</li>
<li>Declare&nbsp;variables</li>
<li>Assign values to&nbsp;variables</li>
<li>Execute <span class="caps">SQL</span> commands with variable defined table / column&nbsp;names</li>
<li>Log process in <span class="caps">PL</span>/pgSQL</li>
<li>Executing code&nbsp;conditionally</li>
<li>Loop through the rows of a&nbsp;query</li>
<li>Save the primary key of an inserted&nbsp;row</li>
</ul>
<p>The script works however I feel that more experienced <span class="caps">PL</span>/pgSQL developers would write things different - if you have any
proposals please comment out and I&#8217;ll be happy to incorporate them to the&nbsp;script.</p>
<p>Now, let&#8217;s now take a look at the actual&nbsp;script:</p>
<div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">FUNCTION</span> <span class="n">export_relation</span><span class="p">(</span><span class="n">table_name</span> <span class="nb">varchar</span><span class="p">,</span> <span class="n">column_name</span> <span class="nb">varchar</span><span class="p">)</span>
<span class="k">RETURNS</span> <span class="nb">void</span> <span class="k">AS</span> <span class="s">$$</span>
<span class="k">DECLARE</span>
    <span class="n">val</span> <span class="nb">varchar</span><span class="p">;</span>
    <span class="n">res</span> <span class="nb">boolean</span><span class="p">;</span>
    <span class="n">new_table_name</span> <span class="nb">varchar</span><span class="p">;</span>
    <span class="n">new_column_name</span> <span class="nb">varchar</span><span class="p">;</span>
    <span class="n">current_id</span> <span class="nb">int</span><span class="p">;</span>
<span class="k">BEGIN</span>
    <span class="n">new_table_name</span> <span class="o">:=</span> <span class="n">table_name</span> <span class="o">||</span> <span class="s1">&#39;_&#39;</span> <span class="o">||</span> <span class="n">column_name</span><span class="p">;</span>
    <span class="n">new_column_name</span> <span class="o">:=</span> <span class="n">column_name</span> <span class="o">||</span> <span class="s1">&#39;_id&#39;</span> <span class="p">;</span>

    <span class="k">execute</span> <span class="n">format</span> <span class="p">(</span><span class="s1">&#39;drop table if exists %s cascade&#39;</span><span class="p">,</span> <span class="n">new_table_name</span><span class="p">);</span>
    <span class="k">execute</span> <span class="n">format</span> <span class="p">(</span><span class="s1">&#39;CREATE TABLE %s (id serial NOT NULL, name character varying(255) NOT NULL, CONSTRAINT %s_pkey PRIMARY KEY (id), CONSTRAINT %s_unique UNIQUE (name))WITH ( OIDS=FALSE)&#39;</span><span class="p">,</span>
        <span class="n">new_table_name</span><span class="p">,</span> <span class="n">new_table_name</span><span class="p">,</span> <span class="n">new_table_name</span>
    <span class="p">);</span>

    <span class="k">execute</span> <span class="n">format</span><span class="p">(</span><span class="s1">&#39;select exists(SELECT column_name  FROM information_schema.columns WHERE table_name=&#39;&#39;%s&#39;&#39; and column_name=&#39;&#39;%s&#39;&#39;) as x&#39;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">new_column_name</span><span class="p">)</span> <span class="k">into</span> <span class="n">res</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">res</span> <span class="k">is</span> <span class="k">false</span> <span class="k">then</span>
        <span class="k">raise</span> <span class="k">notice</span> <span class="s1">&#39;Creating colum&#39;</span><span class="p">;</span>
        <span class="k">execute</span> <span class="n">format</span> <span class="p">(</span><span class="s1">&#39;ALTER TABLE %s ADD COLUMN %s integer null&#39;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">new_column_name</span><span class="p">);</span>
        <span class="k">execute</span> <span class="n">format</span> <span class="p">(</span><span class="s1">&#39;ALTER TABLE %s ADD CONSTRAINT fk_%s FOREIGN KEY (%s) REFERENCES %s(id)&#39;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">new_column_name</span><span class="p">,</span> <span class="n">new_column_name</span><span class="p">,</span> <span class="n">new_table_name</span><span class="p">);</span>
    <span class="k">end</span> <span class="k">if</span> <span class="p">;</span>

    <span class="k">for</span> <span class="n">val</span> <span class="k">IN</span> <span class="k">execute</span> <span class="n">format</span> <span class="p">(</span><span class="s1">&#39;select %s from %s group by(%s)&#39;</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">column_name</span><span class="p">)</span> <span class="k">LOOP</span>
        <span class="k">RAISE</span> <span class="k">NOTICE</span> <span class="s1">&#39;Inserting new value %s ...&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>
        <span class="k">execute</span> <span class="n">format</span> <span class="p">(</span><span class="s1">&#39;insert into  %s(name) values (&#39;&#39;%s&#39;&#39;) returning id&#39;</span><span class="p">,</span> <span class="n">new_table_name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">into</span> <span class="n">current_id</span><span class="p">;</span>
        <span class="k">raise</span> <span class="k">notice</span> <span class="s1">&#39;Created ID %&#39;</span><span class="p">,</span> <span class="n">current_id</span><span class="p">;</span>
        <span class="k">execute</span> <span class="n">format</span> <span class="p">(</span><span class="s1">&#39;update %s set %s = %s where %s = &#39;&#39;%s&#39;&#39;&#39;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">new_column_name</span><span class="p">,</span><span class="n">current_id</span> <span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">val</span> <span class="p">);</span>
    <span class="k">END</span> <span class="k">LOOP</span><span class="p">;</span>

    <span class="cm">/* Uncomment this if you want to drop the flat column</span>
<span class="cm">    raise notice &#39;Dropping colmn&#39;;</span>
<span class="cm">    execute format (&#39;alter table %s drop column %s&#39;, table_name, column_name);</span>
<span class="cm">    */</span>

<span class="k">END</span><span class="p">;</span>
<span class="s">$$</span> <span class="k">LANGUAGE</span> <span class="n">plpgsql</span><span class="p">;</span>
</pre></div>
<p>The first line creates or updates the script. You can just copy over this script to an <span class="caps">SQL</span> window and run it as many times as you like (making changes
between runs) and the script will be always updated. The function that is created is actually a procedure since it returns <tt class="docutils literal">void</tt> and takes two parameters.
The <tt class="docutils literal"><span class="caps">DECLARE</span></tt> section that follows contains all the variables that are used in the&nbsp;script:</p>
<ul class="simple">
<li><tt class="docutils literal">val</tt> is the current value of the category when looping through their&nbsp;values</li>
<li><tt class="docutils literal">res</tt> is a boolean variable used for a&nbsp;conditional</li>
<li><tt class="docutils literal">new_table_name</tt> is the name of the table that will be&nbsp;created</li>
<li><tt class="docutils literal">new_column_name</tt> is the name of the column that will be added to the old&nbsp;table</li>
<li><tt class="docutils literal">current_id</tt> is the id of the last inserted value in the new&nbsp;table</li>
</ul>
<p>After the <tt class="docutils literal"><span class="caps">BEGIN</span></tt> the actual procedure starts: First the values of <tt class="docutils literal">new_table_name</tt> and <tt class="docutils literal">new_column_name</tt> are initialized to be used throughout the code and
then the new table is dropped (if exists) and re-created. Noticce the <tt class="docutils literal">execute format (parameter)</tt> function that executes the <span class="caps">SQL</span> contained in the parameter which
is a string and is constructed using the variables we&#8217;ve defined. The next line checks if the old table has the new column (i.e category_id) and saves
the result in the <tt class="docutils literal">res</tt> variable to check if the new column exists and if not add it to the old&nbsp;table.</p>
<p>A loop enumerating all unique values of the category column of the old table is then executed. Notice that <tt class="docutils literal">val</tt> will contain a single value since the <span class="caps">SQL</span> that is executed
will return a single column (that&#8217;s why it is declared as varchar). If we returned more than one column from the select the val could be declared as <tt class="docutils literal">record</tt> and access its
properties through dot notation (<tt class="docutils literal">val.prop1</tt> etc). The value is inserted to the newly created table using a <tt class="docutils literal">insert into table values () returning id</tt> <span class="caps">SQL</span> syntax
(so that the new id will be returned - this is an insert/select hybrid command) and saved to the <tt class="docutils literal">current_id</tt> variable. The <tt class="docutils literal">current_id</tt> variable then is used to update
the new column that was added to the old table with the proper foreign key&nbsp;value.</p>
<p>Notice that I&#8217;ve a commented out code in the end - if you want you can uncomment it and the old (flat) column will be dropped - so in my examply the <tt class="docutils literal">category</tt> column will be
removed since I will have <tt class="docutils literal">category_id</tt> to find out the name of each category. I recommend to uncomment this and actually drop the column since when you have both <tt class="docutils literal">category</tt>
and <tt class="docutils literal">category_id</tt> the values of these two columns are going to get out of sync and since you&#8217;ll have duplicate information your table will be even more non-normalized. You can
of course keep the column to make sure that the script works as you want since if the column is not dropped you can easily return to the previous state of the database by
removeing the new table and&nbsp;column.</p>
<p>To call it just run <tt class="docutils literal">select <span class="pre">export_relation('part',</span> 'category')</tt> and you should see some debug info in the messages tab. When the script is finished you&#8217;ll have the
<tt class="docutils literal">part_category</tt> table and <tt class="docutils literal">category_id</tt> column in the <tt class="docutils literal">part</tt> table.</p>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2017/01/03/ag-grid-custom-components/">Creating custom components for ag-grid</a>
      </h1>
    <p class="meta">
<time datetime="2017-01-03T09:55:00+02:00" pubdate>Τρι 03 Ιανουάριος 2017</time>    </p>
</header>

<div class="entry-content"><p>Recently I had to integrate an application with a javascript (client-side) excel-like grid. After some research
I found out that <a class="reference external" href="https://www.ag-grid.com/">ag-grid</a> is (at least for me) the best javascript grid library. It has an open source version with a <span class="caps">MIT</span> license
so it can safely be used by all your projects and a commercial, enteprise version that includes a bunch of
extra features. The open source version should be sufficient for most projects however I really recommend
buying the commercial version to support this very useful&nbsp;library.</p>
<p>The greatest characteristic of ag-grid in my opinion is its openess and <span class="caps">API</span> that enables you to
extend it to support all your needs! An example of this <span class="caps">API</span> will be presented in this article where
I will implement two components that can be included in your&nbsp;grid:</p>
<ul class="simple">
<li>An array editor through which you will be able to create cells that can be used to insert a list of values. For example, if you have a grid of employees, you will be able to add a &#8220;children&#8221; cell that will contain the names of each employee&#8217;s children properly separated (one line per&nbsp;child)</li>
<li>An object editor through which you will be able to create cells that can be used to insert flat objects. For example, for the grid of employees, you may add an &#8220;address&#8221; cell that, when edited will be expanded to seperate fields for Address, City, Zip code and&nbsp;Country.</li>
</ul>
<div class="section" id="a-common-ground">
<h2>A common&nbsp;ground</h2>
<p>First of all, let&#8217;s create a simple example that will act as a common ground for our&nbsp;components:</p>
<div class="jsfiddle"><iframe width="100%" height="300" src="//jsfiddle.net/6vmvdmzj/6/embedded/js,resources,html,css,result/light/" allowfullscreen="allowfullscreen" frameborder="0"></iframe></div><p>As you can see, I have defined a bunch of columns for the grid and then create a new grid passing it the <tt class="docutils literal">myGrid</tt> div
and the <tt class="docutils literal">gridOptions</tt> (which are kept to a minimum). Finally, there&#8217;s an event handler for button click that adds an
empty&nbsp;row:</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="nx">headerName</span><span class="o">:</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span> <span class="nx">editable</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="nx">headerName</span><span class="o">:</span> <span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">editable</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="nx">headerName</span><span class="o">:</span> <span class="s2">&quot;Address&quot;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span> <span class="nx">editable</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="nx">headerName</span><span class="o">:</span> <span class="s2">&quot;Children&quot;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s2">&quot;children&quot;</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span> <span class="nx">editable</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">];</span>

<span class="kd">var</span> <span class="nx">gridOptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">columnDefs</span><span class="o">:</span> <span class="nx">columns</span><span class="p">,</span>
    <span class="nx">rowData</span><span class="o">:</span> <span class="p">[]</span>
<span class="p">};</span>

<span class="k">new</span> <span class="nx">agGrid</span><span class="p">.</span><span class="nx">Grid</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#myGrid&#39;</span><span class="p">),</span> <span class="nx">gridOptions</span><span class="p">);</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#addRow&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">gridOptions</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">addItems</span><span class="p">([{}]);</span>
<span class="p">});</span>
</pre></div>
<p>You may be able to edit both the address and the children of each employee in the above example however this is
not intuitive. The editors will be able to enter any kind of address they want and add the children seperated by commas,
spaces, dashes or whatever they want. Of course you could add validators to enforce some formatting for these fields
however I think that using custom components has a much better user&nbsp;experience.</p>
<p>Please notice that the above example along with the following components will be implemented in pure (no-framework) javascript. Integrating
ag-grid with a javascript framework like angular or react in an <span class="caps">SPA</span> should not be difficult however I find it easier to adjust my <span class="caps">SPA</span>
so that the grid component is seperate and does not need interoperability with other <span class="caps">SPA</span> components since all components like renderers
and editors will be integrated to the&nbsp;grid!</p>
<p>Also, using pure javascript for your
custom components makes them faster than adding another layer of indirection through react as can be seen on the on <a class="reference external" href="https://www.ag-grid.com/best-react-data-grid/index.php">ag-grid react integration</a>:</p>
<blockquote>
If you do use React, be aware that you are adding an extra layer of indirection into ag-Grid. ag-Grid&#8217;s internal framework is already highly tuned to work incredibly fast and does not require React or anything else to make it faster. If you are looking for a lightning fast grid, even if you are using React and the ag-grid-react component, consider using plain ag-Grid Components (as explained on the pages for rendering etc) inside ag-Grid instead of creating React counterparts.</blockquote>
</div>
<div class="section" id="editors-and-renderers">
<h2>Editors and&nbsp;renderers</h2>
<p>A custom column in ag-grid actually has two distinctive parts: An object that is used for <a class="reference external" href="https://www.ag-grid.com/javascript-grid-cell-rendering/">rendering</a> and an object that is used
for <a class="reference external" href="https://www.ag-grid.com/javascript-grid-cell-editing/">editing</a> the cell value. You can have columns with the built in editor and a custom renderer, columns with the built in renderer
and a custom editor and cells with custom editors and rendererers. I urge you to read the <a class="reference external" href="https://www.ag-grid.com/documentation-main/documentation.php">documentation</a> on both renderers and
editors in order to understand most of the decisions I have made for the implemented&nbsp;components.</p>
<p>A renderer can&nbsp;be:</p>
<ul class="simple">
<li>a function that receives the value of the cell and returns either an <span class="caps">HTML</span> string or a complete <span class="caps">DOM</span>&nbsp;object</li>
<li>a class that provides methods for returning the <span class="caps">HTML</span> string or <span class="caps">DOM</span> object for the&nbsp;cell</li>
</ul>
<p>The function is much easier to use however biting the bullet and providing a renderer class is better for non-trivial rendering.
This is because the function will be called each time the cell needs to be <em>refreshed</em> (refer to the docs on what refreshing means)
while, the class provides a specific <tt class="docutils literal">refresh()</tt> method that is called instead. This way, using the class you can generate the <span class="caps">DOM</span> structure
for the cell once, when it is first created and then when its value changes you&#8217;ll only call its refresh method to update the value. We&#8217;ll
see how this works&nbsp;later.</p>
<p>An editor is a class that should provide methods for returning the <span class="caps">DOM</span> structure for the cell editing (for example an <tt class="docutils literal">&lt;input&gt;</tt> field)
and the current value of the&nbsp;field.</p>
<p>Both renderer and editor classes can be attached to columns using <tt class="docutils literal">cellEditor</tt> and <tt class="docutils literal">cellRenderer</tt> column properties. You also may
pass per-column properties to each cell using the <tt class="docutils literal">cellEditorParams</tt> and <tt class="docutils literal">cellRendererParams</tt> propertie. For example, you may have
a renderer for booleans that displays icons for true/false and you want to use different icons depending on the column type, or you
may want to create a validation-editor that receives a function and accepts the value you enter only if the function returns true - the
valid function could be different for different column&nbsp;types.</p>
</div>
<div class="section" id="creating-the-object-cell-editor">
<h2>Creating the object cell&nbsp;editor</h2>
<p>The first component we&#8217;ll present here is an object renderer/editor. This component will receiver a list of fields and will
allow the user to edit them in a popup grouped together. Here&#8217;s a fiddle with the Address of each employee using the
object editing&nbsp;component:</p>
<div class="jsfiddle"><iframe width="100%" height="300" src="//jsfiddle.net/0o85uywr/4/embedded/js,resources,html,css,result/light/" allowfullscreen="allowfullscreen" frameborder="0"></iframe></div><p>To integrate it with the ag-grid I&#8217;ve added an addressFields list containg the fields of the object like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">addressFields</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="o">:</span> <span class="s1">&#39;Address&#39;</span> <span class="p">},</span>
  <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="s1">&#39;zip&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="o">:</span> <span class="s1">&#39;ZIP&#39;</span> <span class="p">},</span>
  <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="o">:</span> <span class="s1">&#39;City&#39;</span> <span class="p">},</span>
<span class="p">]</span>
</pre></div>
<p>and then passed this as a parameter to both the renderer and editor for the address&nbsp;field:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nx">headerName</span><span class="o">:</span> <span class="s2">&quot;Address&quot;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span> <span class="nx">editable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">cellRenderer</span><span class="o">:</span> <span class="nx">ObjectCellRenderer</span><span class="p">,</span>
    <span class="nx">cellEditor</span><span class="o">:</span> <span class="nx">ObjectEditor</span><span class="p">,</span>
    <span class="nx">cellEditorParams</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">fields</span><span class="o">:</span> <span class="nx">addressFields</span>
    <span class="p">},</span>
    <span class="nx">cellRendererParams</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">fields</span><span class="o">:</span> <span class="nx">addressFields</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>The <tt class="docutils literal">ObjectEditor</tt> and <tt class="docutils literal">ObjectCellRenderer</tt> are the actual editor and renderer of the component. I will start by representing the renderer&nbsp;first:</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">ObjectCellRenderer</span><span class="p">()</span> <span class="p">{}</span>

<span class="nx">ObjectCellRenderer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Create the DOM element to display</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">span</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">span</span><span class="p">.</span><span class="nx">innerHTML</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
<span class="p">};</span>
</pre></div>
<p>The ObjectCellRender is an javascript object to which we define an <tt class="docutils literal">init</tt> method. This method will be called by ag-grid when
the component is first created, passing it a params object with various useful params, like the user-defined parameters (from <tt class="docutils literal">cellRendererParams</tt>)
and the actual value of othe cell. We just create an empty span <span class="caps">DOM</span> element that will be used to display the value of the object and call <tt class="docutils literal">refresh</tt>.</p>
<div class="highlight"><pre><span></span><span class="nx">ObjectCellRenderer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">refresh</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// If we have a value build the representation</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">params</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">res</span> <span class="o">+=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">fields</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">label</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span><span class="p">;</span>
            <span class="nx">res</span> <span class="o">+=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">value</span><span class="p">[</span><span class="nx">params</span><span class="p">.</span><span class="nx">fields</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Put representation to the DOM element</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">span</span><span class="p">.</span><span class="nx">innerHTML</span><span class="o">=</span><span class="nx">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">ObjectCellRenderer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getGui</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">span</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
<p>The <tt class="docutils literal">refresh</tt> method generates the text value of the cell (that will be put inside the span we created in init). It first checks if the <tt class="docutils literal">value</tt> attribute
of <tt class="docutils literal">params</tt> is defined and if yes, it appends the label of each object attribute (which we pass through <tt class="docutils literal">cellRendererParams.fields.label</tt>) along with its value
(which is retrieved from the <tt class="docutils literal">params.value</tt> using <tt class="docutils literal">cellRendererParams.fields.name</tt>). Notice ag-grid puts the result of the <tt class="docutils literal">getGui</tt> method in the cell - so
we just return the span we create. Also, we created the span element in init but filled it in refresh - to avoid it creating the same element lots of times (this would
be more imporntant of course on more expensive&nbsp;operations).</p>
<p>Now let&#8217;s continue with <tt class="docutils literal">ObjectEditor</tt>:</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">ObjectEditor</span><span class="p">()</span> <span class="p">{}</span>

<span class="c1">// Surpress some keypresses</span>
<span class="kd">var</span> <span class="nx">onKeyDown</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">which</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="o">==</span> <span class="mi">37</span> <span class="o">||</span>  <span class="c1">// left</span>
        <span class="nx">key</span> <span class="o">==</span> <span class="mi">39</span> <span class="o">||</span> <span class="c1">// right</span>
        <span class="nx">key</span> <span class="o">==</span> <span class="mi">9</span> <span class="p">)</span> <span class="p">{</span>  <span class="c1">// tab</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">ObjectEditor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Create the container DOM element</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">style</span> <span class="o">=</span> <span class="s2">&quot;border-radius: 15px; border: 1px solid grey;background: #e6e6e6;padding: 10px; &quot;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">onkeydown</span> <span class="o">=</span> <span class="nx">onKeyDown</span>

    <span class="c1">// Create the object-editing form</span>
    <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">params</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">field</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">fields</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">label</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">);</span>
                <span class="nx">label</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">field</span><span class="p">.</span><span class="nx">label</span><span class="o">+</span><span class="s1">&#39;: &#39;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">);</span>
        <span class="nx">input</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">field</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">input</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">value</span><span class="p">[</span><span class="nx">field</span><span class="p">.</span><span class="nx">name</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">label</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;br&#39;</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="c1">// Create a save button</span>
    <span class="kd">var</span> <span class="nx">saveButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">);</span>
    <span class="nx">saveButton</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s1">&#39;Ok&#39;</span><span class="p">))</span>
    <span class="nx">saveButton</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">params</span><span class="p">.</span><span class="nx">stopEditing</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">saveButton</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
<p>The <tt class="docutils literal">init</tt> function of ObjectEditor ise used to create a container div element that will hold the actual input elements. Then, using the fields
that were passed as a parameter to the editor it creates a <tt class="docutils literal">label</tt>, an <tt class="docutils literal">input</tt> and a <tt class="docutils literal">br</tt> element and inserts them one by one to the container div. The input is
instantiated with the current value of each attribute while its name is taken from the name of the corresponding field (from the fields parameter).
Finally, a saveButton is created that will stop the editing when&nbsp;clicked.</p>
<div class="highlight"><pre><span></span><span class="nx">ObjectEditor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getGui</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">ObjectEditor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">afterGuiAttached</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">inputs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">);</span>
    <span class="nx">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">focus</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">ObjectEditor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getValue</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="c1">// Create the cell value (an object) from the inputs values</span>
    <span class="kd">var</span> <span class="nx">inputs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">j</span><span class="o">&lt;</span><span class="nx">inputs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">res</span><span class="p">[</span><span class="nx">inputs</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">inputs</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s+|\s+$/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">ObjectEditor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">destroy</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
<span class="p">};</span>

<span class="nx">ObjectEditor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isPopup</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
<p>The other methods of ObjectEditor are simpler: <tt class="docutils literal">getGui</tt> actually returns the container we built in the <tt class="docutils literal">init</tt>, <tt class="docutils literal">afterGuiAttached</tt>
is called when the component is attached to the <span class="caps">DOM</span> and focuses on the first input element, <tt class="docutils literal">getValue</tt> enumerates the input elements,
takes their value (and names) and return an object with the name/value pairs, <tt class="docutils literal">destroy</tt> dosn&#8217;t do anything however it must be defined
and can be used for cleaning up if needed and <tt class="docutils literal">isPopup</tt> returns true to display the container as a popup instead of&nbsp;inline.</p>
</div>
<div class="section" id="creating-the-array-like-cell-editor">
<h2>Creating the array-like cell&nbsp;editor</h2>
<p>The multi-line renderer/editor will allow a cell to contain a list of values. Here&#8217;s the complete fiddle where the &#8220;children&#8221; column
is using the multi-line&nbsp;component:</p>
<div class="jsfiddle"><iframe width="100%" height="300" src="//jsfiddle.net/a6s7r4tq/1/embedded/js,resources,html,css,result/light/" allowfullscreen="allowfullscreen" frameborder="0"></iframe></div><p>To integrate it with ag-grid we just need to use the corresponding editor and&nbsp;renderer:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nx">headerName</span><span class="o">:</span> <span class="s2">&quot;Children&quot;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s2">&quot;children&quot;</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span> <span class="nx">editable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">cellRenderer</span><span class="o">:</span> <span class="nx">MultiLineCellRenderer</span><span class="p">,</span>
    <span class="nx">cellEditor</span><span class="o">:</span> <span class="nx">MultiLineEditor</span>
<span class="p">}</span>
</pre></div>
<p>The <tt class="docutils literal">MultiLineCellRenderer</tt> is similar to the <tt class="docutils literal">ObjectCellRenderer</tt>. A span/container element is created
at the <tt class="docutils literal">init</tt> method and the <tt class="docutils literal">refresh</tt> method is called to fill it. The <tt class="docutils literal">refresh</tt> method outputs the
number of items in the list (i.e it writes N items) and uses the span&#8217;s <tt class="docutils literal">title</tt> to display a tooltip with
the values of the&nbsp;items:</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">MultiLineCellRenderer</span><span class="p">()</span> <span class="p">{}</span>

<span class="nx">MultiLineCellRenderer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">span</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">span</span><span class="p">.</span><span class="nx">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">span</span><span class="p">.</span><span class="nx">innerHTML</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">MultiLineCellRenderer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">refresh</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">value</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">params</span><span class="p">.</span><span class="nx">value</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">params</span><span class="p">.</span><span class="nx">value</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">span</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;0 items&#39;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1">// Create the tooltip for the cell</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">params</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">res</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">value</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
            <span class="nx">res</span><span class="o">+=</span><span class="s1">&#39;\n&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">span</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">res</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">span</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s1">&#39; item&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="mi">1</span><span class="o">?</span><span class="s2">&quot;&quot;</span><span class="o">:</span><span class="s2">&quot;s&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">MultiLineCellRenderer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getGui</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">span</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
<p>The logic of the <tt class="docutils literal">MultiLineEditor</tt> is also similar to the <tt class="docutils literal">ObjectEditor</tt>:</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">MultiLineEditor</span><span class="p">()</span> <span class="p">{}</span>

<span class="nx">MultiLineEditor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">onKeyDown</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">which</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="o">==</span> <span class="mi">37</span> <span class="o">||</span>  <span class="c1">// left</span>
        <span class="nx">key</span> <span class="o">==</span> <span class="mi">39</span> <span class="o">||</span> <span class="c1">// right</span>
        <span class="nx">key</span> <span class="o">==</span> <span class="mi">9</span> <span class="p">)</span> <span class="p">{</span>  <span class="c1">// tab</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Used to append list items (their value along with the remove button)</span>
<span class="nx">MultiLineEditor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addLine</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">span</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">removeButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">);</span>
    <span class="nx">removeButton</span><span class="p">.</span><span class="nx">style</span><span class="o">=</span><span class="s1">&#39;margin-left: 5px; text-align: right; &#39;</span>
    <span class="nx">removeButton</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;Remove&#39;</span>
    <span class="nx">span</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
    <span class="nx">li</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">span</span><span class="p">)</span>
    <span class="nx">li</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">removeButton</span><span class="p">)</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">ul</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">removeButton</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">ul</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="nx">MultiLineEditor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">style</span> <span class="o">=</span> <span class="s2">&quot;border-radius: 15px; border: 1px solid grey;background: #e6e6e6;padding: 10px;&quot;</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">ul</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;ol&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">params</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">addLine</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">value</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ul</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">addButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">addButton</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;Add&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">addButton</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">val</span> <span class="o">||</span> <span class="nx">val</span><span class="o">==</span><span class="kc">undefined</span> <span class="o">||</span> <span class="nx">val</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">addLine</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">that</span><span class="p">.</span><span class="nx">ul</span><span class="p">);</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">addButton</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">saveButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">saveButton</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;Ok&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">saveButton</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">params</span><span class="p">.</span><span class="nx">stopEditing</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">saveButton</span><span class="p">);</span>

<span class="p">};</span>
</pre></div>
<p>A <tt class="docutils literal">div</tt> element that will display the popup editor is created first. In this container we add a <tt class="docutils literal">ol</tt> element and then,
if there are values in the list they will be
appended in that <tt class="docutils literal">ol</tt> using the <tt class="docutils literal">addLine</tt> method. This method creates a <tt class="docutils literal">li</tt> element the value of each list item along with a
remove <tt class="docutils literal">button</tt> which removes the corresponding <tt class="docutils literal">li</tt> element when clicked (that <tt class="docutils literal">that=this</tt> is needed because
the click callback function of the button has a different <tt class="docutils literal">this</tt> than the <tt class="docutils literal">addLine</tt> method so <tt class="docutils literal">that</tt> needs
to be used&nbsp;instead).</p>
<p>After the list of the items, there&#8217;s an <tt class="docutils literal">input</tt> whose value will be inserted to the list when clicking the
add <tt class="docutils literal">button</tt>. The same <tt class="docutils literal">addLine</tt> function we used when initializing the component is used here to append the
input&#8217;s value to the <tt class="docutils literal">ol</tt>. Finally the save <tt class="docutils literal">button</tt> stops the list&nbsp;editing:</p>
<div class="highlight"><pre><span></span><span class="nx">MultiLineEditor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getGui</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">MultiLineEditor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">afterGuiAttached</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">inputs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">);</span>
    <span class="nx">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">focus</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">MultiLineEditor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getValue</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="c1">// The value is the text of all the span items of the li items</span>
    <span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">ul</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">MultiLineEditor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">destroy</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
<span class="p">};</span>

<span class="nx">MultiLineEditor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isPopup</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
<p>For the value of this component, we just enumerate through the <tt class="docutils literal">li span</tt> items of the list we created through <tt class="docutils literal">addLine</tt>
and add it to a normal javascript&nbsp;array.</p>
</div>
<div class="section" id="some-more-discussion-about-the-components">
<h2>Some more discussion about the&nbsp;components</h2>
<p>The above components can be used as they are however I think that their greatest value is that they should show-off some of
the capabilities of ag-grid and used as templates to build up your own stuff. Beyond styling or changing the layout
of the multi-line and the object editor, I can think of a great number of extensions for them. Some examples, left as
an excerise to the&nbsp;reader:</p>
<ul class="simple">
<li>The renderer components are rather simple, you may create any <span class="caps">DOM</span> structure you want in&nbsp;them</li>
<li>Pass a function as a parameter to the object or multi-line editor that will be used as a validator for the values (i.e not allow nulls or enforce a specific format) - then you can add another &#8220;error&#8221; <tt class="docutils literal">span</tt> that will be displayed if the validation does not&nbsp;pass</li>
<li>Make the object editor smarter by passing the type of each attribute (i.e text, number, boolean, date) and check that each input corresponds to that&nbsp;type</li>
<li>Pass a min/max number of list items for the multi-line&nbsp;editor</li>
<li>The multi-line editor doesn&#8217;t really need to have only text values for each item. You could combine the multi-line editor with the object editor so that each line has a specific, object-like structure. For example, for each child we may have two attributes, name and date of&nbsp;birth</li>
</ul>
</div>
</div>
  		</article>
<div class="pagination">
    <a class="prev" href="https://spapas.github.io/index2.html">&larr; Older</a>

  <br />
</div></div>
<aside class="sidebar">
  <section>
  <br />
  <a href='/feeds/all.atom.xml'>Atom</a> 
  |
  <a href='/feeds/all.rss.xml'>RSS</a> 
  </section>
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="https://spapas.github.io/2018/03/01/django-rest-auth/">Authentication for django-rest-framework with django-rest-auth</a>
      </li>
      <li class="post">
          <a href="https://spapas.github.io/2017/12/20/python-2-3-windows/">Using both Python 2 and 3 in Windows</a>
      </li>
      <li class="post">
          <a href="https://spapas.github.io/2017/10/11/essential-django-packages/">My essential django package list</a>
      </li>
      <li class="post">
          <a href="https://spapas.github.io/2017/07/04/postgresql-auto-create-category-column/">Automatically create a category table in Postgresql by extracting unique table values</a>
      </li>
      <li class="post">
          <a href="https://spapas.github.io/2017/01/03/ag-grid-custom-components/">Creating custom components for ag-grid</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="https://spapas.github.io/category/css.html">css</a></li>
        <li><a href="https://spapas.github.io/category/django.html">django</a></li>
        <li><a href="https://spapas.github.io/category/flask.html">flask</a></li>
        <li><a href="https://spapas.github.io/category/git.html">git</a></li>
        <li><a href="https://spapas.github.io/category/javascript.html">javascript</a></li>
        <li><a href="https://spapas.github.io/category/pelican.html">pelican</a></li>
        <li><a href="https://spapas.github.io/category/postgresql.html">postgresql</a></li>
        <li><a href="https://spapas.github.io/category/python.html">python</a></li>
        <li><a href="https://spapas.github.io/category/spring.html">spring</a></li>
        <li><a href="https://spapas.github.io/category/wagtail.html">wagtail</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="https://spapas.github.io/tag/less.html">less</a>,    <a href="https://spapas.github.io/tag/rest.html">rest</a>,    <a href="https://spapas.github.io/tag/query.html">query</a>,    <a href="https://spapas.github.io/tag/python-2.html">python-2</a>,    <a href="https://spapas.github.io/tag/tables.html">tables</a>,    <a href="https://spapas.github.io/tag/pivot_table.html">pivot_table</a>,    <a href="https://spapas.github.io/tag/console.html">console</a>,    <a href="https://spapas.github.io/tag/django-rq.html">django-rq</a>,    <a href="https://spapas.github.io/tag/github-pages.html">github-pages</a>,    <a href="https://spapas.github.io/tag/forms.html">forms</a>,    <a href="https://spapas.github.io/tag/yaml.html">yaml</a>,    <a href="https://spapas.github.io/tag/404.html">404</a>,    <a href="https://spapas.github.io/tag/ldap.html">ldap</a>,    <a href="https://spapas.github.io/tag/spring-security.html">spring-security</a>,    <a href="https://spapas.github.io/tag/initd.html">init.d</a>,    <a href="https://spapas.github.io/tag/python.html">python</a>,    <a href="https://spapas.github.io/tag/django-extensions.html">django-extensions</a>,    <a href="https://spapas.github.io/tag/class-based-views.html">class-based-views</a>,    <a href="https://spapas.github.io/tag/scipy.html">scipy</a>,    <a href="https://spapas.github.io/tag/grid.html">grid</a>,    <a href="https://spapas.github.io/tag/ag-grid.html">ag-grid</a>,    <a href="https://spapas.github.io/tag/watchify.html">watchify</a>,    <a href="https://spapas.github.io/tag/settings.html">settings</a>,    <a href="https://spapas.github.io/tag/flux.html">flux</a>,    <a href="https://spapas.github.io/tag/fixeddatatable.html">FixedDataTable</a>,    <a href="https://spapas.github.io/tag/debug.html">debug</a>,    <a href="https://spapas.github.io/tag/imgur.html">imgur</a>,    <a href="https://spapas.github.io/tag/security.html">security</a>,    <a href="https://spapas.github.io/tag/node.html">node</a>,    <a href="https://spapas.github.io/tag/google.html">google</a>,    <a href="https://spapas.github.io/tag/spring.html">spring</a>,    <a href="https://spapas.github.io/tag/react-redux.html">react-redux</a>,    <a href="https://spapas.github.io/tag/cron.html">cron</a>,    <a href="https://spapas.github.io/tag/babelify.html">babelify</a>,    <a href="https://spapas.github.io/tag/design.html">design</a>,    <a href="https://spapas.github.io/tag/tutorial.html">tutorial</a>,    <a href="https://spapas.github.io/tag/gmail.html">gmail</a>,    <a href="https://spapas.github.io/tag/reportlab.html">reportlab</a>,    <a href="https://spapas.github.io/tag/rq.html">rq</a>,    <a href="https://spapas.github.io/tag/redis.html">redis</a>,    <a href="https://spapas.github.io/tag/python-3.html">python-3</a>,    <a href="https://spapas.github.io/tag/research.html">research</a>,    <a href="https://spapas.github.io/tag/werkzeug.html">werkzeug</a>,    <a href="https://spapas.github.io/tag/jobs.html">jobs</a>,    <a href="https://spapas.github.io/tag/redux-thunk.html">redux-thunk</a>,    <a href="https://spapas.github.io/tag/javascript.html">javascript</a>,    <a href="https://spapas.github.io/tag/component.html">component</a>,    <a href="https://spapas.github.io/tag/ajax.html">ajax</a>,    <a href="https://spapas.github.io/tag/ipython.html">ipython</a>,    <a href="https://spapas.github.io/tag/java.html">java</a>,    <a href="https://spapas.github.io/tag/configuration.html">configuration</a>,    <a href="https://spapas.github.io/tag/properties.html">properties</a>,    <a href="https://spapas.github.io/tag/bash.html">bash</a>,    <a href="https://spapas.github.io/tag/es6.html">es6</a>,    <a href="https://spapas.github.io/tag/spring-boot.html">spring-boot</a>,    <a href="https://spapas.github.io/tag/postgresql.html">postgresql</a>,    <a href="https://spapas.github.io/tag/filter.html">filter</a>,    <a href="https://spapas.github.io/tag/flask.html">flask</a>,    <a href="https://spapas.github.io/tag/static-html.html">static-html</a>,    <a href="https://spapas.github.io/tag/pdf.html">pdf</a>,    <a href="https://spapas.github.io/tag/react-notification.html">react-notification</a>,    <a href="https://spapas.github.io/tag/pelican.html">pelican</a>,    <a href="https://spapas.github.io/tag/tasks.html">tasks</a>,    <a href="https://spapas.github.io/tag/nodejs.html">node.js</a>,    <a href="https://spapas.github.io/tag/pivot.html">pivot</a>,    <a href="https://spapas.github.io/tag/auditing.html">auditing</a>,    <a href="https://spapas.github.io/tag/git.html">git</a>,    <a href="https://spapas.github.io/tag/uglify.html">uglify</a>,    <a href="https://spapas.github.io/tag/introduction.html">introduction</a>,    <a href="https://spapas.github.io/tag/pusher.html">pusher</a>,    <a href="https://spapas.github.io/tag/fixed-data-tables.html">fixed-data-tables</a>,    <a href="https://spapas.github.io/tag/heroku.html">heroku</a>,    <a href="https://spapas.github.io/tag/xhtml2pdf.html">xhtml2pdf</a>,    <a href="https://spapas.github.io/tag/numpy.html">numpy</a>,    <a href="https://spapas.github.io/tag/boilerplate.html">boilerplate</a>,    <a href="https://spapas.github.io/tag/django-rest-auth.html">django-rest-auth</a>,    <a href="https://spapas.github.io/tag/wagtail.html">wagtail</a>,    <a href="https://spapas.github.io/tag/rst.html">rst</a>,    <a href="https://spapas.github.io/tag/profiles.html">profiles</a>,    <a href="https://spapas.github.io/tag/githubio.html">github.io</a>,    <a href="https://spapas.github.io/tag/error.html">error</a>,    <a href="https://spapas.github.io/tag/cbv.html">cbv</a>,    <a href="https://spapas.github.io/tag/react-router-redux.html">react-router-redux</a>,    <a href="https://spapas.github.io/tag/history.html">history</a>,    <a href="https://spapas.github.io/tag/django-rest-framework.html">django-rest-framework</a>,    <a href="https://spapas.github.io/tag/redux-form.html">redux-form</a>,    <a href="https://spapas.github.io/tag/asynchronous.html">asynchronous</a>,    <a href="https://spapas.github.io/tag/scheduling.html">scheduling</a>,    <a href="https://spapas.github.io/tag/plpgsql.html">plpgsql</a>,    <a href="https://spapas.github.io/tag/generic.html">generic</a>,    <a href="https://spapas.github.io/tag/babel.html">babel</a>,    <a href="https://spapas.github.io/tag/authentication.html">authentication</a>,    <a href="https://spapas.github.io/tag/pandas.html">pandas</a>,    <a href="https://spapas.github.io/tag/css.html">css</a>,    <a href="https://spapas.github.io/tag/npm.html">npm</a>,    <a href="https://spapas.github.io/tag/deploy.html">deploy</a>,    <a href="https://spapas.github.io/tag/mongodb.html">mongodb</a>,    <a href="https://spapas.github.io/tag/react.html">react</a>,    <a href="https://spapas.github.io/tag/notebook.html">notebook</a>,    <a href="https://spapas.github.io/tag/browserify.html">browserify</a>,    <a href="https://spapas.github.io/tag/branching.html">branching</a>,    <a href="https://spapas.github.io/tag/github.html">github</a>,    <a href="https://spapas.github.io/tag/jupyter.html">jupyter</a>,    <a href="https://spapas.github.io/tag/windows.html">windows</a>,    <a href="https://spapas.github.io/tag/django.html">django</a>,    <a href="https://spapas.github.io/tag/q.html">q</a>,    <a href="https://spapas.github.io/tag/react-router.html">react-router</a>,    <a href="https://spapas.github.io/tag/redux.html">redux</a>,    <a href="https://spapas.github.io/tag/boostrap-material-design.html">boostrap-material-design</a>  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <li class="loading">Status updating...</li>
    </ul>
      <a href="https://github.com/spapas">@spapas</a> on GitHub
    <script  src="//code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script type="text/javascript">
      $(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = 'https://spapas.github.io/theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'spapas',
              count: 5,
              skip_forks: true,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="https://spapas.github.io/theme/js/github.js" type="text/javascript"> </script>
  </section>


  
  <section>
    <h1>Support</h1>
    You can show your appreciation for anything useful you've found here by buying me a coffee :)
    <style>.bmc-button img{width: 27px !important;margin-bottom: 3px !important;box-shadow: none !important;border: none !important;vertical-align: middle !important;}.bmc-button{line-height: 36px !important;height:37px !important;text-decoration: none !important;display:inline-block !important;color:#ffffff !important;background-color:#000000 !important;border-radius: 3px !important;border: 1px solid transparent !important;padding: 1px 9px !important;font-size: 23px !important;letter-spacing:0.6px !important;;box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;margin: 0 auto !important;font-family:'Cookie', cursive !important;-webkit-box-sizing: border-box !important;box-sizing: border-box !important;-o-transition: 0.3s all linear !important;-webkit-transition: 0.3s all linear !important;-moz-transition: 0.3s all linear !important;-ms-transition: 0.3s all linear !important;transition: 0.3s all linear !important;}.bmc-button:hover, .bmc-button:active, .bmc-button:focus {-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;text-decoration: none !important;box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;opacity: 0.85 !important;color:#ffffff !important;}</style><link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet"><a class="bmc-button" target="_blank" href="https://www.buymeacoffee.com/9CqHPEQ6F"><img src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg" alt="Buy me a coffee"><span style="margin-left:5px">Buy me a coffee</span></a>
  </section>
</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2013&ndash;2018  Serafeim Papastefanos &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="https://spapas.github.io/theme/js/modernizr-2.0.js"></script>
  <script src="https://spapas.github.io/theme/js/ender.js"></script>
  <script src="https://spapas.github.io/theme/js/octopress.js" type="text/javascript"></script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44750952-1', 'auto');

    ga('send', 'pageview');
    </script>
  <script type="text/javascript">
    var disqus_shortname = 'spapas-github-io';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
</body>
</html>