<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>/var/</title>
  <meta name="author" content="Serafeim Papastefanos">



  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="../../../../favicon.png" rel="icon">
  <link href="../../../../theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">
  <script src="../../../../theme/js/modernizr-2.0.js"></script>
  <script src="../../../../theme/js/ender.js"></script>
  <script src="../../../../theme/js/octopress.js" type="text/javascript"></script>

  <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head><body>
  <header role="banner"><hgroup>
  <h1><a href="../../../../">/var/</a></h1>
    <h2>Various programming stuff</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://spapas.github.io/" rel="subscribe-rss">RSS</a></li>
</ul>

<!-- TODO: add search here
<form action="" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:../../../.." />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
-->

<ul class="main-navigation">
    <!-- TODO: add categories here? -->
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Django generic formviews</h1>
      <p class="meta"><time datetime="2014-04-11T10:23:00" pubdate>Παρ 11 Απρίλιος 2014</time></p>
</header>

        <a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="_serafeim_">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
    <div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#a-quick-introduction-to-the-formview" id="id2">A quick introduction to the <tt class="docutils literal">FormView</tt></a><ul>
<li><a class="reference internal" href="#using-groups" id="id3">Using&nbsp;groups</a></li>
<li><a class="reference internal" href="#by-storing-the-authority-to-the-session" id="id4">By storing the authority to the&nbsp;session</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion" id="id5">Conclusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a></h2>
<p>We recently needed to create a number of views for changing the status of an Application for our organization.
An Application can be cancelled, submitted, acceptted etc - for each of these status changes a form should be
presented to the user. When the user submits the form the status of the Application will be&nbsp;changed.</p>
<p>To implement the above requirement we created a generic <span class="caps">CBV</span> FormView.
Django <a class="reference external" href="https://docs.djangoproject.com/en/1.6/topics/class-based-views/">Class Based Views</a> (CBVs) can be used to create reusable Views using normal class inheritance. Most
people use the well-known <tt class="docutils literal">CreateView</tt>, <tt class="docutils literal">UpdateView</tt>, <tt class="docutils literal">DetailView</tt> and <tt class="docutils literal">ListView</tt>, however, as we
will see below, the <tt class="docutils literal">FormView</tt> will help us write <span class="caps">DRY</span>&nbsp;code.</p>
<p>I have to notice here that an invaluable tool to help you understanding CBVs is the <a class="reference external" href="http://ccbv.co.uk/"><span class="caps">CBV</span> inspector</a> which
has a nice web interface for browsing the <span class="caps">CBV</span> hierarchies, attributes and&nbsp;methods.</p>
</div>
<div class="section" id="a-quick-introduction-to-the-formview">
<h2><a class="toc-backref" href="#id2">A quick introduction to the <tt class="docutils literal">FormView</tt></a></h2>
<p>A simple <tt class="docutils literal">FormView</tt> can be defined like this (<a class="reference external" href="http://ccbv.co.uk/projects/Django/1.6/django.views.generic.edit/FormView/"><span class="caps">CBV</span> FormView</a>):</p>
<pre class="code literal-block">
class MyFormView(FormView):
  form_class = forms.MyFormView
</pre>
<p>The above can be used in urls.py like&nbsp;this:</p>
<pre class="code literal-block">
urlpatterns = patterns('',
  url(r'^my_formview/(?P&lt;pk&gt;\d+)$', views.MyFormView.as_view() , name='my_formview' ),
</pre>
<p>This will present a form to the user when he visits the <tt class="docutils literal">my_formview</tt>  url &#8212; however this form won&#8217;t do anything. To allow
the form to actually do something when it&#8217;s been submitted we need to override the <tt class="docutils literal">form_valid</tt> method.</p>
<pre class="code literal-block">
def form_valid(self, form):
    value = form.cleaned_data['value']
    messages.info(self.request, &quot;MyForm submitted with value {0}!&quot;.format(value) )
    return HttpResponseRedirect( reverse('my_formview') )
</pre>
<p>As you can see the submitted form is passed in the method and can be used to receive its <tt class="docutils literal">cleaned_data</tt>.</p>
<div class="section" id="using-groups">
<h3><a class="toc-backref" href="#id3">Using&nbsp;groups</a></h3>
<p>Just define a <tt class="docutils literal">django.contrib.auth.models.Group</tt> for each authority and add the users to the groups you want using the django-admin.
Your Authority model would have an one-to-one relation with the <tt class="docutils literal">django.contrib.auth.models.Group</tt> so you will be able to find out the other
information of the authority (since django groups only have&nbsp;names).</p>
<p>Now you can just get the groups for the user and find out his authorities. This could lead to problems when users belong to django groups
that are not related to authorities so you must filter these out (for instance by checking which groups actually have a corresponding&nbsp;Authority).</p>
</div>
<div class="section" id="by-storing-the-authority-to-the-session">
<h3><a class="toc-backref" href="#id4">By storing the authority to the&nbsp;session</a></h3>
<p>When the user logs in you can add an attribute to the session that would save the authority of the user. To do that, you should define
a custom middleware that checks to see if there is an authority attribute to the session and if not it will do whatever it needs to find it and set it.
An example is&nbsp;this:</p>
<pre class="code literal-block">
class CustomAuthorityMiddleware:
  def process_request(self, request):
    if not request.session.get('authority'):
      authority = get_the_authority(request.user)
      request.session['authority']=authority
</pre>
<p>This way, whenever you want to find out the authority of the user you just check the&nbsp;session.</p>
</div>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#id5">Conclusion</a></h2>
<p>Using the above techniques we can define authority (or just user) data. Your AuthorityData should
have a <tt class="docutils literal">ForeignKey</tt> to your Authority  and you have configure your queries, ModelForms and CBVs
to use that. If you have more than one models that belong to an authority and want to stay <span class="caps">DRY</span> then you&#8217;d need
to define all the above as <a class="reference external" href="https://docs.djangoproject.com/en/dev/topics/class-based-views/mixins/">mixins</a>.</p>
</div>
</div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">Serafeim Papastefanos</span>
  </span>
<time datetime="2014-04-11T10:23:00" pubdate>Παρ 11 Απρίλιος 2014</time>  <span class="categories">
    <a class="category" href="../../../../tag/django.html">django</a>
    <a class="category" href="../../../../tag/python.html">python</a>
    <a class="category" href="../../../../tag/cbv.html">cbv</a>
  </span>
</p>    </footer>
  </article>

</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="../../../../2014/04/11/django-generic-formviews/">Django generic formviews</a>
      </li>
      <li class="post">
          <a href="../../../../2014/02/13/wagtail-tutorial/">A Wagtail tutorial</a>
      </li>
      <li class="post">
          <a href="../../../../2013/12/24/django-dynamic-forms/">Django dynamic forms</a>
      </li>
      <li class="post">
          <a href="../../../../2013/11/05/django-authoritiy-data/">Django authority data</a>
      </li>
      <li class="post">
          <a href="../../../../2013/10/14/spring-ldap-custom-authorities/">Using custom authorities with spring-security LDAP authentication</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="../../../../category/django.html">django</a></li>
        <li><a href="../../../../category/git.html">git</a></li>
        <li><a href="../../../../category/pelican.html">pelican</a></li>
        <li><a href="../../../../category/spring.html">spring</a></li>
        <li><a href="../../../../category/wagtail.html">wagtail</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="../../../../tag/branching.html">branching</a>,    <a href="../../../../tag/git.html">git</a>,    <a href="../../../../tag/java.html">java</a>,    <a href="../../../../tag/pelican.html">pelican</a>,    <a href="../../../../tag/python.html">python</a>,    <a href="../../../../tag/spring.html">spring</a>,    <a href="../../../../tag/ldap.html">ldap</a>,    <a href="../../../../tag/wagtail.html">wagtail</a>,    <a href="../../../../tag/authentication.html">authentication</a>,    <a href="../../../../tag/django.html">django</a>,    <a href="../../../../tag/forms.html">forms</a>,    <a href="../../../../tag/windows.html">windows</a>,    <a href="../../../../tag/github-pages.html">github-pages</a>,    <a href="../../../../tag/github.html">github</a>,    <a href="../../../../tag/cbv.html">cbv</a>,    <a href="../../../../tag/githubio.html">github.io</a>,    <a href="../../../../tag/static-html.html">static-html</a>,    <a href="../../../../tag/rst.html">rst</a>,    <a href="../../../../tag/security.html">security</a>,    <a href="../../../../tag/spring-security.html">spring-security</a>  </section>


</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Serafeim Papastefanos -
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-44750952-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>